(function(_0x2e2a3a,_0x52f417){const _0x150f9c={_0x7185ed:0x459,_0x35eef0:0x45a,_0x158155:0x45d,_0x41c812:0x46a,_0xc1c62e:0x45a,_0x50f766:0x68,_0x56b8d1:0x5e,_0x5ed563:0x67,_0x58c347:0x6a,_0x3e150a:0x466,_0x304c9b:0x463,_0x577d59:0x45f,_0x54d860:0x456,_0x200db1:0x5b,_0x23dcf6:0x61,_0x192e29:0x58,_0x5378ba:0x44c,_0x10bbcd:0x455,_0x52149e:0x455,_0x2abcc5:0x453,_0x1c3075:0x453,_0x347e25:0x66,_0xa92989:0x6d,_0x5565f6:0x45b,_0x5bdb34:0x457},_0x50ec19={_0x3b49c7:0x27a},_0xb616c5=_0x2e2a3a();function _0x277a29(_0x240b20,_0x482208,_0x4b0e52,_0x37a910){return _0xc20f(_0x4b0e52-_0x50ec19._0x3b49c7,_0x37a910);}function _0x2487d3(_0xc49bdd,_0x56e0b2,_0x4a9de0,_0x22a980){return _0xc20f(_0xc49bdd- -0x247,_0x22a980);}while(!![]){try{const _0x41a08d=parseInt(_0x277a29(_0x150f9c._0x7185ed,0x451,_0x150f9c._0x35eef0,_0x150f9c._0x158155))/(-0x13a*-0x9+-0x25b1+-0x355*-0x8)*(-parseInt(_0x277a29(0x46a,_0x150f9c._0x41c812,0x461,_0x150f9c._0xc1c62e))/(-0x1609+0x1*0x1f04+-0x8f9))+parseInt(_0x2487d3(-_0x150f9c._0x50f766,-_0x150f9c._0x56b8d1,-_0x150f9c._0x5ed563,-_0x150f9c._0x58c347))/(-0xd83+0x1165+-0x3df)+parseInt(_0x277a29(_0x150f9c._0x3e150a,_0x150f9c._0x304c9b,_0x150f9c._0x577d59,_0x150f9c._0x54d860))/(0xbd2+-0x827*0x1+-0x1*0x3a7)+parseInt(_0x2487d3(-0x61,-_0x150f9c._0x200db1,-_0x150f9c._0x23dcf6,-_0x150f9c._0x192e29))/(0x4*0x5ae+-0x11ab+-0x508)+-parseInt(_0x277a29(0x45f,_0x150f9c._0x5378ba,_0x150f9c._0x10bbcd,_0x150f9c._0x52149e))/(0x13*-0x1ae+0x326*-0x1+-0x5d9*-0x6)+-parseInt(_0x277a29(0x450,_0x150f9c._0x2abcc5,_0x150f9c._0x1c3075,0x44d))/(-0x1*-0xcc5+0x1*0x1b04+-0x27c2)+parseInt(_0x2487d3(-0x6a,-_0x150f9c._0x347e25,-_0x150f9c._0xa92989,-0x62))/(-0x1c22+0x1422+-0x101*-0x8)*(parseInt(_0x277a29(0x455,_0x150f9c._0x5565f6,0x45e,_0x150f9c._0x5bdb34))/(0x106+-0x12dd+0x11e0));if(_0x41a08d===_0x52f417)break;else _0xb616c5['push'](_0xb616c5['shift']());}catch(_0x4d3b5c){_0xb616c5['push'](_0xb616c5['shift']());}}}(_0x5acc,0x3fd27+0x113*0x688+-0x5da1e));const _0x320457=(function(){const _0x250fc0={_0x9fe95e:0x4,_0x3a2cff:0x8,_0x5438a6:0x3,_0x3c8074:0x1};let _0x37ec21=!![];return function(_0x143bb0,_0x32b04a){const _0x3fff5b={_0x575276:0x1df},_0x26d002=_0x37ec21?function(){function _0x18a727(_0x59a360,_0x22aa4c,_0x1308b0,_0x538082){return _0xc20f(_0x1308b0- -_0x3fff5b._0x575276,_0x538082);}if(_0x32b04a){const _0x4da5b2=_0x32b04a[_0x18a727(_0x250fc0._0x9fe95e,_0x250fc0._0x3a2cff,_0x250fc0._0x5438a6,_0x250fc0._0x3c8074)](_0x143bb0,arguments);return _0x32b04a=null,_0x4da5b2;}}:function(){};return _0x37ec21=![],_0x26d002;};}()),_0x35b023=_0x320457(this,function(){const _0x389f10={_0x121f20:0x5c0,_0x5b9629:0x5b6,_0x52ea62:0x25c,_0x580bfb:0x25a,_0x54f764:0x263,_0x37fdca:0x257,_0x12369d:0x252,_0x4d03cf:0x259,_0x5a0266:0x5bd,_0x5616fe:0x5b0,_0x333af5:0x5b6,_0x3e0451:0x256,_0x21cffa:0x5b9,_0x5df919:0x5b8,_0x3f6dc1:0x255,_0x26ba5e:0x256,_0x14e43d:0x254,_0x50c7f8:0x25c},_0x595557={_0x4a1c0b:0x3d5},_0x12ba3e={};_0x12ba3e[_0x442a97(0x5ba,_0x389f10._0x121f20,0x5bf,_0x389f10._0x5b9629)]='(((.+)+)+)'+'+$';const _0xfda406=_0x12ba3e;function _0x442a97(_0x4a517b,_0x257403,_0x44141e,_0x3dfa7d){return _0xc20f(_0x3dfa7d-_0x595557._0x4a1c0b,_0x4a517b);}function _0x513c7d(_0x1fe644,_0x3e1068,_0x593a7e,_0x3e983b){return _0xc20f(_0x1fe644-0x74,_0x3e983b);}return _0x35b023[_0x513c7d(_0x389f10._0x52ea62,_0x389f10._0x580bfb,_0x389f10._0x54f764,0x261)]()[_0x513c7d(_0x389f10._0x37fdca,_0x389f10._0x12369d,_0x389f10._0x4d03cf,0x24f)](_0xfda406[_0x442a97(_0x389f10._0x5a0266,_0x389f10._0x5a0266,_0x389f10._0x5616fe,_0x389f10._0x333af5)])['toString']()[_0x513c7d(0x24e,_0x389f10._0x3e0451,0x251,0x256)+'r'](_0x35b023)[_0x442a97(0x5bb,_0x389f10._0x21cffa,_0x389f10._0x5df919,_0x389f10._0x5df919)](_0xfda406[_0x513c7d(_0x389f10._0x3f6dc1,_0x389f10._0x26ba5e,_0x389f10._0x14e43d,_0x389f10._0x50c7f8)]);});_0x35b023();function _0x5acc(){const _0x2f1593=['CMvQzwn0vw5HDq','C3rLyw0TDg90Ca','lI9ZDgvHBq','mJG1mdy0nvv1uvjhsG','y29UC3rYDwn0BW','ote3mZi4y0PQA25u','Ahr0Chm','mZjqsKDytMK','qwDLBNq','mtiWodm1ogr3CLLqAq','ntncBwTyrw0','rK5ADxe','yxbWBhK','C2vHCMnO','mtiXnZqZow9OyKvXDG','nJm5ota0CwXVy1bW','mZm5nJu1CwHHuKHe','mtaZmZHsrfLpqLK','Dg9tDhjPBMC','DgHVCML6zwq'];_0x5acc=function(){return _0x2f1593;};return _0x5acc();}function _0xc20f(_0x5eb212,_0x5cadb3){const _0x5b19ed=_0x5acc();return _0xc20f=function(_0x319df7,_0x1b29c8){_0x319df7=_0x319df7-(0x4*0x1e3+0x261*-0x1+-0x356);let _0x24197f=_0x5b19ed[_0x319df7];if(_0xc20f['jMRDVL']===undefined){var _0xadeba1=function(_0x3b265c){const _0x54d371='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x43dd84='',_0x5c2344='',_0x69e86c=_0x43dd84+_0xadeba1;for(let _0xaa67e2=-0xca3*0x1+0x275*0x5+0x5a,_0x4e6a1e,_0x401368,_0x370864=-0x20b1*-0x1+-0x294+-0xd*0x251;_0x401368=_0x3b265c['charAt'](_0x370864++);~_0x401368&&(_0x4e6a1e=_0xaa67e2%(0x97*-0xe+0xef*0x2+0x5*0x148)?_0x4e6a1e*(-0x705+0x2*0x1f9+0x353)+_0x401368:_0x401368,_0xaa67e2++%(-0x1*0x1025+-0x5*-0x754+-0x147b))?_0x43dd84+=_0x69e86c['charCodeAt'](_0x370864+(0x5*0x3fb+0x22a3+-0x3680))-(-0x1f10+-0x1b06+0x1d1*0x20)!==-0xa11*-0x1+-0x1c0d+-0x8fe*-0x2?String['fromCharCode'](0x124a*0x1+0x6e*-0x2b+0x3*0x65&_0x4e6a1e>>(-(-0x94e+0xb*-0x101+0x145b)*_0xaa67e2&0x1bc*0x8+0x4ae*0x8+0x3f2*-0xd)):_0xaa67e2:-0x1a06+0x1b8f+-0x3*0x83){_0x401368=_0x54d371['indexOf'](_0x401368);}for(let _0x988446=0xd*-0x20b+0x7*0x276+0x955*0x1,_0x59d89d=_0x43dd84['length'];_0x988446<_0x59d89d;_0x988446++){_0x5c2344+='%'+('00'+_0x43dd84['charCodeAt'](_0x988446)['toString'](0x1*0x1b74+0x142e+-0x2*0x17c9))['slice'](-(-0x13*-0x1cf+-0x1*-0x1355+0x4*-0xd6c));}return decodeURIComponent(_0x5c2344);};_0xc20f['gocaQM']=_0xadeba1,_0x5eb212=arguments,_0xc20f['jMRDVL']=!![];}const _0x4a6295=_0x5b19ed[0x2*0xd7b+0x1*0x24d6+0xaa2*-0x6],_0xcac08e=_0x319df7+_0x4a6295,_0x2a4c99=_0x5eb212[_0xcac08e];if(!_0x2a4c99){const _0x5e3fb1=function(_0x2c2d12){this['kHPbXA']=_0x2c2d12,this['KNuEXZ']=[-0x2*0x935+-0x1e3b+0x30a6,-0xc*0x30b+-0x4c+0x24d0,0x1225*0x2+0xb5f+0x7*-0x6cf],this['xQUZaD']=function(){return'newState';},this['mZgPAQ']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['OCxwFS']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x5e3fb1['prototype']['IIwxdu']=function(){const _0x232af7=new RegExp(this['mZgPAQ']+this['OCxwFS']),_0x495ec0=_0x232af7['test'](this['xQUZaD']['toString']())?--this['KNuEXZ'][0x83*0x2+0x977+-0xa7c]:--this['KNuEXZ'][0x3c7*0x4+-0x19*-0xff+-0x2803];return this['vJxzlJ'](_0x495ec0);},_0x5e3fb1['prototype']['vJxzlJ']=function(_0x1e64ab){if(!Boolean(~_0x1e64ab))return _0x1e64ab;return this['ieqxtI'](this['kHPbXA']);},_0x5e3fb1['prototype']['ieqxtI']=function(_0x2f1343){for(let _0x6a47a8=0x1b3c+0x2623*0x1+-0x415f,_0x2f9b63=this['KNuEXZ']['length'];_0x6a47a8<_0x2f9b63;_0x6a47a8++){this['KNuEXZ']['push'](Math['round'](Math['random']())),_0x2f9b63=this['KNuEXZ']['length'];}return _0x2f1343(this['KNuEXZ'][-0x6f7*0x1+0xd81*-0x1+-0x418*-0x5]);},new _0x5e3fb1(_0xc20f)['IIwxdu'](),_0x24197f=_0xc20f['gocaQM'](_0x24197f),_0x5eb212[_0xcac08e]=_0x24197f;}else _0x24197f=_0x2a4c99;return _0x24197f;},_0xc20f(_0x5eb212,_0x5cadb3);}function _0x39e8fd(_0x4ceb2c,_0xcb6366,_0x53fd11,_0x51e524){const _0x3bc61f={_0xdccb88:0x26a};return _0xc20f(_0xcb6366-_0x3bc61f._0xdccb88,_0x51e524);}const axios=require('axios'),https=require(_0x39e8fd(0x44b,0x446,0x450,0x447)),SteamTotp=require(_0x121322(-0x62,-0x68,-0x63,-0x6d)),xbsteam=require(_0x121322(-0x61,-0x67,-0x65,-0x61)),_0x46ee58={};function _0x121322(_0x2c129d,_0x269517,_0x37695d,_0x1370b3){const _0x2b9a7e={_0x4f5ccf:0x23f};return _0xc20f(_0x269517- -_0x2b9a7e._0x4f5ccf,_0x2c129d);}_0x46ee58[_0x39e8fd(0x438,0x440,0x448,0x443)+_0x39e8fd(0x441,0x43f,0x43a,0x442)]=![];const httpsAgent=new https[(_0x39e8fd(0x43e,0x448,0x43e,0x447))](_0x46ee58);module['exports']=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 7:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:',err);this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}}).catch(function(err){console.error('steam: Ошибка при получении информации о пользователе:',err);});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations==0){console.log(this.prefix+'Проверяю аутентификатор');await global.xbsteam.confirmAllMarketTransactions();await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping==0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory==0||tickCounter==2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders==0||tickCounter==2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory==0||tickCounter==2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};