(function(_0x1310b5,_0x6c0e89){const _0x192f80={_0x36b56c:0x1c4,_0x9dd8d:0x1c0,_0x3cf25f:0x1cb,_0x514d1e:0x1c0,_0x186692:0x1cb,_0x1965ad:0x1c4,_0x5e1589:0x1d1,_0x30d037:0x1c6,_0x4c3c6f:0x1ca,_0x332d0b:0x1ba,_0x359b76:0x1be,_0x49e850:0x1bc,_0x121ed5:0x1c3,_0x25c361:0x1c5,_0x46e92c:0x1bf,_0x52db8d:0x1bb,_0x287512:0x1bc,_0x1f3a9d:0x1bb,_0x27e1d4:0x1c8,_0x1540d8:0x3cc,_0x1f45d6:0x3ca,_0x190dd2:0x3c9,_0x4a65bf:0x1c1},_0x59df3e={_0x39dc66:0xb},_0x2d763b={_0x35d9e8:0x214};function _0x1b9f6f(_0x258e35,_0x1ab3c9,_0x5a7e6c,_0xf9cc98){return _0x416e(_0xf9cc98-_0x2d763b._0x35d9e8,_0x1ab3c9);}const _0x376e93=_0x1310b5();function _0x14e01e(_0x1e1a46,_0x375a38,_0x4f260a,_0x38a6dc){return _0x416e(_0x1e1a46-_0x59df3e._0x39dc66,_0x4f260a);}while(!![]){try{const _0x1e3135=parseInt(_0x14e01e(_0x192f80._0x36b56c,_0x192f80._0x9dd8d,_0x192f80._0x3cf25f,_0x192f80._0x514d1e))/(-0x1908*0x1+-0x190d+0x859*0x6)+parseInt(_0x14e01e(_0x192f80._0x186692,0x1cc,_0x192f80._0x1965ad,_0x192f80._0x5e1589))/(-0x3ea+0x83*0x37+-0x2b1*0x9)+-parseInt(_0x14e01e(_0x192f80._0x30d037,_0x192f80._0x4c3c6f,0x1c4,0x1cf))/(0x9*-0x358+0x13d2*0x1+-0xa49*-0x1)*(-parseInt(_0x14e01e(_0x192f80._0x332d0b,_0x192f80._0x359b76,_0x192f80._0x49e850,0x1bf))/(-0x8cb*-0x3+0x16bc+-0x3119))+parseInt(_0x14e01e(_0x192f80._0x121ed5,_0x192f80._0x25c361,_0x192f80._0x46e92c,_0x192f80._0x52db8d))/(0x2*0x4ab+-0x11f3+0x8a2)+parseInt(_0x14e01e(_0x192f80._0x287512,0x1b7,_0x192f80._0x1f3a9d,0x1c4))/(0x225+-0x245d+-0x2*-0x111f)*(parseInt(_0x14e01e(0x1c5,0x1bd,_0x192f80._0x27e1d4,_0x192f80._0x30d037))/(0x20f*0x7+-0x2*0xeb1+0xf00))+parseInt(_0x1b9f6f(_0x192f80._0x1540d8,_0x192f80._0x1f45d6,0x3ca,_0x192f80._0x190dd2))/(0x17ec+0x9*-0xc2+0x1112*-0x1)+-parseInt(_0x14e01e(0x1c9,0x1cc,0x1c4,_0x192f80._0x4a65bf))/(0x10d3+-0x9cd*0x1+-0x6fd);if(_0x1e3135===_0x6c0e89)break;else _0x376e93['push'](_0x376e93['shift']());}catch(_0x5eaecf){_0x376e93['push'](_0x376e93['shift']());}}}(_0xa516,-0x53a1*0x53+-0x19c5a*-0xf+-0x8d3ef*-0x2));const _0x333117=(function(){let _0x5df720=!![];return function(_0x584892,_0x3e7974){const _0x41b546={_0x19e96b:0x40e,_0x1ffa73:0x410,_0x2f2679:0x40d,_0x586772:0x40f},_0x18400b=_0x5df720?function(){const _0x499934={_0x55c36f:0x25c};function _0x3d9f4b(_0x1a956d,_0x539ae4,_0x2193ba,_0x1013e2){return _0x416e(_0x1013e2-_0x499934._0x55c36f,_0x2193ba);}if(_0x3e7974){const _0x2395a7=_0x3e7974[_0x3d9f4b(_0x41b546._0x19e96b,_0x41b546._0x1ffa73,_0x41b546._0x2f2679,_0x41b546._0x586772)](_0x584892,arguments);return _0x3e7974=null,_0x2395a7;}}:function(){};return _0x5df720=![],_0x18400b;};}()),_0x4ad687=_0x333117(this,function(){const _0x3b80b3={_0x1cba7f:0x31,_0x44c50e:0x2f,_0x1d4b3c:0x29,_0x34d8b1:0x348,_0x2a68e9:0x33e,_0x84aa74:0x342,_0x86c110:0x342,_0x1d72c7:0x33a,_0x5bdd4b:0x339,_0x21f60d:0x340,_0x287bc9:0x1b,_0x3d2495:0x1e,_0x34c2f1:0x347,_0x41ba45:0x343,_0x402211:0x20,_0x4783aa:0x1f,_0x4c5e7e:0x29,_0x23384a:0x1a,_0x4bb82f:0x17,_0x535716:0x24};function _0x312b3f(_0x8e5bfd,_0x408d2f,_0x4212ed,_0x594335){return _0x416e(_0x4212ed-0x183,_0x594335);}const _0x321daa={};_0x321daa['DjrJU']=_0xa3e0e9(_0x3b80b3._0x1cba7f,_0x3b80b3._0x44c50e,0x27,_0x3b80b3._0x1d4b3c)+'+$';const _0x57d732=_0x321daa;function _0xa3e0e9(_0x5bf2d7,_0x7cffe5,_0x406379,_0x4dd681){return _0x416e(_0x406379- -0x195,_0x7cffe5);}return _0x4ad687[_0x312b3f(_0x3b80b3._0x34d8b1,_0x3b80b3._0x2a68e9,_0x3b80b3._0x84aa74,0x340)]()[_0x312b3f(_0x3b80b3._0x86c110,_0x3b80b3._0x1d72c7,_0x3b80b3._0x5bdd4b,_0x3b80b3._0x21f60d)](_0x57d732[_0xa3e0e9(_0x3b80b3._0x287bc9,_0x3b80b3._0x3d2495,0x1f,0x1a)])[_0x312b3f(_0x3b80b3._0x34c2f1,_0x3b80b3._0x41ba45,_0x3b80b3._0x86c110,0x34b)]()['constructo'+'r'](_0x4ad687)[_0xa3e0e9(_0x3b80b3._0x402211,_0x3b80b3._0x4783aa,0x21,_0x3b80b3._0x4c5e7e)](_0x57d732[_0xa3e0e9(_0x3b80b3._0x23384a,_0x3b80b3._0x4bb82f,0x1f,_0x3b80b3._0x535716)]);});function _0xa516(){const _0x4e5c81=['nZy0mZK4rxjHB01d','mta4nJuYmtHWDg9btu0','mtj4B1nPCxi','kcGOlISPkYKRkq','lI9ZDgvHBq','nduWmJy5nZnntKXvshC','Dg9tDhjPBMC','mteZmdm0nfrNBvnfrW','DgHVCML6zwq','oduWndq0DezIwKLH','CMvQzwn0vw5HDq','nLHuzxvZEq','qwDLBNq','yxbWBhK','rgPYsLu','mtqZmti1mJHPBhnuBKq','C2vHCMnO','zxHWB3j0CW','mJiYnJu2mhzwuLz1uq'];_0xa516=function(){return _0x4e5c81;};return _0xa516();}_0x4ad687();const axios=require('axios'),https=require('https');function _0x416e(_0x2195a0,_0x4d30bb){const _0x620a42=_0xa516();return _0x416e=function(_0x5460e4,_0x5eb331){_0x5460e4=_0x5460e4-(0x1343*-0x1+-0x1655*-0x1+0x1*-0x163);let _0x1623d6=_0x620a42[_0x5460e4];if(_0x416e['zSVwYW']===undefined){var _0x36e644=function(_0x109a1){const _0x271203='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x41f008='',_0x49344d='',_0x5a25ec=_0x41f008+_0x36e644;for(let _0x163cfe=0x1ed3+0x3aa+-0x227d,_0x3dfc4b,_0x1eb426,_0x2b89ab=-0x265e+-0xcb0+0x1987*0x2;_0x1eb426=_0x109a1['charAt'](_0x2b89ab++);~_0x1eb426&&(_0x3dfc4b=_0x163cfe%(0x25c*0xa+0x1*-0x7bb+-0xfd9)?_0x3dfc4b*(0x6*-0x629+-0xa*0xe3+-0xf5c*-0x3)+_0x1eb426:_0x1eb426,_0x163cfe++%(-0x1*-0x2508+0x1f59+0x445d*-0x1))?_0x41f008+=_0x5a25ec['charCodeAt'](_0x2b89ab+(0x2*0x132e+0x26ce*-0x1+0x1f*0x4))-(0x106d+0x1*0x443+-0x371*0x6)!==0x8f+-0x1*0x521+0x492?String['fromCharCode'](-0x89*0x2b+-0x1675+-0xc3*-0x3d&_0x3dfc4b>>(-(0x1*-0x1c1d+0x11*0x1d5+-0x81*0x6)*_0x163cfe&-0x1d*-0x35+-0x1433+-0x23*-0x68)):_0x163cfe:0x5*0x602+0x1407+-0x3211){_0x1eb426=_0x271203['indexOf'](_0x1eb426);}for(let _0x3ff2f5=-0x50d*-0x2+0x5*-0xf8+0x542*-0x1,_0x51643e=_0x41f008['length'];_0x3ff2f5<_0x51643e;_0x3ff2f5++){_0x49344d+='%'+('00'+_0x41f008['charCodeAt'](_0x3ff2f5)['toString'](0x10e1+0x2407+0x2*-0x1a6c))['slice'](-(-0x16b5*-0x1+0x172b+-0x7a5*0x6));}return decodeURIComponent(_0x49344d);};_0x416e['STZUgP']=_0x36e644,_0x2195a0=arguments,_0x416e['zSVwYW']=!![];}const _0x192a60=_0x620a42[0x16b3+0x1*-0xe3b+0x4*-0x21e],_0x46b47d=_0x5460e4+_0x192a60,_0x5e35d2=_0x2195a0[_0x46b47d];if(!_0x5e35d2){const _0x1e7102=function(_0x2b590b){this['xOVvtI']=_0x2b590b,this['jwKXKa']=[0x1*0x1d07+0x22bd+-0x3fc3,-0x1*-0x1fed+-0x9ed*-0x1+0x29da*-0x1,-0x2*-0x794+0xe9*0x14+-0x215c],this['tfcluK']=function(){return'newState';},this['cvfvKZ']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['WkHgHl']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x1e7102['prototype']['ozbCxD']=function(){const _0x5a47ab=new RegExp(this['cvfvKZ']+this['WkHgHl']),_0x26594b=_0x5a47ab['test'](this['tfcluK']['toString']())?--this['jwKXKa'][-0x16a4+0xed3+-0x3e9*-0x2]:--this['jwKXKa'][0x8e*0x29+-0xb*0x316+-0x59a*-0x2];return this['osEbDd'](_0x26594b);},_0x1e7102['prototype']['osEbDd']=function(_0x23d6c9){if(!Boolean(~_0x23d6c9))return _0x23d6c9;return this['TNYDNs'](this['xOVvtI']);},_0x1e7102['prototype']['TNYDNs']=function(_0x12fa9a){for(let _0x593e8f=-0x21a8+-0x665*0x3+-0x51*-0xa7,_0x16b24e=this['jwKXKa']['length'];_0x593e8f<_0x16b24e;_0x593e8f++){this['jwKXKa']['push'](Math['round'](Math['random']())),_0x16b24e=this['jwKXKa']['length'];}return _0x12fa9a(this['jwKXKa'][-0x269+0xdde*-0x2+-0x1e25*-0x1]);},new _0x1e7102(_0x416e)['ozbCxD'](),_0x1623d6=_0x416e['STZUgP'](_0x1623d6),_0x2195a0[_0x46b47d]=_0x1623d6;}else _0x1623d6=_0x5e35d2;return _0x1623d6;},_0x416e(_0x2195a0,_0x4d30bb);}function _0x123410(_0x212a25,_0x273f69,_0x4989b0,_0x148768){const _0x211283={_0x2b8f95:0x17c};return _0x416e(_0x212a25-_0x211283._0x2b8f95,_0x148768);}function _0x5b9872(_0x4b6c12,_0x56cf0f,_0xdbaacf,_0x111920){const _0x4e7409={_0x130a52:0x30a};return _0x416e(_0x4b6c12-_0x4e7409._0x130a52,_0x111920);}const SteamTotp=require('steam-totp'),xbsteam=require(_0x5b9872(0x4c7,0x4c2,0x4c5,0x4c3)),_0x59b6a0={};_0x59b6a0[_0x123410(0x32c,0x330,0x331,0x32f)+_0x123410(0x33d,0x334,0x33e,0x33e)]=![];const httpsAgent=new https[(_0x5b9872(0x4bc,0x4b5,0x4be,0x4c5))](_0x59b6a0);module[_0x5b9872(0x4c1,0x4c7,0x4b7,0x4b7)]=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 7:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:',err);this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}}).catch(function(err){console.error('steam: Ошибка при получении информации о пользователе:',err);});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations==0){console.log(this.prefix+'Проверяю аутентификатор');await global.xbsteam.confirmAllMarketTransactions();await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping==0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory==0||tickCounter==2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders==0||tickCounter==2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory==0||tickCounter==2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};