(function(_0x15be99,_0x5c5c5f){const _0x28b042={_0x1c96f3:0x6,_0x48f9ea:0x9,_0x2a34e8:0x5,_0x485b0c:0x8,_0x9ff62:0x48,_0x454a42:0x5f,_0x33547f:0xd,_0x202ef2:0x18,_0x1781b1:0x12,_0x3debff:0x7,_0x35fa84:0x2,_0x36d144:0x8,_0x1bc430:0x5,_0x128c43:0x5b,_0x4e85fe:0x5c,_0x165eea:0x60,_0x48e36a:0x54,_0x4d0c9f:0x53,_0x4aed1a:0x54,_0x458368:0x68,_0x522598:0x55,_0x8c39b:0x4f,_0x1f7b96:0x4e,_0x41797d:0x5b,_0x9ab5c5:0x4e,_0x550fa0:0x48,_0x22c7e3:0x5a,_0x538239:0x56,_0x442d27:0x5f,_0x1f27a7:0x52,_0x122b0d:0x6b,_0x47a17b:0x6c,_0x5751ef:0x61,_0x38e583:0x3,_0x2c480b:0x6},_0x57421c={_0x1a5fa2:0x8c};function _0x4c4653(_0x4693b7,_0x11cadc,_0x3c2908,_0x372c4f){return _0xd987(_0x372c4f- -_0x57421c._0x1a5fa2,_0x4693b7);}const _0x2f6d83=_0x15be99();function _0x152ac0(_0x1e2d31,_0x5c2038,_0x26d3e0,_0x50c52f){return _0xd987(_0x26d3e0- -0xd9,_0x5c2038);}while(!![]){try{const _0x52803d=parseInt(_0x152ac0(_0x28b042._0x1c96f3,-_0x28b042._0x48f9ea,_0x28b042._0x2a34e8,_0x28b042._0x485b0c))/(-0x1a44+0x12b4+0x791)*(parseInt(_0x4c4653(_0x28b042._0x9ff62,_0x28b042._0x454a42,0x4c,0x55))/(-0x2d3*-0xb+0x61*-0xd+-0x1a22))+-parseInt(_0x152ac0(_0x28b042._0x33547f,_0x28b042._0x202ef2,_0x28b042._0x1781b1,_0x28b042._0x3debff))/(0x1*0x1314+0x4*0x8c6+0x3629*-0x1)*(-parseInt(_0x152ac0(-_0x28b042._0x35fa84,-_0x28b042._0x36d144,0x3,_0x28b042._0x1bc430))/(-0x2*-0x7ab+-0x1*0x20d3+0x1*0x1181))+parseInt(_0x4c4653(0x5c,_0x28b042._0x128c43,_0x28b042._0x4e85fe,_0x28b042._0x165eea))/(-0x1091*0x1+-0x981*0x3+0x5*0x905)*(-parseInt(_0x4c4653(_0x28b042._0x48e36a,0x4e,_0x28b042._0x4d0c9f,_0x28b042._0x4aed1a))/(0x2c7+-0x11e0+0xf1f))+parseInt(_0x4c4653(_0x28b042._0x458368,_0x28b042._0x522598,_0x28b042._0x4e85fe,_0x28b042._0x4e85fe))/(0x73c*0x4+0x24cd+0x50e*-0xd)*(-parseInt(_0x4c4653(_0x28b042._0x8c39b,_0x28b042._0x1f7b96,_0x28b042._0x41797d,_0x28b042._0x9ab5c5))/(0x1*0x41+0x2155+-0x218e))+parseInt(_0x4c4653(_0x28b042._0x550fa0,_0x28b042._0x22c7e3,_0x28b042._0x165eea,_0x28b042._0x538239))/(-0x205e+0xe7c+0x11eb)*(parseInt(_0x4c4653(_0x28b042._0x442d27,_0x28b042._0x1f27a7,_0x28b042._0x22c7e3,0x5e))/(-0x2ba*0x8+0x1*-0x91+0x166b))+-parseInt(_0x4c4653(_0x28b042._0x122b0d,_0x28b042._0x47a17b,0x52,_0x28b042._0x5751ef))/(0x22*0xe9+-0x1999+-0xc2*0x7)+-parseInt(_0x152ac0(-_0x28b042._0x38e583,0xf,_0x28b042._0x35fa84,-_0x28b042._0x2c480b))/(-0x1*-0x2327+-0x127d*0x1+-0x2*0x84f);if(_0x52803d===_0x5c5c5f)break;else _0x2f6d83['push'](_0x2f6d83['shift']());}catch(_0x575087){_0x2f6d83['push'](_0x2f6d83['shift']());}}}(_0x32c1,0xdd477+-0x819e5+0x53d1c));const _0x34e25d=(function(){const _0x4f9bad={_0x474780:0x331,_0xbf272b:0x332,_0x3f758d:0x33c,_0x4cc573:0x334,_0x29ad1a:0x30e,_0x509297:0x30f,_0x384705:0x319,_0x2c3908:0x33e,_0x413e08:0x32a,_0x2eeec6:0x330,_0x1ca455:0x1b7,_0x532bff:0x1be,_0x3d664d:0x1c1,_0x536d3a:0x1cb,_0x5ed392:0x1c2,_0x503561:0x315,_0x33ef1c:0x30d,_0x4ffeae:0x318,_0x287313:0x332,_0xeef78a:0x328},_0x41af9e={_0x16d3b1:0x16c,_0x19ac35:0x161,_0x2b69c2:0x168,_0x1ffdfa:0x166,_0x17d86a:0x37d,_0x2fa499:0x37e,_0x495b7b:0x185},_0x3d95f6={_0x50caba:0x17c,_0x46a0cf:0x2c,_0x5c9718:0x53},_0x5b2e4d={_0x4403e7:0x18a,_0x37cbd4:0x48,_0x12fd2b:0x4a},_0x2f0b11={_0x17f3db:0x2a5},_0x44e7ac={};_0x44e7ac[_0x1156c1(_0x4f9bad._0x474780,_0x4f9bad._0xbf272b,_0x4f9bad._0x3f758d,_0x4f9bad._0x4cc573)]=function(_0x26c8c6,_0x4e8266){return _0x26c8c6!==_0x4e8266;};function _0x1156c1(_0x4079df,_0x11af36,_0x48de92,_0x4914d9){return _0xd987(_0x4914d9-0x241,_0x48de92);}function _0x24ef84(_0x2e2a70,_0x4baf3a,_0x5b6c30,_0x2b620b){return _0xd987(_0x2b620b- -_0x2f0b11._0x17f3db,_0x5b6c30);}_0x44e7ac[_0x1156c1(_0x4f9bad._0x29ad1a,_0x4f9bad._0x509297,_0x4f9bad._0x509297,_0x4f9bad._0x384705)]=_0x1156c1(0x337,_0x4f9bad._0x2c3908,_0x4f9bad._0x413e08,_0x4f9bad._0x2eeec6),_0x44e7ac[_0x24ef84(-_0x4f9bad._0x1ca455,-_0x4f9bad._0x532bff,-0x1cf,-_0x4f9bad._0x3d664d)]=_0x24ef84(-0x1cc,-0x1bf,-_0x4f9bad._0x536d3a,-_0x4f9bad._0x5ed392),_0x44e7ac[_0x1156c1(_0x4f9bad._0x503561,0x30c,_0x4f9bad._0x33ef1c,_0x4f9bad._0x4ffeae)]=_0x1156c1(0x332,_0x4f9bad._0x287313,_0x4f9bad._0xeef78a,_0x4f9bad._0x474780);const _0x2a9efc=_0x44e7ac;let _0x113b89=!![];return function(_0x598bfc,_0x2d6a63){const _0x5bc6c8={_0x5d93f8:0x278,_0x32fb9f:0x281,_0x407833:0x27b,_0x2b89f1:0x25d,_0x16a0ee:0x251,_0x7ee550:0x252,_0x3f2e83:0x258,_0xf126e9:0x24f,_0x3f168a:0x269,_0x22c614:0x266,_0x233ff6:0x262,_0x317763:0x276,_0xbe1521:0x270,_0x19f409:0x271,_0x23f064:0x281},_0x320110={_0x5d6b0b:0x1be,_0x35ebc0:0x3e0};function _0x1e300b(_0x39c397,_0x16d3ac,_0x1608f7,_0x4c90fc){return _0x24ef84(_0x39c397-_0x5b2e4d._0x4403e7,_0x16d3ac-_0x5b2e4d._0x37cbd4,_0x16d3ac,_0x1608f7-_0x5b2e4d._0x12fd2b);}function _0xfe205b(_0x4fcdeb,_0x38e6ce,_0x2983e7,_0x5262fd){return _0x1156c1(_0x4fcdeb-_0x3d95f6._0x50caba,_0x38e6ce-_0x3d95f6._0x46a0cf,_0x2983e7,_0x4fcdeb-_0x3d95f6._0x5c9718);}if(_0x2a9efc[_0x1e300b(-_0x41af9e._0x16d3b1,-_0x41af9e._0x19ac35,-_0x41af9e._0x2b69c2,-_0x41af9e._0x1ffdfa)](_0xfe205b(_0x41af9e._0x17d86a,0x37f,0x385,_0x41af9e._0x2fa499),_0x2a9efc[_0x1e300b(-0x187,-_0x41af9e._0x495b7b,-0x184,-0x18d)])){const _0x2a530b=_0x113b89?function(){const _0xe5eb3={_0x9a6642:0x10f,_0x482650:0x43,_0x3c47bb:0xa5};function _0x4733ce(_0x230a63,_0x11a2d9,_0x315e49,_0x15ca47){return _0x1e300b(_0x230a63-_0x320110._0x5d6b0b,_0x15ca47,_0x230a63-_0x320110._0x35ebc0,_0x15ca47-0x38);}function _0x2146a6(_0x63b974,_0x3763b4,_0x2df83e,_0x9e95fc){return _0xfe205b(_0x63b974- -_0xe5eb3._0x9a6642,_0x3763b4-_0xe5eb3._0x482650,_0x2df83e,_0x9e95fc-_0xe5eb3._0x3c47bb);}if(_0x2a9efc[_0x2146a6(_0x5bc6c8._0x5d93f8,0x274,_0x5bc6c8._0x32fb9f,_0x5bc6c8._0x407833)](_0x2a9efc[_0x2146a6(_0x5bc6c8._0x2b89f1,_0x5bc6c8._0x16a0ee,_0x5bc6c8._0x7ee550,_0x5bc6c8._0x7ee550)],_0x2a9efc[_0x4733ce(0x25d,_0x5bc6c8._0x3f2e83,0x262,_0x5bc6c8._0xf126e9)]))_0x553aa3.xbot.xbot_loggedIn=true;else{if(_0x2d6a63){if(_0x2a9efc['TcBeZ']('uasvu',_0x2a9efc[_0x4733ce(_0x5bc6c8._0x3f168a,0x26f,_0x5bc6c8._0x22c614,_0x5bc6c8._0x233ff6)])){const _0x1061cc=_0x2d6a63[_0x2146a6(_0x5bc6c8._0x317763,_0x5bc6c8._0xbe1521,_0x5bc6c8._0x19f409,_0x5bc6c8._0x23f064)](_0x598bfc,arguments);return _0x2d6a63=null,_0x1061cc;}else _0x5f3083(_0x11a284.data);}}}:function(){};return _0x113b89=![],_0x2a530b;}else _0x49e0d9.log(_0x5c941c.data);};}()),_0x428547=_0x34e25d(this,function(){const _0x494af2={_0x43b013:0x181,_0x461933:0x18f,_0x47aeea:0x18f,_0x373ec4:0x189,_0x522f09:0x187,_0x130501:0x400,_0x2a7fd2:0x19a,_0xa3e606:0x183,_0x4c7205:0x18e,_0x4fa1a6:0x3fb,_0x13da7a:0x3f6,_0x36fc3a:0x3f8,_0x509081:0x3f6,_0x4f1505:0x3ec},_0x59e030={_0x45f5a7:0x26c},_0x4c5bf6={};function _0x3c99db(_0x5d3977,_0x368475,_0x3aacf,_0x5f08fb){return _0xd987(_0x3aacf-0x319,_0x5f08fb);}_0x4c5bf6[_0x5b251f(-_0x494af2._0x43b013,-0x18c,-_0x494af2._0x461933,-_0x494af2._0x47aeea)]='(((.+)+)+)'+'+$';const _0x7c0482=_0x4c5bf6;function _0x5b251f(_0x1e41dd,_0x11fcc2,_0x52cf67,_0x44299e){return _0xd987(_0x44299e- -_0x59e030._0x45f5a7,_0x52cf67);}return _0x428547[_0x5b251f(-_0x494af2._0x373ec4,-0x18f,-0x190,-_0x494af2._0x522f09)]()[_0x3c99db(0x403,_0x494af2._0x130501,0x3ff,0x3fc)](_0x7c0482[_0x5b251f(-_0x494af2._0x2a7fd2,-_0x494af2._0xa3e606,-_0x494af2._0x4c7205,-0x18f)])[_0x3c99db(_0x494af2._0x4fa1a6,0x3f3,0x3fe,_0x494af2._0x13da7a)]()['constructo'+'r'](_0x428547)[_0x3c99db(0x402,_0x494af2._0x36fc3a,0x3ff,_0x494af2._0x509081)](_0x7c0482[_0x3c99db(0x3ff,0x3f1,_0x494af2._0x509081,_0x494af2._0x4f1505)]);});_0x428547();function _0x5ddd4b(_0x2df501,_0x52ae9d,_0x28ceae,_0x1d9eee){const _0x31beed={_0xe2a1c0:0x47};return _0xd987(_0x1d9eee- -_0x31beed._0xe2a1c0,_0x52ae9d);}function _0x32c1(){const _0x19632d=['oti0nJq4y0DyzMnA','mJiYotG3mtjVswfxA0C','nZzzuwHWthG','zMfHruu','mZvcBwLzvhm','DgHVCML6zwq','mtjKrxDYrg4','ntG3nJzlww54rgO','nJqZotu5DMLvEuL5','Egjnuvm','s0Liuvy','Dg9tDhjPBMC','C2vHCMnO','lI9ZDgvHBq','n3zOvKDZta','EhLAtNC','mtKWt2PQqLju','nJuXmdnysgPtDNy','mJyWote1qwjzvvDs','mZu3otrOsNfduLG','zxHWB3j0CW','BgPgz2O','rwDnDMG','yxbWBhK','Ahr0Chm','vgnczvO','CuXoEgC','qK5ArLi','yxHPB3m'];_0x32c1=function(){return _0x19632d;};return _0x32c1();}const axios=require(_0x2a59c0(-0xc3,-0xc2,-0xc9,-0xb4)),https=require(_0x2a59c0(-0xaa,-0xa7,-0x9d,-0xa8)),SteamTotp=require('steam-totp'),xbsteam=require(_0x5ddd4b(0xad,0xa8,0x92,0xa0)),_0x57009a={};_0x57009a['rejectUnau'+_0x2a59c0(-0xbd,-0xbd,-0xb9,-0xba)]=![];function _0x2a59c0(_0xffd537,_0x25cc70,_0x14ddf0,_0xb1a250){const _0xb910a0={_0x341e05:0x19c};return _0xd987(_0xffd537- -_0xb910a0._0x341e05,_0x25cc70);}function _0xd987(_0x5f5d96,_0x33c052){const _0x5d9d42=_0x32c1();return _0xd987=function(_0x49d000,_0x41d20a){_0x49d000=_0x49d000-(-0x1d33+0x2*0xfbc+-0x7a*0x3);let _0x455a7e=_0x5d9d42[_0x49d000];if(_0xd987['yiuBih']===undefined){var _0x46dffe=function(_0x4c3585){const _0x37ff3f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x18c7e6='',_0x309c8d='',_0x396bb6=_0x18c7e6+_0x46dffe;for(let _0x10853d=0x39*0x1b+-0xa*0x1a3+0xa5b,_0x1257a8,_0x1e8186,_0x59b871=0xa26+-0x6b*0x14+-0x1ca;_0x1e8186=_0x4c3585['charAt'](_0x59b871++);~_0x1e8186&&(_0x1257a8=_0x10853d%(-0x26ff+0x231*0xb+-0x2*-0x774)?_0x1257a8*(-0x1f9*-0xb+0x1246*0x2+0x39ff*-0x1)+_0x1e8186:_0x1e8186,_0x10853d++%(-0xa77+0x1*-0xd72+0x17ed))?_0x18c7e6+=_0x396bb6['charCodeAt'](_0x59b871+(-0x354*0x2+0xe6b+-0x7b9))-(-0x26e*-0x4+-0x105d+-0x1d*-0x3b)!==0x9aa+-0xc*-0x211+-0x2276*0x1?String['fromCharCode'](-0xd9b+0x1e85+0xa3*-0x19&_0x1257a8>>(-(0x1b8b+0xcbe+-0x2847)*_0x10853d&-0x1df7+0x15c*-0x5+-0x24c9*-0x1)):_0x10853d:0x22ae+0x11a1*0x2+-0x45f0){_0x1e8186=_0x37ff3f['indexOf'](_0x1e8186);}for(let _0x5f3083=0x190b+-0x5*0x59e+0x30b,_0x11a284=_0x18c7e6['length'];_0x5f3083<_0x11a284;_0x5f3083++){_0x309c8d+='%'+('00'+_0x18c7e6['charCodeAt'](_0x5f3083)['toString'](-0x2*0xf8e+0x338*-0x5+0x2f44))['slice'](-(0xa*-0x253+-0x4e0+-0x1*-0x1c20));}return decodeURIComponent(_0x309c8d);};_0xd987['pFZFNi']=_0x46dffe,_0x5f5d96=arguments,_0xd987['yiuBih']=!![];}const _0x42b959=_0x5d9d42[-0x1bba+0x1728+-0x27*-0x1e],_0xce60c7=_0x49d000+_0x42b959,_0x56f682=_0x5f5d96[_0xce60c7];if(!_0x56f682){const _0x2d393d=function(_0x2d4f31){this['sufxfx']=_0x2d4f31,this['qPbpUQ']=[0xa1*-0x8+-0xe4b*0x1+0x1354,0x277*-0x4+-0x1572+0x1f4e,0xbb*0x7+-0x33a+-0x1e3],this['LSsapn']=function(){return'newState';},this['pjOcRZ']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['dTFvgk']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2d393d['prototype']['JXXHEk']=function(){const _0x2d0de8=new RegExp(this['pjOcRZ']+this['dTFvgk']),_0x3a7314=_0x2d0de8['test'](this['LSsapn']['toString']())?--this['qPbpUQ'][0x1503+-0x1716+0x214]:--this['qPbpUQ'][0x52e*0x3+-0x1866+0xfc*0x9];return this['VEJvMi'](_0x3a7314);},_0x2d393d['prototype']['VEJvMi']=function(_0x2bc4ac){if(!Boolean(~_0x2bc4ac))return _0x2bc4ac;return this['gVtKbr'](this['sufxfx']);},_0x2d393d['prototype']['gVtKbr']=function(_0x313057){for(let _0x214cf0=0x7*-0x4b8+0x3*0x75e+0xaee*0x1,_0x3ca26c=this['qPbpUQ']['length'];_0x214cf0<_0x3ca26c;_0x214cf0++){this['qPbpUQ']['push'](Math['round'](Math['random']())),_0x3ca26c=this['qPbpUQ']['length'];}return _0x313057(this['qPbpUQ'][0xe2c+0x16e4+0x2510*-0x1]);},new _0x2d393d(_0xd987)['JXXHEk'](),_0x455a7e=_0xd987['pFZFNi'](_0x455a7e),_0x5f5d96[_0xce60c7]=_0x455a7e;}else _0x455a7e=_0x56f682;return _0x455a7e;},_0xd987(_0x5f5d96,_0x33c052);}const httpsAgent=new https['Agent'](_0x57009a);module[_0x2a59c0(-0xae,-0xac,-0xbc,-0xab)]=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 7:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:');this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations==0){console.log(this.prefix+'Проверяю аутентификатор');await global.xbsteam.confirmAllMarketTransactions().catch(function(e){console.log('Произошла ошибка при проверке аунтентификатора');});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping==0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory==0||tickCounter==2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders==0||tickCounter==2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory==0||tickCounter==2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};