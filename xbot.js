(function(_0x1a0531,_0x539cd8){const _0x143add={_0x1f62a7:0x235,_0x51bf85:0x233,_0x1959e7:0x498,_0x95995a:0x492,_0x5b0abf:0x49c,_0x4c0f5b:0x49a,_0x5836ef:0x49c,_0x6691de:0x4a5,_0x26ce68:0x4af,_0x59269f:0x21d,_0x29c4c7:0x223,_0x44f259:0x214,_0x66d09d:0x21d,_0x40ea83:0x21d,_0x2a912e:0x22e,_0xefb4e7:0x223,_0x21a73e:0x4a1,_0x42c743:0x4a4,_0x1e7aaa:0x49b,_0x25836e:0x496,_0x466129:0x48d,_0x3d1746:0x48f,_0x4eafbb:0x490,_0x4d59a5:0x4ad,_0x3d5906:0x4ab,_0x31ed45:0x21e,_0x3079c8:0x22b},_0x2f54dd={_0x782cb4:0x84},_0x55e17f={_0x3944d3:0x2f8};function _0x1ab286(_0xf9b7b9,_0x1235d8,_0x3a165f,_0x2a528d){return _0x4c47(_0x3a165f-_0x55e17f._0x3944d3,_0x1235d8);}function _0x408536(_0x492bcd,_0x18c5c3,_0x4669a2,_0x33e61c){return _0x4c47(_0x33e61c-_0x2f54dd._0x782cb4,_0x492bcd);}const _0x4874e3=_0x1a0531();while(!![]){try{const _0x5d12d8=-parseInt(_0x408536(_0x143add._0x1f62a7,_0x143add._0x1f62a7,_0x143add._0x51bf85,_0x143add._0x51bf85))/(0x1*-0x182e+0x203*-0x11+-0x2f*-0x13e)*(-parseInt(_0x1ab286(_0x143add._0x1959e7,0x493,_0x143add._0x95995a,_0x143add._0x5b0abf))/(0x1f3c+0xd*0x7b+-0x2579))+-parseInt(_0x1ab286(_0x143add._0x4c0f5b,_0x143add._0x5836ef,_0x143add._0x6691de,_0x143add._0x26ce68))/(0x1e95*-0x1+0x1b7f+0x319)*(-parseInt(_0x408536(0x22a,_0x143add._0x59269f,_0x143add._0x29c4c7,0x225))/(0x4f*0x63+-0x2*0x11da+-0x1b9*-0x3))+parseInt(_0x408536(_0x143add._0x44f259,_0x143add._0x66d09d,_0x143add._0x44f259,_0x143add._0x40ea83))/(0x7eb+0x187*-0x15+-0x1*-0x182d)*(parseInt(_0x408536(_0x143add._0x2a912e,_0x143add._0xefb4e7,0x222,0x222))/(0x2*-0x673+-0x188+0xe74))+-parseInt(_0x408536(0x239,_0x143add._0x29c4c7,0x22d,0x22e))/(-0x1cf*-0x15+0x9c5*-0x3+-0x8a5)*(parseInt(_0x1ab286(_0x143add._0x21a73e,_0x143add._0x42c743,_0x143add._0x1e7aaa,0x491))/(0x98c+-0x1f84+-0x2*-0xb00))+parseInt(_0x1ab286(_0x143add._0x25836e,_0x143add._0x466129,_0x143add._0x3d1746,_0x143add._0x4eafbb))/(0x182b+0x11e1+-0x2a03)+-parseInt(_0x1ab286(_0x143add._0x4d59a5,0x4ae,0x4a1,_0x143add._0x3d5906))/(-0x1c8f+-0x1a4a+0x36e3)+-parseInt(_0x408536(_0x143add._0xefb4e7,_0x143add._0x31ed45,_0x143add._0x3079c8,0x224))/(-0x1ce4*0x1+-0x9a2+0xcdb*0x3);if(_0x5d12d8===_0x539cd8)break;else _0x4874e3['push'](_0x4874e3['shift']());}catch(_0x2f892f){_0x4874e3['push'](_0x4874e3['shift']());}}}(_0x3534,-0x4*-0x633e+0x5b16c+0x1a8e));function _0x2093f6(_0x2c0a00,_0x4a51c3,_0x373dc1,_0x49b2f0){const _0x55f1d5={_0x3e4872:0x1d8};return _0x4c47(_0x2c0a00- -_0x55f1d5._0x3e4872,_0x373dc1);}const _0x5344e3=(function(){const _0x3d489e={_0x27b221:0xbb,_0x32fcee:0xb0,_0x543bf5:0xba,_0x252c52:0xb3,_0x3bd0a7:0x181,_0x571dc6:0x17f,_0x2f7d85:0x181,_0x242468:0x99,_0x2ec045:0xa2,_0x11e238:0x96,_0x50e826:0x9a,_0x5ea9e8:0x8e,_0x419d29:0x9b,_0x2e88f2:0x99,_0x163395:0xa0},_0xff7327={_0x84ac81:0x99,_0x3b65dd:0xae,_0xcf0d7d:0xa3,_0x19a89e:0xaa,_0x38f214:0xa2},_0x1f8b77={_0x48feec:0x1b1,_0x4984df:0x489},_0x3de1d3={_0x1cd6df:0x100},_0x5d500d={};function _0x94fa5d(_0x5ca637,_0x2f8b56,_0x27fe5f,_0x2d3149){return _0x4c47(_0x5ca637- -0x1e,_0x2f8b56);}_0x5d500d[_0x46c3f1(_0x3d489e._0x27b221,_0x3d489e._0x32fcee,_0x3d489e._0x543bf5,_0x3d489e._0x252c52)]=function(_0x3db0b0,_0x5ea6a6){return _0x3db0b0===_0x5ea6a6;},_0x5d500d[_0x94fa5d(_0x3d489e._0x3bd0a7,_0x3d489e._0x571dc6,_0x3d489e._0x2f7d85,0x181)]='rNijw',_0x5d500d['YdIda']=_0x46c3f1(_0x3d489e._0x242468,_0x3d489e._0x2ec045,_0x3d489e._0x11e238,_0x3d489e._0x50e826),_0x5d500d[_0x46c3f1(_0x3d489e._0x5ea9e8,_0x3d489e._0x419d29,_0x3d489e._0x2e88f2,_0x3d489e._0x163395)]='gSxEh';const _0x20c38f=_0x5d500d;let _0x551773=!![];function _0x46c3f1(_0x409055,_0x58761b,_0x7f2670,_0x1e1d70){return _0x4c47(_0x58761b- -_0x3de1d3._0x1cd6df,_0x1e1d70);}return function(_0x2e2d42,_0x4a00f1){const _0x37a1e9={_0x3c5a4f:0x219,_0xad12a9:0x21f,_0x316709:0x223,_0x7d41ef:0x455,_0x5ce2f9:0x457,_0xe24ddf:0x46c,_0x52dbcd:0x460},_0x13c8cb={_0x8d2cc4:0x168,_0x4c506e:0x70},_0x52b023={_0x4106ca:0x16d,_0x4e146c:0x154,_0x545eb5:0x6e};function _0xbc8372(_0x5116d1,_0x2ca7ac,_0x46e4a6,_0x13464c){return _0x46c3f1(_0x5116d1-_0x1f8b77._0x48feec,_0x2ca7ac-_0x1f8b77._0x4984df,_0x46e4a6-0x13,_0x13464c);}function _0x554618(_0x1504be,_0x8d772f,_0x58f6a9,_0x48d201){return _0x46c3f1(_0x1504be-_0x52b023._0x4106ca,_0x8d772f- -_0x52b023._0x4e146c,_0x58f6a9-_0x52b023._0x545eb5,_0x1504be);}if(_0x20c38f[_0x554618(-_0xff7327._0x84ac81,-0xa4,-_0xff7327._0x3b65dd,-0x97)](_0x20c38f['OWMjT'],_0x554618(-_0xff7327._0xcf0d7d,-0xb0,-_0xff7327._0x19a89e,-_0xff7327._0x38f214)))_0x242a32(_0x4492e2);else{const _0x45452a=_0x551773?function(){const _0x315403={_0x3b8210:0x68};function _0x3346de(_0x567e0a,_0xe5bc74,_0xe4a014,_0x535a9b){return _0xbc8372(_0x567e0a-_0x315403._0x3b8210,_0x535a9b- -0xd4,_0xe4a014-0xc2,_0xe4a014);}function _0x5b0b14(_0x1bf186,_0xec87b4,_0x3a7ce8,_0x2631e8){return _0x554618(_0x3a7ce8,_0xec87b4- -_0x13c8cb._0x8d2cc4,_0x3a7ce8-_0x13c8cb._0x4c506e,_0x2631e8-0x11f);}if(_0x4a00f1){if(_0x20c38f['BkfyV'](_0x20c38f['mvKXV'],_0x20c38f[_0x5b0b14(-_0x37a1e9._0x3c5a4f,-_0x37a1e9._0xad12a9,-0x222,-_0x37a1e9._0x316709)]))_0x4aaa82.log(_0x2bc006.xbot.prefix+_0x10cc10+' updated');else{const _0xfb4004=_0x4a00f1[_0x3346de(_0x37a1e9._0x7d41ef,_0x37a1e9._0x5ce2f9,_0x37a1e9._0xe24ddf,_0x37a1e9._0x52dbcd)](_0x2e2d42,arguments);return _0x4a00f1=null,_0xfb4004;}}}:function(){};return _0x551773=![],_0x45452a;}};}()),_0x3f3d83=_0x5344e3(this,function(){const _0x2881d5={_0x4f1ffc:0xf7,_0x4c64b9:0xff,_0x17f35b:0xf5,_0x50b765:0xf9,_0xf10d57:0xfa,_0x35a6cd:0xf2,_0x480428:0xff,_0x4bf42e:0x107,_0x6d8d1a:0xfc,_0x982f43:0xec,_0x869e74:0xe7,_0x2d32fd:0xef,_0x2e0e5d:0xf4,_0x2bcb24:0xeb,_0x2758cc:0x491,_0x3b1100:0x49c,_0x2cada8:0x4a5,_0x4ac9a8:0x49b},_0x8f575f={_0x3b6c75:0xb2},_0x139fd9={_0x2b1a94:0x2ef};function _0x153dbb(_0x2eaebc,_0x10bd0d,_0x4cd140,_0xed0d66){return _0x4c47(_0xed0d66-_0x139fd9._0x2b1a94,_0x10bd0d);}function _0x194d01(_0x581652,_0xe5a18c,_0x570098,_0x4a06a7){return _0x4c47(_0x570098- -_0x8f575f._0x3b6c75,_0x4a06a7);}const _0x1ad1c7={};_0x1ad1c7['MWJpT']='(((.+)+)+)'+'+$';const _0x11f854=_0x1ad1c7;return _0x3f3d83[_0x194d01(_0x2881d5._0x4f1ffc,_0x2881d5._0x4c64b9,_0x2881d5._0x17f35b,_0x2881d5._0x50b765)]()[_0x194d01(0x105,0xf5,_0x2881d5._0xf10d57,_0x2881d5._0x35a6cd)](_0x194d01(0x108,0x109,_0x2881d5._0x480428,_0x2881d5._0x4bf42e)+'+$')[_0x194d01(_0x2881d5._0x6d8d1a,_0x2881d5._0x982f43,0xf5,0xe8)]()[_0x194d01(_0x2881d5._0x869e74,_0x2881d5._0x2d32fd,_0x2881d5._0x2e0e5d,_0x2881d5._0x2bcb24)+'r'](_0x3f3d83)[_0x153dbb(_0x2881d5._0x2758cc,_0x2881d5._0x3b1100,_0x2881d5._0x2cada8,_0x2881d5._0x4ac9a8)](_0x11f854['MWJpT']);});_0x3f3d83();function _0x4c47(_0x45e699,_0x3cee5f){const _0x3e2b05=_0x3534();return _0x4c47=function(_0x26bf49,_0x5e9e92){_0x26bf49=_0x26bf49-(0x53*-0x61+0x1*-0xfa3+0x30ad*0x1);let _0x5bede0=_0x3e2b05[_0x26bf49];if(_0x4c47['WHGmis']===undefined){var _0x84559f=function(_0x59fcd4){const _0x2dbc48='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5f52cf='',_0x2b99de='',_0x1d11fe=_0x5f52cf+_0x84559f;for(let _0x398c81=0x13*0x15+0x1*-0x25e5+0x2*0x122b,_0x4a674c,_0x982e54,_0x55a3ab=0x1ffa*0x1+-0x22cd+0x2d3;_0x982e54=_0x59fcd4['charAt'](_0x55a3ab++);~_0x982e54&&(_0x4a674c=_0x398c81%(0x9d2*0x3+0x2185*0x1+-0x255*0x1b)?_0x4a674c*(0x1731*-0x1+0xc60+0xb11)+_0x982e54:_0x982e54,_0x398c81++%(0x23ee+-0x15*-0x1+-0x23ff))?_0x5f52cf+=_0x1d11fe['charCodeAt'](_0x55a3ab+(0x6f*0x25+0x1109+0x1*-0x210a))-(0x2356+-0xa54+0x1*-0x18f8)!==0x4e5+-0x5*-0x538+-0x1*0x1efd?String['fromCharCode'](0x54f*-0x2+-0x2*0x112d+0x1*0x2df7&_0x4a674c>>(-(-0x2c2*0xe+-0xbbc+0x192d*0x2)*_0x398c81&-0xa5b*0x2+0x37+0x1*0x1485)):_0x398c81:0x126+0x98*-0x30+0x185*0x12){_0x982e54=_0x2dbc48['indexOf'](_0x982e54);}for(let _0x274e5e=0x137b+0x291*-0x7+-0x184,_0x28879e=_0x5f52cf['length'];_0x274e5e<_0x28879e;_0x274e5e++){_0x2b99de+='%'+('00'+_0x5f52cf['charCodeAt'](_0x274e5e)['toString'](-0x197d+-0x2461+0x2*0x1ef7))['slice'](-(-0x17b1+0x4fa+0x12b9));}return decodeURIComponent(_0x2b99de);};_0x4c47['YLYAKH']=_0x84559f,_0x45e699=arguments,_0x4c47['WHGmis']=!![];}const _0x4e7448=_0x3e2b05[0x1c23+-0xbd3+-0x1050],_0x372c8b=_0x26bf49+_0x4e7448,_0x508852=_0x45e699[_0x372c8b];if(!_0x508852){const _0xcbf77f=function(_0x4b98e0){this['hAhjpY']=_0x4b98e0,this['ggbCLo']=[0x19f1+0x516+-0x1f06,-0x920+-0x28*-0xa9+-0x1148,-0x151*-0xd+-0x2*-0x59f+0x40d*-0x7],this['YizRBb']=function(){return'newState';},this['GkcDbZ']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['SnsIeS']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0xcbf77f['prototype']['rTvaog']=function(){const _0x53e615=new RegExp(this['GkcDbZ']+this['SnsIeS']),_0x3cf646=_0x53e615['test'](this['YizRBb']['toString']())?--this['ggbCLo'][0x1ee5+-0x20d2+0x1*0x1ee]:--this['ggbCLo'][-0xc58+0xf*0x23d+-0x153b];return this['MzYsDq'](_0x3cf646);},_0xcbf77f['prototype']['MzYsDq']=function(_0x478815){if(!Boolean(~_0x478815))return _0x478815;return this['sIodqv'](this['hAhjpY']);},_0xcbf77f['prototype']['sIodqv']=function(_0x5097b4){for(let _0xb2b4f7=-0x1*0x1a05+-0x1d*0xfa+0x3657,_0x375bad=this['ggbCLo']['length'];_0xb2b4f7<_0x375bad;_0xb2b4f7++){this['ggbCLo']['push'](Math['round'](Math['random']())),_0x375bad=this['ggbCLo']['length'];}return _0x5097b4(this['ggbCLo'][0x241b+0x263f*-0x1+0x224]);},new _0xcbf77f(_0x4c47)['rTvaog'](),_0x5bede0=_0x4c47['YLYAKH'](_0x5bede0),_0x45e699[_0x372c8b]=_0x5bede0;}else _0x5bede0=_0x508852;return _0x5bede0;},_0x4c47(_0x45e699,_0x3cee5f);}const axios=require('axios');function _0x14546f(_0x40b031,_0x47131f,_0x15a3e8,_0x20c3dc){const _0xe1ad66={_0x190794:0x2f1};return _0x4c47(_0x47131f-_0xe1ad66._0x190794,_0x20c3dc);}function _0x3534(){const _0x4a48ed=['DgHVCML6zwq','ntm5mZu3mg1Vz3vfza','n3vZruP1yq','yxbWBhK','C2vHCMnO','ntu5mJu0CuDOAe56','qwDLBNq','mwXmq05vsq','qMTMEvy','kcGOlISPkYKRkq','oteWndeZC0vzAw1y','C3rLyw0TDg90Ca','mZG5nJC0mhrJu1viva','mtG0mtKWnLDpELjbvq','t1DnALq','zxHWB3j0CW','wwrjzge','nKTiAMLuvG','Bxzlwfy','mZKZmdq5ogjizLLSCW','nfH6yuP0DG','u0jfrxm','ndG3nZqZmKzpAfb0ua','BxrAD1a','Ahr0Chm','y29UC3rYDwn0BW','Dg9tDhjPBMC'];_0x3534=function(){return _0x4a48ed;};return _0x3534();}const https=require(_0x2093f6(-0x33,-0x31,-0x28,-0x3a)),SteamTotp=require(_0x2093f6(-0x40,-0x38,-0x4d,-0x33)),xbsteam=require('./steam'),_0x42707e={};_0x42707e['rejectUnau'+_0x14546f(0x496,0x499,0x4a3,0x48e)]=![];const httpsAgent=new https[(_0x14546f(0x4a5,0x49f,0x4ab,0x49e))](_0x42707e);module[_0x2093f6(-0x3c,-0x43,-0x3e,-0x3c)]=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 7:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:');this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations==0){console.log(this.prefix+'Проверяю аутентификатор');await global.xbsteam.confirmAllMarketTransactions().catch(function(e){console.log('Произошла ошибка при проверке аунтентификатора');});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping==0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory==0||tickCounter==2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders==0||tickCounter==2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory==0||tickCounter==2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};