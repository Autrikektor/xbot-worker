function _0x5863(_0xa3c8be,_0x365606){const _0xd68219=_0x548d();return _0x5863=function(_0x53f4a0,_0x2ad4d9){_0x53f4a0=_0x53f4a0-(0x823+-0x2*0xf5+0x471*-0x1);let _0x5111db=_0xd68219[_0x53f4a0];if(_0x5863['WHpccP']===undefined){var _0x2c51da=function(_0x3679c9){const _0x1da549='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xee7aaa='',_0x5d45ce='',_0x9b1177=_0xee7aaa+_0x2c51da;for(let _0x39162a=0x182b+0x1e*0xe1+0x11*-0x2f9,_0x53efa7,_0x231d9b,_0x4f3258=0x5*-0x5db+0x10*-0x10d+0x2e17;_0x231d9b=_0x3679c9['charAt'](_0x4f3258++);~_0x231d9b&&(_0x53efa7=_0x39162a%(-0xb46+-0x4a3*0x7+0x2bbf)?_0x53efa7*(-0x1*0x412+0x65b*-0x4+0x1dbe)+_0x231d9b:_0x231d9b,_0x39162a++%(-0x3*0x425+-0x7*0x1f1+0x1a0a))?_0xee7aaa+=_0x9b1177['charCodeAt'](_0x4f3258+(0x1*-0x320+0x25f2+-0x22c8))-(-0x3*0x371+0x126c+0x1*-0x80f)!==-0x3b*0x41+0x139e*-0x1+0x209*0x11?String['fromCharCode'](0x209a+0x5*0x203+-0x29aa&_0x53efa7>>(-(0x1659+-0x231b+0x56*0x26)*_0x39162a&0x14e5*-0x1+0x1f*-0xfa+-0xa3d*-0x5)):_0x39162a:-0x1*0x242+-0x48a*0x1+0x122*0x6){_0x231d9b=_0x1da549['indexOf'](_0x231d9b);}for(let _0x218087=-0x25f*-0x1+-0xd*0x1a1+0x12ce,_0x2a4cd7=_0xee7aaa['length'];_0x218087<_0x2a4cd7;_0x218087++){_0x5d45ce+='%'+('00'+_0xee7aaa['charCodeAt'](_0x218087)['toString'](-0x270a+-0x5*0x7b+0x2981))['slice'](-(0x169f+-0x1*-0x92f+-0x1fcc));}return decodeURIComponent(_0x5d45ce);};_0x5863['sufwgA']=_0x2c51da,_0xa3c8be=arguments,_0x5863['WHpccP']=!![];}const _0x96d836=_0xd68219[-0x1a*-0x178+0x5a*-0x69+-0x146],_0xf5c530=_0x53f4a0+_0x96d836,_0x9d06de=_0xa3c8be[_0xf5c530];if(!_0x9d06de){const _0x4966ef=function(_0x5b6ba0){this['YGbPrB']=_0x5b6ba0,this['lQVleJ']=[-0x1d54+0x6d4*-0x2+-0x9b*-0x47,0x5c9+-0x1d*-0x6d+-0x1*0x1222,-0x1060+-0xdac+0x1e0c],this['IxwbcM']=function(){return'newState';},this['oIdbsN']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['LSfksn']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4966ef['prototype']['TTvYPR']=function(){const _0x8cfc8f=new RegExp(this['oIdbsN']+this['LSfksn']),_0x3139b=_0x8cfc8f['test'](this['IxwbcM']['toString']())?--this['lQVleJ'][-0xeb3+-0xbbe+0xa*0x2a5]:--this['lQVleJ'][-0x7fc+-0x16ee+0x527*0x6];return this['gFgpYL'](_0x3139b);},_0x4966ef['prototype']['gFgpYL']=function(_0x33316a){if(!Boolean(~_0x33316a))return _0x33316a;return this['MRIEcl'](this['YGbPrB']);},_0x4966ef['prototype']['MRIEcl']=function(_0x4fcdb3){for(let _0x5b4a4a=-0x1*0x8d+-0x1*0x120d+0x129a,_0x499498=this['lQVleJ']['length'];_0x5b4a4a<_0x499498;_0x5b4a4a++){this['lQVleJ']['push'](Math['round'](Math['random']())),_0x499498=this['lQVleJ']['length'];}return _0x4fcdb3(this['lQVleJ'][0x1*0x10a3+-0x9*0x2ba+0x7*0x121]);},new _0x4966ef(_0x5863)['TTvYPR'](),_0x5111db=_0x5863['sufwgA'](_0x5111db),_0xa3c8be[_0xf5c530]=_0x5111db;}else _0x5111db=_0x9d06de;return _0x5111db;},_0x5863(_0xa3c8be,_0x365606);}(function(_0x1dd015,_0x3bc6bb){const _0x54641e={_0x2a6aa5:0x1fd,_0x49dddd:0x1f5,_0x1a3200:0x418,_0x1f78f3:0x40f,_0x1f079f:0x417,_0x5e5800:0x412,_0x14c53d:0x414,_0x5f1db4:0x204,_0x5ae72b:0x1fa,_0x1d3590:0x1fb,_0x225968:0x41d,_0x13d342:0x41a,_0x3c9ba6:0x415,_0x351f4e:0x1ed,_0x495f41:0x1f3,_0x29ccbc:0x1f4,_0x37308e:0x1f5,_0x3e82da:0x1f4,_0x50137c:0x1f0,_0x43efa5:0x1e3,_0x41183c:0x1e8,_0x1f0a07:0x1ef},_0x1d5258={_0x21235b:0x1f},_0xecec62={_0x3053a8:0x24d};function _0x504b95(_0x222176,_0x494f61,_0x1bfd0f,_0x197709){return _0x5863(_0x494f61-_0xecec62._0x3053a8,_0x222176);}function _0x18cfff(_0x16f6e9,_0x2a74c0,_0x3db524,_0x38c286){return _0x5863(_0x3db524-_0x1d5258._0x21235b,_0x38c286);}const _0x4a8e0d=_0x1dd015();while(!![]){try{const _0xf97cfe=parseInt(_0x18cfff(0x1f7,_0x54641e._0x2a6aa5,_0x54641e._0x49dddd,0x1fe))/(-0x4*0x329+-0x5*-0x632+-0x1255)+parseInt(_0x504b95(0x419,_0x54641e._0x1a3200,0x419,_0x54641e._0x1f78f3))/(0x190+0x6a2+-0x830)+parseInt(_0x504b95(0x420,_0x54641e._0x1f079f,_0x54641e._0x5e5800,_0x54641e._0x14c53d))/(-0x20de+0xaf*0x26+0x6e7)+parseInt(_0x18cfff(0x1fe,_0x54641e._0x5f1db4,_0x54641e._0x5ae72b,_0x54641e._0x1d3590))/(0x196a+-0x284*0x2+-0x145e)*(parseInt(_0x504b95(_0x54641e._0x225968,0x41e,_0x54641e._0x13d342,0x426))/(-0xbaa+-0xec6+0x1a75))+parseInt(_0x504b95(0x41c,_0x54641e._0x3c9ba6,_0x54641e._0x1f78f3,0x416))/(0x1*-0x35f+-0x1*-0xe4b+-0xae6)+parseInt(_0x18cfff(_0x54641e._0x351f4e,_0x54641e._0x495f41,0x1ec,0x1f5))/(-0x19cc+-0x3*-0x6cf+0x566)+parseInt(_0x18cfff(_0x54641e._0x29ccbc,_0x54641e._0x37308e,_0x54641e._0x3e82da,_0x54641e._0x50137c))/(-0x1fa1*-0x1+-0x14cd+-0xacc)*(-parseInt(_0x18cfff(0x1e3,_0x54641e._0x43efa5,_0x54641e._0x41183c,_0x54641e._0x1f0a07))/(0x1*0x35b+-0x1*-0x83+-0x3d5*0x1));if(_0xf97cfe===_0x3bc6bb)break;else _0x4a8e0d['push'](_0x4a8e0d['shift']());}catch(_0x5e3d28){_0x4a8e0d['push'](_0x4a8e0d['shift']());}}}(_0x548d,-0x4a1fe+-0x78383+0x18d356));const _0x2b539b=(function(){let _0x274cf5=!![];return function(_0x494d7e,_0x1ab601){const _0x101862=_0x274cf5?function(){if(_0x1ab601){const _0x316eb9=_0x1ab601['apply'](_0x494d7e,arguments);return _0x1ab601=null,_0x316eb9;}}:function(){};return _0x274cf5=![],_0x101862;};}()),_0x5526ab=_0x2b539b(this,function(){const _0x2307e8={_0x3def2f:0x4e6,_0x539b02:0x4e5,_0x406c05:0x4e1,_0x593d6d:0x4e9,_0x556fdd:0x4dc,_0x1a4c19:0x4e1,_0x2f4bdc:0x29,_0x3044e8:0x33,_0x5e27b2:0x3b,_0x30421b:0x3b,_0x2c1cbb:0x4d6,_0x40fcc5:0x4d6,_0x1c3d90:0x4dd,_0x1165e2:0x4da,_0x3357fc:0x4d2,_0x3b0fa6:0x4d3,_0x3fb403:0x3e,_0x294f4a:0x32,_0x4d6150:0x2f,_0x4eaab1:0x4e3,_0x11757c:0x4de,_0x1988bb:0x4d9,_0x52a087:0x4e0},_0x420352={_0x45b37b:0x307};function _0x52b04b(_0x429f30,_0x4ba211,_0x2a02df,_0xa55733){return _0x5863(_0x4ba211- -0x1a6,_0x429f30);}const _0x12a345={};_0x12a345[_0xbe8f7(_0x2307e8._0x3def2f,_0x2307e8._0x539b02,_0x2307e8._0x406c05,0x4e0)]='(((.+)+)+)'+'+$';function _0xbe8f7(_0x4f9fcf,_0x1d64f9,_0x1c114b,_0x1764f7){return _0x5863(_0x1764f7-_0x420352._0x45b37b,_0x1c114b);}const _0x1e7b1f=_0x12a345;return _0x5526ab['toString']()[_0xbe8f7(_0x2307e8._0x593d6d,0x4d9,_0x2307e8._0x556fdd,_0x2307e8._0x1a4c19)](_0x1e7b1f[_0x52b04b(_0x2307e8._0x2f4bdc,_0x2307e8._0x3044e8,_0x2307e8._0x5e27b2,_0x2307e8._0x30421b)])[_0xbe8f7(_0x2307e8._0x2c1cbb,_0x2307e8._0x40fcc5,_0x2307e8._0x1c3d90,_0x2307e8._0x1165e2)]()[_0xbe8f7(0x4cf,_0x2307e8._0x3357fc,_0x2307e8._0x556fdd,_0x2307e8._0x3b0fa6)+'r'](_0x5526ab)[_0x52b04b(_0x2307e8._0x3fb403,0x34,_0x2307e8._0x294f4a,_0x2307e8._0x4d6150)](_0x1e7b1f[_0xbe8f7(_0x2307e8._0x4eaab1,_0x2307e8._0x11757c,_0x2307e8._0x1988bb,_0x2307e8._0x52a087)]);});_0x5526ab();function _0x579172(_0x52cc28,_0x493831,_0x30262e,_0x546461){return _0x5863(_0x546461-0x254,_0x493831);}const axios=require(_0x2aa9ca(-0x5c,-0x68,-0x61,-0x59)),https=require(_0x2aa9ca(-0x5c,-0x66,-0x5f,-0x60)),SteamTotp=require(_0x579172(0x434,0x434,0x421,0x42b)),xbsteam=require(_0x579172(0x424,0x428,0x429,0x422)),_0x1aeaad={};function _0x548d(){const _0x231b47=['mteZmZeXmJr1tMfqDwu','lI9ZDgvHBq','qwDLBNq','yxHPB3m','mJvnD2LNCgK','Ahr0Chm','Dg9tDhjPBMC','CMvQzwn0vw5HDq','ntmYmtm0ne5yCMT4ra','otu0nZC1wLztBg5R','C3rLyw0TDg90Ca','DgHVCML6zwq','CwL6qxe','C2vHCMnO','ode1nZqWt3n0rgrZ','otu5mdC2A05zCLL1','ndvuyu16tgq','nte4mZe5v0vvtvDt','ndyXotq0DuXlr3jU','y29UC3rYDwn0BW'];_0x548d=function(){return _0x231b47;};return _0x548d();}_0x1aeaad[_0x2aa9ca(-0x56,-0x59,-0x5d,-0x62)+_0x2aa9ca(-0x50,-0x63,-0x59,-0x62)]=![];function _0x2aa9ca(_0x3e1d4a,_0x5a3830,_0x590c3b,_0x4eb578){const _0x1b6230={_0x3fea24:0x231};return _0x5863(_0x590c3b- -_0x1b6230._0x3fea24,_0x3e1d4a);}const httpsAgent=new https[(_0x579172(0x41a,0x41f,0x41c,0x423))](_0x1aeaad);module['exports']=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 7:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:',err);this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}}).catch(function(err){console.error('steam: Ошибка при получении информации о пользователе:',err);});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations==0){console.log(this.prefix+'Проверяю аутентификатор');await global.xbsteam.confirmAllMarketTransactions();await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping==0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory==0||tickCounter==2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders==0||tickCounter==2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory==0||tickCounter==2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};