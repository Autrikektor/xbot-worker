(function(_0x56bde6,_0x1d3df1){const _0x3cee9a={_0x52609b:0x2a2,_0x4054f5:0x2a1,_0x57ee8d:0x294,_0x5b9607:0x296,_0xf81f51:0x29d,_0x305768:0x292,_0x31bbfd:0x2a0,_0x39dc60:0x2a2,_0x47adc4:0x29b,_0x504d68:0x125,_0x460448:0x121,_0x3f7977:0x11f,_0x106bde:0x120,_0x5e0ab2:0x124,_0x5cfb22:0x115,_0x38fcf0:0x2a8,_0x3f268f:0x2a8,_0x2fad26:0x2aa,_0x2d0881:0x2a7,_0xab75a9:0x2a0,_0x563a3a:0x2a6,_0x1c1fe4:0x108,_0xc6ace2:0x107},_0x3fe13d={_0x2ab74b:0x228},_0x3d05df={_0x25e4bc:0x192},_0x552e27=_0x56bde6();function _0x2e7fb2(_0x22e3df,_0x54de9f,_0x961e19,_0x41ce11){return _0x30db(_0x54de9f- -_0x3d05df._0x25e4bc,_0x961e19);}function _0xbf65b3(_0x3d2ff7,_0x53a3b4,_0x5818c6,_0x503b47){return _0x30db(_0x53a3b4-_0x3fe13d._0x2ab74b,_0x5818c6);}while(!![]){try{const _0x5d41d8=parseInt(_0xbf65b3(_0x3cee9a._0x52609b,_0x3cee9a._0x4054f5,_0x3cee9a._0x57ee8d,_0x3cee9a._0x5b9607))/(-0x153f+-0x1edd+0x341d)+-parseInt(_0xbf65b3(_0x3cee9a._0xf81f51,_0x3cee9a._0x305768,0x28a,0x28c))/(0x185e*-0x1+0xb*0x65+0x1409)+parseInt(_0xbf65b3(_0x3cee9a._0x31bbfd,_0x3cee9a._0x39dc60,0x2a4,_0x3cee9a._0x47adc4))/(-0x43e*0x3+0x247d*0x1+-0x5f0*0x4)*(parseInt(_0x2e7fb2(-0x120,-_0x3cee9a._0x504d68,-_0x3cee9a._0x460448,-0x120))/(-0x1ad4+0xa13+0x10c5))+parseInt(_0x2e7fb2(-_0x3cee9a._0x3f7977,-_0x3cee9a._0x106bde,-_0x3cee9a._0x5e0ab2,-_0x3cee9a._0x5cfb22))/(0x10*0x201+0x2155*-0x1+-0x37*-0x6)+parseInt(_0xbf65b3(_0x3cee9a._0x38fcf0,_0x3cee9a._0x3f268f,_0x3cee9a._0x2fad26,_0x3cee9a._0x2d0881))/(-0xa5*0x8+0x22a2+0xd*-0x244)+parseInt(_0xbf65b3(0x29a,_0x3cee9a._0xab75a9,_0x3cee9a._0x52609b,_0x3cee9a._0x563a3a))/(0x2545+0xdf6*0x2+0x36e*-0x13)+-parseInt(_0x2e7fb2(-_0x3cee9a._0x1c1fe4,-0x113,-_0x3cee9a._0xc6ace2,-0x11a))/(-0x1c05*-0x1+0x1*0x47f+-0x207c);if(_0x5d41d8===_0x1d3df1)break;else _0x552e27['push'](_0x552e27['shift']());}catch(_0x590e2f){_0x552e27['push'](_0x552e27['shift']());}}}(_0x4db9,-0x84d26+-0x4*-0x1612d+0x9fd44));const _0x5f0248=(function(){const _0x52f136={_0x5a91e6:0x3af,_0x4b473d:0x3b8,_0x1a2da6:0x3ac,_0x29b65d:0x3ad,_0x7d27f0:0x3b0,_0x1b8566:0x3a4,_0x55a6e5:0x235,_0x8b95c0:0x22a,_0x4d26b3:0x21d,_0x5c547b:0x22d,_0x413f2d:0x239,_0x1c6cdc:0x238,_0x2bb1d6:0x23b,_0x424be9:0x3ad,_0x544243:0x3a3,_0x281224:0x3a5},_0x41e082={_0x2c4c21:0x2dc,_0x6cce1d:0x2f1,_0x3c1e7b:0x2e4,_0x3685f7:0x2e1,_0x26f7e3:0x2e9,_0x4f663e:0x2f6,_0x43b8ac:0x2ea,_0x5e4ef6:0x2f2,_0x500ff8:0xfc,_0x6af0a3:0x109,_0xc1fc56:0xf1,_0x2d2a4c:0xf1,_0x2a5537:0xf2,_0x595e77:0xe7,_0x20321d:0x2e6,_0x450d4f:0x2f5,_0x57dd1c:0x2fd},_0x3a40ec={_0x27164a:0x103,_0x48c914:0xf7,_0x66afed:0x2de,_0x3b1b7e:0x2e3,_0x29b689:0x2ec,_0x404008:0x2dc,_0x3794ad:0x2e6,_0xe36294:0x2de},_0x5805b7={_0x32f69e:0x168,_0x3a3d82:0x155},_0x1f6301={_0x55dd29:0x29f};function _0x2866d7(_0x95d001,_0x3f5373,_0x95c9bf,_0x2c9cf4){return _0x30db(_0x95c9bf-0x32f,_0x95d001);}const _0x15947a={};function _0x3306a4(_0x525c90,_0x13551b,_0x22640e,_0x2d5daa){return _0x30db(_0x13551b- -_0x1f6301._0x55dd29,_0x2d5daa);}_0x15947a[_0x2866d7(_0x52f136._0x5a91e6,_0x52f136._0x4b473d,_0x52f136._0x1a2da6,_0x52f136._0x29b65d)]=function(_0x1d4226,_0x8e1d98){return _0x1d4226!==_0x8e1d98;},_0x15947a[_0x2866d7(0x3a5,_0x52f136._0x29b65d,_0x52f136._0x7d27f0,_0x52f136._0x1b8566)]=_0x3306a4(-_0x52f136._0x55a6e5,-_0x52f136._0x8b95c0,-_0x52f136._0x4d26b3,-_0x52f136._0x5c547b),_0x15947a[_0x3306a4(-_0x52f136._0x413f2d,-0x233,-_0x52f136._0x1c6cdc,-_0x52f136._0x2bb1d6)]=function(_0x15756e,_0x4fee9c){return _0x15756e!==_0x4fee9c;},_0x15947a[_0x2866d7(_0x52f136._0x424be9,_0x52f136._0x544243,_0x52f136._0x281224,0x3ae)]='YWNJS';const _0x256cea=_0x15947a;let _0x544189=!![];return function(_0x3c401b,_0x571434){const _0x2a066a={_0x4a47e5:0x164,_0x6da2b8:0xf5,_0x42a103:0x6},_0x35c0de={_0x3beaef:0x121,_0x46dd50:0x17},_0x426e17={_0x2eff6f:0x47,_0x3afcf1:0x2};function _0x3e4433(_0x5e0717,_0x442e51,_0x4418a9,_0x310e34){return _0x3306a4(_0x5e0717-_0x426e17._0x2eff6f,_0x4418a9- -0xc6,_0x4418a9-_0x426e17._0x3afcf1,_0x310e34);}const _0x1603e5={'yrKkG':function(_0x340e14,_0xc34087){function _0x34a273(_0x62f110,_0x51599b,_0x747898,_0x166aab){return _0x30db(_0x166aab- -0x1dc,_0x747898);}return _0x256cea[_0x34a273(-_0x5805b7._0x32f69e,-_0x5805b7._0x3a3d82,-0x16a,-0x15f)](_0x340e14,_0xc34087);},'BVrVa':_0x256cea[_0x3e4433(-_0x41e082._0x2c4c21,-_0x41e082._0x6cce1d,-_0x41e082._0x3c1e7b,-_0x41e082._0x3685f7)],'LVPnc':_0x3e4433(-_0x41e082._0x26f7e3,-_0x41e082._0x4f663e,-_0x41e082._0x43b8ac,-_0x41e082._0x5e4ef6)};function _0x443427(_0x4560c9,_0x1f2b82,_0x97373e,_0x434b29){return _0x2866d7(_0x434b29,_0x1f2b82-0x1da,_0x97373e- -0x497,_0x434b29-0x1ad);}if(_0x256cea[_0x443427(-_0x41e082._0x500ff8,-_0x41e082._0x6af0a3,-_0x41e082._0x500ff8,-0xf1)](_0x256cea[_0x443427(-_0x41e082._0xc1fc56,-_0x41e082._0x2d2a4c,-_0x41e082._0x2a5537,-_0x41e082._0x595e77)],_0x256cea[_0x3e4433(-_0x41e082._0x20321d,-_0x41e082._0x450d4f,-0x2ef,-_0x41e082._0x57dd1c)]))_0x4d9534.xbot.sendJobResult(_0x438034,'true',_0x1040f8);else{const _0x4c67ef=_0x544189?function(){function _0x1fef63(_0x42f1b7,_0x58137a,_0x3f6d6d,_0x4a508d){return _0x3e4433(_0x42f1b7-0x144,_0x58137a-_0x35c0de._0x3beaef,_0x3f6d6d-_0x35c0de._0x46dd50,_0x58137a);}function _0x29c70b(_0x5edc77,_0x3a57fc,_0x37b641,_0xf5cd3d){return _0x443427(_0x5edc77-_0x2a066a._0x4a47e5,_0x3a57fc-_0x2a066a._0x6da2b8,_0x37b641- -_0x2a066a._0x42a103,_0x3a57fc);}if(_0x1603e5[_0x29c70b(-_0x3a40ec._0x27164a,-_0x3a40ec._0x48c914,-0xff,-0xf6)](_0x1603e5[_0x1fef63(-0x2e6,-_0x3a40ec._0x66afed,-_0x3a40ec._0x3b1b7e,-_0x3a40ec._0x29b689)],_0x1603e5['LVPnc'])){if(_0x571434){const _0x513fe4=_0x571434[_0x1fef63(-_0x3a40ec._0x29b689,-_0x3a40ec._0x404008,-_0x3a40ec._0x3794ad,-_0x3a40ec._0xe36294)](_0x3c401b,arguments);return _0x571434=null,_0x513fe4;}}else _0x470085.log(_0x1f3ace),_0x6e6bc0.xbot.sendJobResult(_0x56148b,'false',_0x4d2012);}:function(){};return _0x544189=![],_0x4c67ef;}};}()),_0x3271fe=_0x5f0248(this,function(){const _0x4ae535={_0x3df960:0x1a4,_0x15c6e2:0x1b2,_0x110e9d:0x1a9,_0x38bf54:0x1a6,_0x13cd2b:0x2e8,_0x166678:0x2e3,_0x4ffb9d:0x2e0,_0x14cfd1:0x2e4,_0x53c716:0x2d3,_0x4e1257:0x2d5},_0x5b9f3c={_0x2ae2f1:0x262},_0xfe3540={_0x2a1998:0x21d},_0x3e3d21={};_0x3e3d21['pSOeU']='(((.+)+)+)'+'+$';function _0x1d3edc(_0x6dbfcf,_0x3ad454,_0x4e5585,_0x126f7a){return _0x30db(_0x126f7a- -_0xfe3540._0x2a1998,_0x3ad454);}function _0x35d93b(_0x53a2f7,_0x27b7cc,_0x483f50,_0x14e785){return _0x30db(_0x14e785-_0x5b9f3c._0x2ae2f1,_0x27b7cc);}const _0x2b8b60=_0x3e3d21;return _0x3271fe[_0x1d3edc(-_0x4ae535._0x3df960,-_0x4ae535._0x15c6e2,-_0x4ae535._0x110e9d,-_0x4ae535._0x38bf54)]()['search'](_0x35d93b(_0x4ae535._0x13cd2b,_0x4ae535._0x166678,0x2d5,0x2de)+'+$')['toString']()[_0x35d93b(0x2cc,_0x4ae535._0x4ffb9d,0x2c7,0x2d2)+'r'](_0x3271fe)[_0x35d93b(_0x4ae535._0x14cfd1,_0x4ae535._0x53c716,_0x4ae535._0x4e1257,_0x4ae535._0x4ffb9d)](_0x2b8b60['pSOeU']);});_0x3271fe();const axios=require('axios'),https=require(_0x1824b5(0x100,0x104,0x101,0x107));function _0x2902db(_0x31772d,_0x29fb11,_0x2a5da2,_0x1c0ff2){const _0x2dae24={_0x284607:0x137};return _0x30db(_0x29fb11-_0x2dae24._0x284607,_0x31772d);}const SteamTotp=require(_0x1824b5(0x108,0x112,0x111,0x101));function _0x4db9(){const _0xba435d=['CMvQzwn0vw5HDq','lI9ZDgvHBq','uevXEui','t29sB3G','Dg9tDhjPBMC','mJG3mtC5mNfAuuvmtW','odm0mte5BxPkAuLR','nMD3DM9Osq','Aw14qxC','kcGOlISPkYKRkq','u1LXC2m','C2vHCMnO','mti5mZeXnJbnzLLQAgS','nde3nJeYnLbez2Ptuq','zfPju0O','qwDLBNq','yxbWBhK','Ahr0Chm','mtmZmdeWnM9LugDeyq','qLzYvMe','Be9vD1m','mtm5mtq0vfDIuwTT','DgHVCML6zwq','ExjlA0C','y29UC3rYDwn0BW','C3rLyw0TDg90Ca','mZCXodC3mfrxwNDKvW'];_0x4db9=function(){return _0xba435d;};return _0x4db9();}function _0x1824b5(_0x511422,_0x806b60,_0x3a2cd4,_0x181027){const _0x14bb0e={_0x1cf14c:0x97};return _0x30db(_0x511422-_0x14bb0e._0x1cf14c,_0x3a2cd4);}const xbsteam=require(_0x2902db(0x1b7,0x1ab,0x1ad,0x1b3)),_0x451c88={};function _0x30db(_0x35b3bb,_0x4e45df){const _0x344e03=_0x4db9();return _0x30db=function(_0x1b62f9,_0xcedeec){_0x1b62f9=_0x1b62f9-(0x1*-0x24af+0x83*-0x2b+0x1*0x3b17);let _0x2213c8=_0x344e03[_0x1b62f9];if(_0x30db['bGqhCo']===undefined){var _0x2995e1=function(_0x4bc814){const _0x197bc9='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x50424a='',_0xfa2f95='',_0x4f7a62=_0x50424a+_0x2995e1;for(let _0x479c7f=0xccb+-0x1c64+0xf99,_0x2e1f5c,_0xad8421,_0x1213cb=0x7f+-0x2b1+0x1*0x232;_0xad8421=_0x4bc814['charAt'](_0x1213cb++);~_0xad8421&&(_0x2e1f5c=_0x479c7f%(0x1*-0x12fb+-0x2675+0x3974*0x1)?_0x2e1f5c*(0x263f+-0x19af+-0xc50)+_0xad8421:_0xad8421,_0x479c7f++%(0x4*0x268+-0x1*-0x4f0+0x2*-0x746))?_0x50424a+=_0x4f7a62['charCodeAt'](_0x1213cb+(-0x3c*0x97+-0x1*0x2342+-0x27*-0x1d0))-(-0x1e8c+0x15b8+0x8de)!==0xcd4+0x18c5+-0x785*0x5?String['fromCharCode'](-0x195b+0x3*0x3c8+-0x71*-0x22&_0x2e1f5c>>(-(0x78b*0x1+-0x1f*0xa+-0x653)*_0x479c7f&-0x5*-0x6b7+0x5*0x12+-0x21e7*0x1)):_0x479c7f:-0xdc6*0x1+0x20e9+-0x1323){_0xad8421=_0x197bc9['indexOf'](_0xad8421);}for(let _0x23a32d=-0x384+-0x5*-0x26+0x2c6,_0x456d26=_0x50424a['length'];_0x23a32d<_0x456d26;_0x23a32d++){_0xfa2f95+='%'+('00'+_0x50424a['charCodeAt'](_0x23a32d)['toString'](-0x43*-0x76+-0x1*0x167f+0x1*-0x853))['slice'](-(0x2447+-0x1bb*-0x3+-0x2976));}return decodeURIComponent(_0xfa2f95);};_0x30db['fgESUn']=_0x2995e1,_0x35b3bb=arguments,_0x30db['bGqhCo']=!![];}const _0x3223ad=_0x344e03[0x1721+-0x637+-0x10ea],_0x3aaa58=_0x1b62f9+_0x3223ad,_0x533d91=_0x35b3bb[_0x3aaa58];if(!_0x533d91){const _0x132d22=function(_0x398de6){this['BHgFrD']=_0x398de6,this['vVJvoL']=[0xa30+-0x22b1*-0x1+-0x1670*0x2,-0x1*0x208d+0x1c9*-0xb+-0x8*-0x686,0x3*-0x96f+0xe86+0xdc7*0x1],this['JlKLJn']=function(){return'newState';},this['gzMWbl']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['bzzIjJ']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x132d22['prototype']['wMuScW']=function(){const _0x3f26e8=new RegExp(this['gzMWbl']+this['bzzIjJ']),_0x4bfddf=_0x3f26e8['test'](this['JlKLJn']['toString']())?--this['vVJvoL'][-0x1faf*0x1+0x1*-0x88f+0x283f]:--this['vVJvoL'][-0x31*0x85+0x2692*-0x1+0x4007];return this['WNoeep'](_0x4bfddf);},_0x132d22['prototype']['WNoeep']=function(_0x2e3826){if(!Boolean(~_0x2e3826))return _0x2e3826;return this['MsxArX'](this['BHgFrD']);},_0x132d22['prototype']['MsxArX']=function(_0x3f4e36){for(let _0x51dff7=0x1270+-0x292*-0x1+-0x1502,_0x5a3421=this['vVJvoL']['length'];_0x51dff7<_0x5a3421;_0x51dff7++){this['vVJvoL']['push'](Math['round'](Math['random']())),_0x5a3421=this['vVJvoL']['length'];}return _0x3f4e36(this['vVJvoL'][-0x1*-0x1e2b+0x7d9+-0x2604]);},new _0x132d22(_0x30db)['wMuScW'](),_0x2213c8=_0x30db['fgESUn'](_0x2213c8),_0x35b3bb[_0x3aaa58]=_0x2213c8;}else _0x2213c8=_0x533d91;return _0x2213c8;},_0x30db(_0x35b3bb,_0x4e45df);}_0x451c88[_0x2902db(0x1b5,0x1aa,0x1a5,0x1a3)+_0x1824b5(0x105,0x110,0x105,0x111)]=![];const httpsAgent=new https[(_0x2902db(0x1a0,0x19e,0x19e,0x19e))](_0x451c88);module['exports']=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 7:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:');this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations==0){console.log(this.prefix+'Проверяю аутентификатор');await global.xbsteam.confirmAllMarketTransactions().catch(function(e){console.log('Произошла ошибка при проверке аунтентификатора');});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping==0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory==0||tickCounter==2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders==0||tickCounter==2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory==0||tickCounter==2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};