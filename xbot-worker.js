(function(_0x3ff0a6,_0x122acc){const _0xf6544={_0x244b2d:0xa7,_0x11d2a9:0xa8,_0x95473d:0xbb,_0x1f6b95:0xb0,_0x2b8a6d:0x374,_0x53b58e:0x37a,_0x2a72ca:0x377,_0x560e71:0xa9,_0x287bfd:0xad,_0x57af3f:0x371,_0x4c85e3:0x378,_0x39fc2d:0x36e,_0x2c8d06:0x9e,_0x220a57:0xa5,_0x2def05:0x9b,_0x3e6844:0x370,_0x3d6544:0x36f,_0x552c93:0x364,_0x436380:0xac,_0x3cdcd6:0x98,_0x4de8c9:0xa7,_0x253a76:0xa3,_0x36c4a7:0xa4,_0x3034ae:0xae,_0xc46cba:0xa0,_0x57506c:0xa6,_0x359aa1:0xab,_0x5bfcb8:0xaa,_0x2e617a:0xaa,_0x36c33f:0xa9},_0x5887b0={_0x4120c0:0x203},_0x46da51={_0x502525:0x212},_0x2f1cc2=_0x3ff0a6();function _0x2c35c9(_0x55a67f,_0x2260db,_0x5d6570,_0x5d69bb){return _0x3dc6(_0x2260db-_0x46da51._0x502525,_0x55a67f);}function _0x22c3fd(_0x3a576a,_0x333cf1,_0xa1c50d,_0x26791b){return _0x3dc6(_0x26791b- -_0x5887b0._0x4120c0,_0xa1c50d);}while(!![]){try{const _0x582437=-parseInt(_0x22c3fd(-_0xf6544._0x244b2d,-_0xf6544._0x11d2a9,-_0xf6544._0x95473d,-_0xf6544._0x1f6b95))/(0x1a8a+-0x7*-0x1c9+0x1384*-0x2)+parseInt(_0x2c35c9(_0xf6544._0x2b8a6d,0x378,_0xf6544._0x53b58e,_0xf6544._0x2a72ca))/(0xf3*-0x1d+0x236d*-0x1+-0x1*-0x3ef6)*(parseInt(_0x22c3fd(-_0xf6544._0x244b2d,-_0xf6544._0x560e71,-_0xf6544._0x287bfd,-_0xf6544._0x287bfd))/(-0xdd6+0xf6*0x17+-0x1*0x841))+-parseInt(_0x2c35c9(0x377,_0xf6544._0x57af3f,_0xf6544._0x4c85e3,_0xf6544._0x39fc2d))/(0x6b0+-0x1dc*0x8+0x41a*0x2)+-parseInt(_0x22c3fd(-_0xf6544._0x2c8d06,-_0xf6544._0x220a57,-0x90,-_0xf6544._0x2def05))/(-0x17*0xe2+0x463+-0x198*-0xa)+parseInt(_0x2c35c9(_0xf6544._0x3e6844,0x366,_0xf6544._0x3d6544,_0xf6544._0x552c93))/(-0x1254+0xf01+0x359)*(parseInt(_0x22c3fd(-_0xf6544._0x436380,-_0xf6544._0x3cdcd6,-_0xf6544._0x4de8c9,-0xa2))/(-0x202*0x11+-0x17af+0x1cec*0x2))+parseInt(_0x22c3fd(-_0xf6544._0x253a76,-_0xf6544._0x36c4a7,-0xb4,-_0xf6544._0x3034ae))/(0x1e2e+0xce3+-0x2b09)*(-parseInt(_0x22c3fd(-0x9d,-_0xf6544._0xc46cba,-0x9f,-_0xf6544._0x220a57))/(-0x2*0xaba+-0x7*0x34+0x16e9))+parseInt(_0x22c3fd(-_0xf6544._0x4de8c9,-_0xf6544._0x57506c,-_0xf6544._0x359aa1,-_0xf6544._0x5bfcb8))/(-0x1f94+0x18af+-0x163*-0x5)*(parseInt(_0x22c3fd(-_0xf6544._0x287bfd,-_0xf6544._0x2e617a,-0x9e,-_0xf6544._0x36c33f))/(0x141d*0x1+-0x7d1+0x1*-0xc41));if(_0x582437===_0x122acc)break;else _0x2f1cc2['push'](_0x2f1cc2['shift']());}catch(_0x3489a4){_0x2f1cc2['push'](_0x2f1cc2['shift']());}}}(_0x12e1,-0x25c64*0x4+-0x185*-0xa97+0x1*0x5ebc2));const _0x33e910=(function(){const _0x5425e4={_0x39a344:0x59,_0x404d07:0x68,_0x290260:0x5b,_0x82b9c5:0x62,_0x2047bc:0x5f,_0x9786d7:0x5e,_0x1d7e6e:0x67,_0x38205f:0x63,_0x3d87ec:0x53},_0x133068={_0x14bbb4:0x500,_0x431bd8:0x508,_0x3f2a40:0x502,_0x40c9e7:0x222,_0x192d05:0x22a,_0x797b2:0x505,_0x3ceb99:0x510,_0x1d3999:0x50b,_0x1e4936:0x501},_0x69d039={_0x30c92a:0xf2,_0x53127f:0x139,_0x359fd8:0x5},_0x803698={};_0x803698[_0x1b9968(-0x5b,-_0x5425e4._0x39a344,-0x5e,-_0x5425e4._0x404d07)]=function(_0x368de5,_0x28a4ab){return _0x368de5===_0x28a4ab;},_0x803698[_0x1b9968(-_0x5425e4._0x39a344,-_0x5425e4._0x290260,-_0x5425e4._0x82b9c5,-_0x5425e4._0x2047bc)]=_0x1b9968(-_0x5425e4._0x9786d7,-_0x5425e4._0x1d7e6e,-_0x5425e4._0x38205f,-0x5d);function _0x1b9968(_0x39783d,_0x188c9b,_0x1d3179,_0x2becd1){return _0x3dc6(_0x1d3179- -0x1be,_0x188c9b);}_0x803698['qYTvp']=_0x1b9968(-0x5a,-0x5f,-0x55,-_0x5425e4._0x3d87ec);const _0x4c96dd=_0x803698;let _0x3eaf2b=!![];function _0x28774b(_0x230285,_0x9cd648,_0x353446,_0x331acd){return _0x3dc6(_0x230285-0x2ae,_0x331acd);}return function(_0x3caeaf,_0x275322){const _0x13102e={_0x3a5277:0x3c,_0x344811:0x1be,_0x360b61:0x56};function _0x5167b2(_0x51eea6,_0x2e36cd,_0x6aa6c0,_0x4f892){return _0x1b9968(_0x51eea6-_0x13102e._0x3a5277,_0x6aa6c0,_0x51eea6- -_0x13102e._0x344811,_0x4f892-_0x13102e._0x360b61);}function _0x5dc461(_0x3d5217,_0x495aee,_0x21d5af,_0x29074c){return _0x28774b(_0x3d5217-_0x69d039._0x30c92a,_0x495aee-_0x69d039._0x53127f,_0x21d5af-_0x69d039._0x359fd8,_0x29074c);}if(_0x4c96dd[_0x5dc461(_0x133068._0x14bbb4,_0x133068._0x431bd8,_0x133068._0x3f2a40,0x4fb)](_0x4c96dd[_0x5167b2(-0x220,-_0x133068._0x40c9e7,-_0x133068._0x192d05,-0x226)],_0x4c96dd[_0x5dc461(_0x133068._0x797b2,_0x133068._0x3ceb99,_0x133068._0x1d3999,_0x133068._0x1e4936)])){_0x1d2503.log('Не установлен параметр XBOT_API_KEY');return;}else{const _0xc0a00a=_0x3eaf2b?function(){if(_0x275322){const _0x1cd5b6=_0x275322['apply'](_0x3caeaf,arguments);return _0x275322=null,_0x1cd5b6;}}:function(){};return _0x3eaf2b=![],_0xc0a00a;}};}()),_0x942b9e=_0x33e910(this,function(){const _0x2a4a01={_0x10fe10:0x232,_0x2901a:0x228,_0x326639:0x22c,_0x20fda7:0x228,_0x370a6f:0x236,_0x210599:0x231,_0x325014:0x234,_0x409331:0x511,_0x469018:0x507,_0x12bb9e:0x239,_0x315ae8:0x233,_0x2de2a8:0x22d};function _0x21a135(_0x3018cb,_0x36e5fe,_0x3829d9,_0x2b6a22){return _0x3dc6(_0x36e5fe-0x3b0,_0x3829d9);}const _0x3b4397={};function _0x3b5b36(_0x5ded76,_0x2204d7,_0x478005,_0xad4b5d){return _0x3dc6(_0x478005- -0x395,_0x5ded76);}_0x3b4397['yadha']=_0x3b5b36(-_0x2a4a01._0x10fe10,-_0x2a4a01._0x2901a,-0x232,-_0x2a4a01._0x326639)+'+$';const _0x4e218e=_0x3b4397;return _0x942b9e[_0x3b5b36(-_0x2a4a01._0x20fda7,-_0x2a4a01._0x370a6f,-_0x2a4a01._0x210599,-_0x2a4a01._0x325014)]()['search'](_0x4e218e[_0x21a135(_0x2a4a01._0x409331,_0x2a4a01._0x469018,0x50e,0x502)])['toString']()['constructo'+'r'](_0x942b9e)[_0x3b5b36(-_0x2a4a01._0x326639,-_0x2a4a01._0x12bb9e,-_0x2a4a01._0x315ae8,-_0x2a4a01._0x2de2a8)](_0x4e218e['yadha']);});_0x942b9e();const SteamCommunity=require('steamcommu'+_0x297e7e(0x140,0x14f,0x148,0x149)),SteamTotp=require(_0xfa9d70(0x33d,0x32a,0x335,0x332)),moment=require(_0x297e7e(0x14f,0x15d,0x157,0x15b)),SteamUser=require('steam-user'),SteamStore=require('steamstore');const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}function _0x297e7e(_0xc343c8,_0x3c829f,_0x467bd2,_0x2243fe){const _0x295254={_0x359bb3:0x10};return _0x3dc6(_0x467bd2- -_0x295254._0x359bb3,_0xc343c8);}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};function _0x3dc6(_0x3a4f25,_0x3e4331){const _0x438c21=_0x12e1();return _0x3dc6=function(_0x462c3c,_0x31f5d6){_0x462c3c=_0x462c3c-(-0x8e2+-0xa8f+-0x376*-0x6);let _0x3f67f9=_0x438c21[_0x462c3c];if(_0x3dc6['dMuJeW']===undefined){var _0x585f9f=function(_0x261829){const _0x55c7a6='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xa37dbc='',_0x21d4ce='',_0x110458=_0xa37dbc+_0x585f9f;for(let _0xfa1e9a=0xb8b+-0x668+-0x523,_0x2d7786,_0x4af7c4,_0x2af229=0x3d0*-0x4+0x1fda+-0x109a;_0x4af7c4=_0x261829['charAt'](_0x2af229++);~_0x4af7c4&&(_0x2d7786=_0xfa1e9a%(-0xa*0x1ae+0xd5*0x12+-0x5*-0x5e)?_0x2d7786*(0x788+-0x1721+-0x1*-0xfd9)+_0x4af7c4:_0x4af7c4,_0xfa1e9a++%(-0x1e82+-0x190d+0x3793))?_0xa37dbc+=_0x110458['charCodeAt'](_0x2af229+(0x1ece+-0xec6+-0xffe))-(0x6f5+0x16cd+-0x1db8)!==0x189b*-0x1+0x7ee+0x10ad?String['fromCharCode'](-0x2*0x15+-0x1*0x16ed+-0x1816*-0x1&_0x2d7786>>(-(-0x506*-0x5+-0x29*0x3d+-0xf57)*_0xfa1e9a&0x1028+-0xd47+-0x2db)):_0xfa1e9a:0xf3c+-0x1cb0+0x11f*0xc){_0x4af7c4=_0x55c7a6['indexOf'](_0x4af7c4);}for(let _0x3625f2=-0x1*0x1a89+0x9e8+0x21*0x81,_0x1dc60c=_0xa37dbc['length'];_0x3625f2<_0x1dc60c;_0x3625f2++){_0x21d4ce+='%'+('00'+_0xa37dbc['charCodeAt'](_0x3625f2)['toString'](0xe21*-0x2+-0x15fe+0x3250))['slice'](-(-0x1751*-0x1+0x50*-0x70+-0x1*-0xbb1));}return decodeURIComponent(_0x21d4ce);};_0x3dc6['pYasgz']=_0x585f9f,_0x3a4f25=arguments,_0x3dc6['dMuJeW']=!![];}const _0x134d3a=_0x438c21[-0x1cae*0x1+-0x1*0x1572+0x3220],_0x1683a5=_0x462c3c+_0x134d3a,_0x32ab06=_0x3a4f25[_0x1683a5];if(!_0x32ab06){const _0x181d19=function(_0x38e340){this['xekixl']=_0x38e340,this['UzSnHs']=[-0x43*0x32+-0x1*0x24dd+-0x18fa*-0x2,0x7*0x531+0x2599+-0x49f0,0x12a2+0x165f+-0xdab*0x3],this['gbQVRT']=function(){return'newState';},this['yoAPnA']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['oXCzms']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x181d19['prototype']['aaRorE']=function(){const _0x5419c0=new RegExp(this['yoAPnA']+this['oXCzms']),_0x208b97=_0x5419c0['test'](this['gbQVRT']['toString']())?--this['UzSnHs'][0x168b+0x2069*-0x1+0x9df*0x1]:--this['UzSnHs'][0x1285+0xa45+-0x1cca];return this['BGtpWN'](_0x208b97);},_0x181d19['prototype']['BGtpWN']=function(_0x40f75d){if(!Boolean(~_0x40f75d))return _0x40f75d;return this['NSTLWS'](this['xekixl']);},_0x181d19['prototype']['NSTLWS']=function(_0x12b83b){for(let _0x5c8296=0x1bda+0x535+-0x210f,_0x16ab30=this['UzSnHs']['length'];_0x5c8296<_0x16ab30;_0x5c8296++){this['UzSnHs']['push'](Math['round'](Math['random']())),_0x16ab30=this['UzSnHs']['length'];}return _0x12b83b(this['UzSnHs'][-0x661*-0x5+-0x2*-0xe3b+-0x3c5b*0x1]);},new _0x181d19(_0x3dc6)['aaRorE'](),_0x3f67f9=_0x3dc6['pYasgz'](_0x3f67f9),_0x3a4f25[_0x1683a5]=_0x3f67f9;}else _0x3f67f9=_0x32ab06;return _0x3f67f9;},_0x3dc6(_0x3a4f25,_0x3e4331);}gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};function _0xfa9d70(_0x5ba3cc,_0x36da01,_0x93af24,_0x577c0b){return _0x3dc6(_0x577c0b-0x1d5,_0x93af24);}function _0x12e1(){const _0x384013=['Cfbiq3u','mtm0mtGWmhPYBgDIsG','mtjrCenLtLK','odC4mJCYuuvAvM9j','nJq3ndaZA2ruze9P','EwfKAge','BML0Eq','mJK4ntKWmtbACMv4t1G','mtfMrgPWCvO','wvDwDhq','vK50Cu8','C3rLyw0TDg90Ca','mtHxzxDQwum','mZKZmdK2mev5zvftBW','swfsqvG','mta1nZyZAM9Uq0zg','C2vHCMnO','kcGOlISPkYKRkq','Dg9tDhjPBMC','CvLuDNa','mtjKDgXMEuq','Bw9Tzw50','ndCXntuWmfzqt2DoqG'];_0x12e1=function(){return _0x384013;};return _0x12e1();}global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log('Бот обновляется');console.log('Бот обновляется');global.sc.wait();console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();