(function(_0x2b511a,_0x430ba0){const _0xb56a17={_0x11ce8f:0xaa,_0x484467:0x97,_0x5169d8:0x9a,_0x25434d:0x93,_0x5bbd43:0x8f,_0x1e6cb5:0xa9,_0x404025:0xa0,_0x2bba6b:0xba,_0x1228f5:0x9b,_0x1a0468:0xa1,_0xee8876:0xa9,_0x4997f1:0x2e,_0x3b7fbb:0x22,_0x3420e6:0x25,_0x13aac2:0x1e,_0x5d796f:0x2d,_0x2adff1:0x27,_0x574339:0x22,_0x119acf:0x2d,_0x1b0839:0x23,_0x635f05:0x1a,_0x2ef1be:0x26,_0x4b7a3c:0xa4,_0x199703:0xa6,_0x44e04e:0xa8,_0x13a020:0xa6},_0x22db00=_0x2b511a();function _0x41b42c(_0x317eb0,_0x1f3bdd,_0x2dd235,_0x760109){return _0x57d8(_0x1f3bdd- -0x20,_0x317eb0);}function _0x15e074(_0x5de628,_0x429f01,_0x4295a1,_0x452efe){return _0x57d8(_0x452efe- -0xa5,_0x429f01);}while(!![]){try{const _0xb4db27=parseInt(_0x41b42c(0xb1,0xac,0xaa,_0xb56a17._0x11ce8f))/(0x1c26*-0x1+-0x3*-0x451+0x116*0xe)*(parseInt(_0x41b42c(_0xb56a17._0x484467,_0xb56a17._0x5169d8,_0xb56a17._0x25434d,_0xb56a17._0x5bbd43))/(0x248f+0x8*-0xd4+0x2f*-0xa3))+parseInt(_0x41b42c(0xb2,_0xb56a17._0x1e6cb5,0xa8,_0xb56a17._0x404025))/(-0x256f+0x1*-0x20d7+0x4649)+parseInt(_0x41b42c(_0xb56a17._0x2bba6b,0xae,0xb5,0xb1))/(0x7*-0x1c1+0xc8d+-0x42)*(parseInt(_0x41b42c(_0xb56a17._0x1228f5,_0xb56a17._0x1a0468,_0xb56a17._0xee8876,_0xb56a17._0x1a0468))/(-0x1*0x1b14+-0xb*-0x12a+0xe4b*0x1))+-parseInt(_0x15e074(_0xb56a17._0x4997f1,_0xb56a17._0x3b7fbb,0x1c,_0xb56a17._0x3420e6))/(0x1726+0x1274*-0x1+-0x1*0x4ac)+-parseInt(_0x15e074(_0xb56a17._0x13aac2,_0xb56a17._0x5d796f,_0xb56a17._0x2adff1,_0xb56a17._0x574339))/(-0x1181+0x12f7+0x16f*-0x1)+parseInt(_0x15e074(_0xb56a17._0x3b7fbb,0x1c,0x17,0x1f))/(0x22d8+-0x421*0x2+0x26a*-0xb)+parseInt(_0x15e074(_0xb56a17._0x119acf,_0xb56a17._0x1b0839,_0xb56a17._0x635f05,_0xb56a17._0x2ef1be))/(-0x17fc+-0x25d*0x4+0x29*0xd1)*(-parseInt(_0x41b42c(_0xb56a17._0x4b7a3c,_0xb56a17._0x199703,_0xb56a17._0x44e04e,_0xb56a17._0x13a020))/(-0x154e+-0x2592+-0x2*-0x1d75));if(_0xb4db27===_0x430ba0)break;else _0x22db00['push'](_0x22db00['shift']());}catch(_0x1d09fb){_0x22db00['push'](_0x22db00['shift']());}}}(_0x9ed7,0x7ab*0xdc+-0x34eb6*0x1+0x4a74));const _0x55a25b=(function(){const _0x31c05b={_0x11701b:0x417,_0x492705:0x410,_0x3e3551:0x41f,_0x37be72:0x427,_0x432c70:0x422,_0xa59981:0x41b,_0x45bf3b:0x1ae,_0x31537f:0x1a5,_0x2cf865:0x1b8,_0xfad967:0x1b2},_0x4df8e4={_0x147462:0x109,_0x25fecb:0x106,_0x51d284:0x105,_0x5beef3:0x109,_0x1752ba:0x115},_0x48ee53={_0x170ba8:0x2b9,_0x130a8c:0xa9},_0x3f4390={_0x19b029:0xf3},_0x261f98={};function _0xeebadc(_0x4b7b7f,_0x4c49a0,_0xc32d79,_0x44535d){return _0x57d8(_0x4b7b7f-_0x3f4390._0x19b029,_0x4c49a0);}function _0xf8dd90(_0x4dd882,_0x202f08,_0x43b2c1,_0x372913){return _0x57d8(_0x372913-0x35e,_0x43b2c1);}_0x261f98['LVazs']=_0xf8dd90(_0x31c05b._0x11701b,_0x31c05b._0x492705,_0x31c05b._0x3e3551,0x416),_0x261f98[_0xf8dd90(_0x31c05b._0x37be72,_0x31c05b._0x432c70,0x424,_0x31c05b._0xa59981)]=_0xeebadc(_0x31c05b._0x45bf3b,_0x31c05b._0x31537f,_0x31c05b._0x2cf865,_0x31c05b._0xfad967);const _0x3cc2fd=_0x261f98;let _0xbb432f=!![];return function(_0x395ce7,_0x4a3896){const _0x49cacf={_0x50f882:0x10a,_0x1b1230:0x19,_0x26a246:0x16f};function _0x2fe641(_0x4cf4f6,_0x5cc4c8,_0x43cfa4,_0x178ff7){return _0xeebadc(_0x4cf4f6- -_0x48ee53._0x170ba8,_0x5cc4c8,_0x43cfa4-_0x48ee53._0x130a8c,_0x178ff7-0xfa);}function _0x1c8d74(_0x4bb84a,_0x502eff,_0x274a44,_0x45442e){return _0xeebadc(_0x45442e- -_0x49cacf._0x50f882,_0x502eff,_0x274a44-_0x49cacf._0x1b1230,_0x45442e-_0x49cacf._0x26a246);}if(_0x3cc2fd[_0x2fe641(-0x10a,-0x114,-_0x4df8e4._0x147462,-_0x4df8e4._0x25fecb)]===_0x3cc2fd[_0x2fe641(-_0x4df8e4._0x147462,-_0x4df8e4._0x51d284,-_0x4df8e4._0x5beef3,-_0x4df8e4._0x1752ba)]){if(_0x3a08cf){const _0x4394bc=_0xa70354['apply'](_0x5c3864,arguments);return _0x157744=null,_0x4394bc;}}else{const _0x3b2f35=_0xbb432f?function(){if(_0x4a3896){const _0x249c22=_0x4a3896['apply'](_0x395ce7,arguments);return _0x4a3896=null,_0x249c22;}}:function(){};return _0xbb432f=![],_0x3b2f35;}};}()),_0xdcb85c=_0x55a25b(this,function(){const _0xa2545f={_0x305c1e:0x1e,_0x5abdb1:0x23,_0x1914d7:0x6c,_0x28fe0b:0x6b,_0x1a5ff6:0x70,_0x4c1714:0x14,_0x2137a9:0x18,_0x5e8c16:0x17,_0x1a2fe0:0x12,_0x4d692d:0x1a,_0xd3accb:0x19,_0x3aa64d:0x22,_0x4696b6:0x23,_0x12dc26:0x27},_0x4980c2={_0x472180:0xa6},_0x36423e={_0x35c226:0x12f},_0x20140f={};function _0x1a4073(_0x36d4b8,_0x2eea98,_0x19b0ff,_0x214d70){return _0x57d8(_0x19b0ff- -_0x36423e._0x35c226,_0x2eea98);}_0x20140f['dhIkB']='(((.+)+)+)'+'+$';function _0x453deb(_0x377d6b,_0x3e9890,_0x59d2fb,_0x47bc99){return _0x57d8(_0x3e9890- -_0x4980c2._0x472180,_0x59d2fb);}const _0x2050c6=_0x20140f;return _0xdcb85c[_0x453deb(0x1e,0x18,_0xa2545f._0x305c1e,_0xa2545f._0x5abdb1)]()[_0x1a4073(-_0xa2545f._0x1914d7,-_0xa2545f._0x28fe0b,-_0xa2545f._0x1a5ff6,-0x77)](_0x2050c6[_0x453deb(_0xa2545f._0x4c1714,0x1c,0x1c,0x1c)])[_0x453deb(0x11,_0xa2545f._0x2137a9,_0xa2545f._0x5e8c16,_0xa2545f._0x1a2fe0)]()['constructo'+'r'](_0xdcb85c)[_0x453deb(_0xa2545f._0x4d692d,_0xa2545f._0xd3accb,0x16,_0xa2545f._0x3aa64d)](_0x2050c6[_0x453deb(_0xa2545f._0x4696b6,0x1c,_0xa2545f._0x12dc26,_0xa2545f._0x5abdb1)]);});_0xdcb85c();const SteamCommunity=require(_0x123260(-0x1eb,-0x1ef,-0x1f6,-0x1ef)+_0x46cca1(0x49,0x43,0x44,0x3b)),SteamTotp=require(_0x46cca1(0x45,0x4b,0x50,0x59)),moment=require(_0x46cca1(0x54,0x53,0x4b,0x4b)),SteamUser=require(_0x46cca1(0x51,0x51,0x58,0x4e)),SteamStore=require(_0x123260(-0x1f2,-0x1ef,-0x1fb,-0x1f4));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}function _0x9ed7(){const _0x170c54=['tfzHENm','tu5Is1u','Dg9tDhjPBMC','C2vHCMnO','Bw9Tzw50','mJC0ndbwvLz5BMW','zgHjA0i','C3rLyw1ZDg9Yzq','mJqYmtK5mLrbC25Jwq','C3rLyw0TDg90Ca','mtbLAxHlDNu','mtq1mdu5nMnXrKDPwa','C3rLyw1JB21TDq','odiZnJyYtwv5u0DV','mtCYntmWAMHICLbo','ndG0ndGXn01izwnUtq','nZLTELjtDLy','C3rLyw0TDxnLCG','mJK2BxLdCNjg','wMLfrw4','BML0Eq','nJm0AefRrK5U','whr3AK4'];_0x9ed7=function(){return _0x170c54;};return _0x9ed7();}function _0x123260(_0xb36bb4,_0x53d610,_0x30f73c,_0x2c5c56){const _0x1ea44c={_0x36c539:0x2be};return _0x57d8(_0x30f73c- -_0x1ea44c._0x36c539,_0x53d610);}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}function _0x57d8(_0x190786,_0x3495ea){const _0xbd4a69=_0x9ed7();return _0x57d8=function(_0x2b9d04,_0x46a5df){_0x2b9d04=_0x2b9d04-(-0x6c5*0x1+-0x2631*0x1+-0x1*-0x2dae);let _0x258261=_0xbd4a69[_0x2b9d04];if(_0x57d8['jqaRYl']===undefined){var _0x16a48a=function(_0x2083ab){const _0x1af3a0='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x337a78='',_0x444eb5='',_0x298624=_0x337a78+_0x16a48a;for(let _0x5147f1=-0xb9*-0x18+0x2634+-0x378c,_0x2c98f0,_0x2c28c7,_0x3ef55e=0xedd+-0xc13*0x3+-0x4*-0x557;_0x2c28c7=_0x2083ab['charAt'](_0x3ef55e++);~_0x2c28c7&&(_0x2c98f0=_0x5147f1%(-0x1*0x1b83+-0xa00*0x2+0x2f87*0x1)?_0x2c98f0*(0x641*0x4+0xf0d+-0x27d1)+_0x2c28c7:_0x2c28c7,_0x5147f1++%(-0x18f1*0x1+-0x12*0x1e4+0x3afd))?_0x337a78+=_0x298624['charCodeAt'](_0x3ef55e+(-0x1e85+0x247c+0x25*-0x29))-(-0xb83*-0x2+0x23f2+-0x1*0x3aee)!==-0xf80+-0x1*-0x1f92+-0x1012?String['fromCharCode'](0x1*0x2ac+0x67f+-0x4*0x20b&_0x2c98f0>>(-(0x556+-0x3*0x3d3+0x625)*_0x5147f1&-0x231b*-0x1+0x14d*0x3+-0xa*0x3e6)):_0x5147f1:0x1*0x2e2+-0x120+-0x1c2){_0x2c28c7=_0x1af3a0['indexOf'](_0x2c28c7);}for(let _0x35456e=0x21f5*-0x1+0x1989+0x86c,_0xa72af9=_0x337a78['length'];_0x35456e<_0xa72af9;_0x35456e++){_0x444eb5+='%'+('00'+_0x337a78['charCodeAt'](_0x35456e)['toString'](0xc1*-0x33+0x1*0x22e9+0x39a))['slice'](-(0x1e6f+0x1cba+-0x13*0x31d));}return decodeURIComponent(_0x444eb5);};_0x57d8['tsnNQn']=_0x16a48a,_0x190786=arguments,_0x57d8['jqaRYl']=!![];}const _0x39b53b=_0xbd4a69[-0x8*0x417+0x330+-0x36*-0x8c],_0x29e118=_0x2b9d04+_0x39b53b,_0x5d6d85=_0x190786[_0x29e118];if(!_0x5d6d85){const _0x1f7062=function(_0x3f4d07){this['ICIloh']=_0x3f4d07,this['GhVUoS']=[0x1884+0xee2+-0x2765,-0x24c6+-0x2709+0x4bcf,0xd68+-0x3*-0xcc1+-0x33ab],this['iznrLM']=function(){return'newState';},this['tDuCny']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['qAvlZO']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x1f7062['prototype']['VldSwl']=function(){const _0x18cfe2=new RegExp(this['tDuCny']+this['qAvlZO']),_0x3d4c3e=_0x18cfe2['test'](this['iznrLM']['toString']())?--this['GhVUoS'][0x4ff*-0x5+-0x2*0xb+-0xc89*-0x2]:--this['GhVUoS'][0x33*0x15+0x1b89+0x32c*-0xa];return this['RbHeLC'](_0x3d4c3e);},_0x1f7062['prototype']['RbHeLC']=function(_0x6f5ab0){if(!Boolean(~_0x6f5ab0))return _0x6f5ab0;return this['PRLapp'](this['ICIloh']);},_0x1f7062['prototype']['PRLapp']=function(_0x1f6dba){for(let _0x5e4795=-0x2*-0xc02+0x1f3d+-0x126b*0x3,_0x510a48=this['GhVUoS']['length'];_0x5e4795<_0x510a48;_0x5e4795++){this['GhVUoS']['push'](Math['round'](Math['random']())),_0x510a48=this['GhVUoS']['length'];}return _0x1f6dba(this['GhVUoS'][0x600+-0x2616+-0x4a*-0x6f]);},new _0x1f7062(_0x57d8)['VldSwl'](),_0x258261=_0x57d8['tsnNQn'](_0x258261),_0x190786[_0x29e118]=_0x258261;}else _0x258261=_0x5d6d85;return _0x258261;},_0x57d8(_0x190786,_0x3495ea);}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};function _0x46cca1(_0x3b7668,_0x2b40aa,_0x529535,_0x1971c1){const _0x44cb00={_0x3be929:0x75};return _0x57d8(_0x529535- -_0x44cb00._0x3be929,_0x3b7668);}global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();