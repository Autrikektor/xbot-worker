(function(_0x45012d,_0x13ee7f){const _0x1f7944={_0x1ecea5:0x19b,_0x4fac39:0x19a,_0x4e61b5:0x199,_0x103f5d:0x17d,_0x5bc33e:0x16f,_0x579a73:0x175,_0x25c0fc:0x176,_0x58498e:0x1af,_0x366360:0x19c,_0x37fb23:0x1a1,_0x534273:0x16b,_0x45bad6:0x18b,_0x69bfd7:0x17c,_0x308258:0x18b,_0x39d5b1:0x199,_0x2c860d:0x1a0,_0xb00e33:0x19a,_0x274480:0x1a5,_0x4b028e:0x1a6,_0x26eb43:0x159,_0xbbcf5f:0x169,_0x512bab:0x196,_0x642e36:0x189,_0x55dcb7:0x19b,_0x25b06e:0x1a4,_0x4c5dd9:0x1aa,_0x1e5ced:0x1ae,_0x1c25a7:0x1a3,_0xc8c670:0x168,_0xe6556c:0x180,_0x581a8b:0x16a,_0x1e5f37:0x174,_0x235bd1:0x170,_0x37e2f7:0x186,_0x40ce6c:0x187,_0x577f63:0x184},_0x3e4bfe={_0x1b7f93:0x5e},_0x17fe00={_0x44ad6a:0x3c},_0x150495=_0x45012d();function _0x16e084(_0x203937,_0x43f59f,_0xfe7739,_0x561fb6){return _0x1175(_0xfe7739- -_0x17fe00._0x44ad6a,_0x561fb6);}function _0x5dc850(_0x376a6e,_0x4339af,_0x1c9897,_0x2dc68f){return _0x1175(_0x2dc68f- -_0x3e4bfe._0x1b7f93,_0x376a6e);}while(!![]){try{const _0x295502=-parseInt(_0x16e084(_0x1f7944._0x1ecea5,_0x1f7944._0x4fac39,0x19c,_0x1f7944._0x4e61b5))/(-0x6d3+-0x9fe*-0x2+-0xd28)*(parseInt(_0x5dc850(_0x1f7944._0x103f5d,_0x1f7944._0x5bc33e,_0x1f7944._0x579a73,_0x1f7944._0x25c0fc))/(-0x287*-0x2+0xd3*-0x20+0x38e*0x6))+parseInt(_0x16e084(_0x1f7944._0x58498e,_0x1f7944._0x366360,_0x1f7944._0x37fb23,0x1ad))/(0x1*0x6aa+-0x1e33+-0x1*-0x178c)*(parseInt(_0x5dc850(_0x1f7944._0x534273,_0x1f7944._0x45bad6,0x17c,_0x1f7944._0x69bfd7))/(0x11ea+0xb09+-0x1cef))+-parseInt(_0x16e084(0x199,_0x1f7944._0x308258,_0x1f7944._0x39d5b1,_0x1f7944._0x2c860d))/(0x1974+-0x26cc+-0x1*-0xd5d)*(-parseInt(_0x16e084(_0x1f7944._0xb00e33,0x1a8,_0x1f7944._0x274480,_0x1f7944._0x4b028e))/(0x4*0x6ca+-0x5*-0x439+-0x303f))+-parseInt(_0x5dc850(0x178,0x171,_0x1f7944._0x26eb43,_0x1f7944._0xbbcf5f))/(0xa89*-0x1+-0x9d*0x1b+0x35*0x83)+-parseInt(_0x16e084(_0x1f7944._0x512bab,0x19a,_0x1f7944._0x642e36,_0x1f7944._0x55dcb7))/(0x38e+0x557*0x4+-0x82*0x31)*(parseInt(_0x16e084(0x19e,_0x1f7944._0x25b06e,_0x1f7944._0x4c5dd9,_0x1f7944._0x366360))/(0x1068*-0x1+0x8e1+0x10*0x79))+parseInt(_0x16e084(_0x1f7944._0x1e5ced,_0x1f7944._0x274480,_0x1f7944._0x1c25a7,_0x1f7944._0x1ecea5))/(0x981*0x1+0x1*0x187d+0xd4*-0x29)*(parseInt(_0x5dc850(_0x1f7944._0xc8c670,_0x1f7944._0xe6556c,_0x1f7944._0x581a8b,_0x1f7944._0x1e5f37))/(-0x210e+-0xa7b*0x3+-0x2ef*-0x16))+-parseInt(_0x5dc850(0x166,_0x1f7944._0x235bd1,_0x1f7944._0x37e2f7,_0x1f7944._0x579a73))/(-0xfbe+-0x1095+0x205f*0x1)*(-parseInt(_0x5dc850(_0x1f7944._0x103f5d,0x175,_0x1f7944._0x40ce6c,_0x1f7944._0x577f63))/(-0x36e+0x1*0xf3a+-0xbbf));if(_0x295502===_0x13ee7f)break;else _0x150495['push'](_0x150495['shift']());}catch(_0x4c7501){_0x150495['push'](_0x150495['shift']());}}}(_0x2b5f,-0x45d*0x35f+0x4*-0x2f778+0x29ed*0xf8));const _0x1c390b=(function(){const _0x486cd7={_0x3ce5db:0x1e2,_0x121527:0x1d2,_0x49025b:0x414,_0xfe1b97:0x432,_0x9a50fb:0x42e,_0x5d6f9d:0x430,_0x2b97c6:0x424,_0x590578:0x432,_0x443467:0x43d,_0x5eea8d:0x42b,_0x5766ca:0x43b,_0x41e30c:0x44d,_0x5c47b5:0x42c,_0x2f3ca3:0x422},_0x37fd9d={_0x2cfdc5:0x34b,_0x340aee:0x33b,_0x2dc17a:0x345,_0xd11833:0x357,_0x1a410d:0x353,_0x257c27:0x35a,_0x1f909d:0x69,_0x4e0fe4:0x7a,_0x259e72:0x76,_0x3f2f6d:0x62,_0x1f2658:0x6c},_0x2e8d7f={_0x5f2e57:0xc8,_0x2b30b5:0xc4,_0x53f9d7:0xc6,_0x1c0238:0x38f,_0x2bae1c:0x391,_0xd7850e:0x38d,_0x28ca40:0xd2,_0x2d8c38:0xd4,_0x162765:0xe5,_0x1be357:0xef,_0x2b0cef:0xde,_0x5b7525:0xee,_0x1a38ea:0xe7,_0x19c63f:0x392,_0x26cee5:0x38b,_0x523522:0x399,_0xb0763c:0xc3,_0x21dff3:0xd2,_0x33357c:0xca,_0x351e09:0xe0},_0x391c10={_0x3d607a:0x25b},_0x12b482={_0x19c42c:0x4},_0x578e7b={};_0x578e7b[_0x4c0b65(0x1e0,_0x486cd7._0x3ce5db,_0x486cd7._0x121527,0x1df)]=function(_0x30919d,_0x325b91){return _0x30919d!==_0x325b91;},_0x578e7b[_0xcd258e(_0x486cd7._0x49025b,_0x486cd7._0xfe1b97,0x421,_0x486cd7._0x9a50fb)]=_0xcd258e(_0x486cd7._0x5d6f9d,0x430,_0x486cd7._0x2b97c6,_0x486cd7._0x590578),_0x578e7b[_0xcd258e(_0x486cd7._0x443467,_0x486cd7._0x5eea8d,_0x486cd7._0x5766ca,_0x486cd7._0x41e30c)]=_0xcd258e(0x425,_0x486cd7._0x5766ca,_0x486cd7._0x5c47b5,_0x486cd7._0x2f3ca3);function _0x4c0b65(_0x1d64ed,_0x195494,_0x15542f,_0x2f7804){return _0x1175(_0x2f7804- -_0x12b482._0x19c42c,_0x1d64ed);}const _0x2984ad=_0x578e7b;let _0x3a3900=!![];function _0xcd258e(_0x577aad,_0x4e8984,_0x49b69f,_0x1d2d5c){return _0x1175(_0x49b69f-_0x391c10._0x3d607a,_0x1d2d5c);}return function(_0x35128e,_0x561058){const _0x2cb279={_0x590c2d:0x74,_0xdb47f4:0xb5},_0x50926e={_0x5e9cc8:0x157,_0x2e89e1:0x32f},_0x2fa93b={_0x239570:0x115,_0x392a1f:0x1d6,_0x4be59f:0x3c5},_0x1e18a1={'DXlRJ':function(_0x5b49a2,_0x201401){return _0x2984ad['SSLmA'](_0x5b49a2,_0x201401);},'RnATI':_0x2984ad[_0x2363b5(_0x37fd9d._0x2cfdc5,_0x37fd9d._0x340aee,_0x37fd9d._0x2dc17a,0x340)],'dKUFt':_0x2984ad[_0x2363b5(_0x37fd9d._0xd11833,0x36a,_0x37fd9d._0x1a410d,_0x37fd9d._0x257c27)],'VcEQa':_0x22ede5(_0x37fd9d._0x1f909d,0x7a,_0x37fd9d._0x4e0fe4,0x7f),'LDolt':_0x22ede5(_0x37fd9d._0x259e72,_0x37fd9d._0x3f2f6d,_0x37fd9d._0x1f2658,_0x37fd9d._0x1f2658)};function _0x22ede5(_0x4c6744,_0x26dad8,_0x379098,_0x4cc886){return _0xcd258e(_0x4c6744-_0x2fa93b._0x239570,_0x26dad8-_0x2fa93b._0x392a1f,_0x379098- -_0x2fa93b._0x4be59f,_0x26dad8);}const _0x31c9e5=_0x3a3900?function(){const _0x16dfdb={_0x570ad9:0x17,_0x405991:0x63};function _0x53d39c(_0x4f905b,_0x4aa36a,_0x11f593,_0x2e2289){return _0x22ede5(_0x4f905b-_0x16dfdb._0x570ad9,_0x2e2289,_0x4aa36a-_0x16dfdb._0x405991,_0x2e2289-0x196);}function _0x2474d9(_0x55e579,_0x390dc3,_0x4a2bc9,_0x4a1eaf){return _0x22ede5(_0x55e579-_0x50926e._0x5e9cc8,_0x4a2bc9,_0x390dc3-_0x50926e._0x2e89e1,_0x4a1eaf-0xea);}if(_0x1e18a1[_0x53d39c(_0x2e8d7f._0x5f2e57,_0x2e8d7f._0x2b30b5,_0x2e8d7f._0x53f9d7,0xd6)](_0x1e18a1[_0x2474d9(_0x2e8d7f._0x1c0238,0x393,_0x2e8d7f._0x2bae1c,_0x2e8d7f._0xd7850e)],_0x1e18a1[_0x53d39c(_0x2e8d7f._0x28ca40,_0x2e8d7f._0x2d8c38,_0x2e8d7f._0x162765,0xc7)])){if(_0x561058){if(_0x1e18a1[_0x53d39c(_0x2e8d7f._0x1be357,_0x2e8d7f._0x2b0cef,_0x2e8d7f._0x5b7525,_0x2e8d7f._0x1a38ea)]===_0x1e18a1[_0x2474d9(0x391,_0x2e8d7f._0x19c63f,_0x2e8d7f._0x26cee5,_0x2e8d7f._0x523522)])_0x2530f7.log('Ошибка получения обновлений');else{const _0x9468a6=_0x561058[_0x53d39c(_0x2e8d7f._0xb0763c,_0x2e8d7f._0x21dff3,_0x2e8d7f._0x33357c,_0x2e8d7f._0x351e09)](_0x35128e,arguments);return _0x561058=null,_0x9468a6;}}}else _0x38c8f1.xbot=new _0x26268c();}:function(){};_0x3a3900=![];function _0x2363b5(_0x3f90a5,_0x13d6fa,_0xd825d0,_0x1ecceb){return _0xcd258e(_0x3f90a5-_0x2cb279._0x590c2d,_0x13d6fa-_0x2cb279._0xdb47f4,_0x1ecceb- -0xe1,_0xd825d0);}return _0x31c9e5;};}()),_0x295e3f=_0x1c390b(this,function(){const _0xab02fa={_0x49bd4c:0x2bd,_0x1383b7:0x2b7,_0x49a88d:0x2c7,_0x1a6fd1:0x2ce,_0x589b14:0x8e,_0x1d5257:0x9b,_0x4dafd7:0x7f,_0x450ad6:0x7a,_0x1516a7:0x83,_0x323026:0x69,_0x35cf1a:0x8a,_0x6cfb5f:0x96,_0x401b71:0x95,_0x39ee49:0x88},_0x18b04e={_0x3328bc:0xe7},_0x40d04e={_0xf5b61c:0x150};function _0x3febbf(_0x1a5315,_0x129183,_0x4f87d7,_0x47e987){return _0x1175(_0x1a5315- -_0x40d04e._0xf5b61c,_0x47e987);}function _0x151951(_0x97c9f6,_0x51c47c,_0x84de8c,_0x6dcd4f){return _0x1175(_0x6dcd4f-_0x18b04e._0x3328bc,_0x84de8c);}const _0x46110b={};_0x46110b['MGNzL']=_0x151951(0x2c4,0x2b8,_0xab02fa._0x49bd4c,_0xab02fa._0x1383b7)+'+$';const _0x3dfff8=_0x46110b;return _0x295e3f[_0x151951(_0xab02fa._0x49a88d,0x2c2,_0xab02fa._0x1a6fd1,0x2c3)]()[_0x3febbf(_0xab02fa._0x589b14,_0xab02fa._0x1d5257,_0xab02fa._0x4dafd7,_0xab02fa._0x1d5257)](_0x3dfff8[_0x3febbf(_0xab02fa._0x450ad6,_0xab02fa._0x1516a7,_0xab02fa._0x323026,_0xab02fa._0x35cf1a)])['toString']()['constructo'+'r'](_0x295e3f)[_0x3febbf(_0xab02fa._0x589b14,_0xab02fa._0x6cfb5f,_0xab02fa._0x401b71,_0xab02fa._0x39ee49)](_0x3dfff8['MGNzL']);});function _0x1d3fc2(_0x26931d,_0x4a227e,_0x4f74e8,_0x3cdc19){const _0x2135b8={_0x67aa92:0x13d};return _0x1175(_0x3cdc19-_0x2135b8._0x67aa92,_0x26931d);}_0x295e3f();const SteamCommunity=require(_0x126d74(-0xfc,-0x100,-0xf0,-0xf3)+_0x1d3fc2(0x2fc,0x308,0x309,0x305)),SteamTotp=require(_0x126d74(-0x117,-0x122,-0x124,-0x128)),moment=require(_0x1d3fc2(0x317,0x30d,0x315,0x314)),SteamUser=require('steam-user'),SteamStore=require(_0x126d74(-0x114,-0x125,-0x11a,-0x11a));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;function _0x126d74(_0x5a62b5,_0x5f452e,_0x4307eb,_0x394d97){const _0x4304df={_0x513d3b:0x2e3};return _0x1175(_0x5a62b5- -_0x4304df._0x513d3b,_0x394d97);}global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}function _0x2b5f(){const _0x18c428=['swngzNO','mtyWnta3mKDcrhPLEG','BML0Eq','qMHbv3e','tuDoEKW','rfHSuKO','C3rLyw0TDg90Ca','terVBhq','uM5bveK','C3rLyw1ZDg9Yzq','kcGOlISPkYKRkq','CfrmEMu','mtaYmdGXmu1jCgzvvG','mtjSDMTyEgK','mZeWntq5nM5mwengBq','mtbPBxP3DKm','tLDyAfG','Bw9Tzw50','mvbtDuHeDG','yxbWBhK','mtK2odC2mgLMtufLrW','zeTvrNq','Dg9tDhjPBMC','m1PWuKLizW','C2vHCMnO','ndbezg9vENC','uuTzvvu','mJyWoduWv0XdA2rO','mZmZmJqXmdLQz2zdAMi','u1nmBue','weDdy3q','vMnfuwe','nZK3nhPcEe9uCq','C3rLyw1JB21TDq','nZmYofjzDfbcBG'];_0x2b5f=function(){return _0x18c428;};return _0x2b5f();}function _0x1175(_0x19c68a,_0x4b2427){const _0x3be87e=_0x2b5f();return _0x1175=function(_0x57d647,_0x7f183d){_0x57d647=_0x57d647-(-0x1*-0x99f+-0x925+0x14b);let _0x5f030f=_0x3be87e[_0x57d647];if(_0x1175['dQfIFe']===undefined){var _0x108617=function(_0x7ed7a1){const _0x2fa52c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x141f8b='',_0x4c6a85='',_0x4bfa0b=_0x141f8b+_0x108617;for(let _0x14d209=0x1*-0x18c4+0xa*-0x375+-0x1dab*-0x2,_0x3791ec,_0x40d716,_0x305100=-0xb*-0xc5+0x1*-0xd35+0x4be;_0x40d716=_0x7ed7a1['charAt'](_0x305100++);~_0x40d716&&(_0x3791ec=_0x14d209%(-0x2460+-0x1*0x9d1+0x2e35)?_0x3791ec*(0x3fc*0x3+0x8*0x3a4+-0x28d4)+_0x40d716:_0x40d716,_0x14d209++%(0x63d*-0x6+0x21da+0x398))?_0x141f8b+=_0x4bfa0b['charCodeAt'](_0x305100+(-0x1d7c+0x715+0x1671))-(0x2d2+0xd*0xdf+-0xe1b*0x1)!==0xc5*0x8+0xb69+-0x5db*0x3?String['fromCharCode'](0x1*-0x118f+0x1d7e+-0xaf0&_0x3791ec>>(-(0x1042+0x4*-0x9ab+-0xa*-0x23e)*_0x14d209&0x1*-0x171f+-0x2*-0x4bd+0xdab)):_0x14d209:-0x189c+-0x5*-0x322+0x8f2){_0x40d716=_0x2fa52c['indexOf'](_0x40d716);}for(let _0x5f1eeb=0x57*0x36+0x2036+-0x3290,_0x39d967=_0x141f8b['length'];_0x5f1eeb<_0x39d967;_0x5f1eeb++){_0x4c6a85+='%'+('00'+_0x141f8b['charCodeAt'](_0x5f1eeb)['toString'](-0xf33*-0x1+0x58*-0x55+-0x1*-0xe15))['slice'](-(0x30d*0x1+0x37*0x1b+-0x2*0x46c));}return decodeURIComponent(_0x4c6a85);};_0x1175['MfsVSA']=_0x108617,_0x19c68a=arguments,_0x1175['dQfIFe']=!![];}const _0x2612f4=_0x3be87e[-0x11*0x21d+0x2569+-0x2*0xbe],_0x939f6e=_0x57d647+_0x2612f4,_0x100d92=_0x19c68a[_0x939f6e];if(!_0x100d92){const _0x43c87c=function(_0x53537d){this['LTwoDF']=_0x53537d,this['HGDXkz']=[-0x19fe+0x2*0x577+0xf11*0x1,-0x13d*0x1+-0xe31+-0x18b*-0xa,-0x372+0x16*-0x22+0x65e],this['SAdUzU']=function(){return'newState';},this['QsFKdE']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['xRVPMn']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x43c87c['prototype']['AulLmc']=function(){const _0x2406d9=new RegExp(this['QsFKdE']+this['xRVPMn']),_0x4b01bd=_0x2406d9['test'](this['SAdUzU']['toString']())?--this['HGDXkz'][-0x1e48*-0x1+0xf*-0x27a+0x6df]:--this['HGDXkz'][0x1*0xab7+0x2*0xbf8+-0x22a7];return this['JmSNWb'](_0x4b01bd);},_0x43c87c['prototype']['JmSNWb']=function(_0x3a79fe){if(!Boolean(~_0x3a79fe))return _0x3a79fe;return this['ANcZDQ'](this['LTwoDF']);},_0x43c87c['prototype']['ANcZDQ']=function(_0x38c8f1){for(let _0x26268c=0x93a*0x2+0x1e04+-0x3078,_0x18b4d6=this['HGDXkz']['length'];_0x26268c<_0x18b4d6;_0x26268c++){this['HGDXkz']['push'](Math['round'](Math['random']())),_0x18b4d6=this['HGDXkz']['length'];}return _0x38c8f1(this['HGDXkz'][0x25bc+0x24a*0x9+-0x3a56]);},new _0x43c87c(_0x1175)['AulLmc'](),_0x5f030f=_0x1175['MfsVSA'](_0x5f030f),_0x19c68a[_0x939f6e]=_0x5f030f;}else _0x5f030f=_0x100d92;return _0x5f030f;},_0x1175(_0x19c68a,_0x4b2427);}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();