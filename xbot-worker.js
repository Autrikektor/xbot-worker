(function(_0x5e1dba,_0x10d3f4){const _0x2e2bee={_0x180e2c:0xe2,_0x1929a9:0xe5,_0x5654a7:0xe4,_0x4a8e45:0x2c0,_0x23eebb:0x2c2,_0x2bd5a8:0x2b8,_0x544b75:0xf8,_0x2fc404:0xf3,_0x1815cf:0xf0,_0x44dfcc:0xf5,_0x44aa62:0x29f,_0x57e20c:0x299,_0x39203e:0x2b2,_0x425bd8:0x2a5,_0x3c0c15:0x2af,_0x402c24:0x2bd,_0x23f43d:0x2ba,_0x2959d1:0x2b3,_0xcb7a74:0x2b5,_0x40037c:0x2a9,_0xe47309:0x2b2,_0x53f14c:0x2b1,_0x19e15e:0x2ae,_0x505ec4:0x2ac,_0x4cff76:0x2a8,_0xe522da:0x2a7,_0x314bd9:0xf4,_0x10c293:0xf9,_0xe7afd7:0xf7,_0x25fbc4:0xed},_0x3b8512={_0x16cc03:0x1f7},_0x57fbe3={_0x4a7dfc:0x35},_0x14fb6b=_0x5e1dba();function _0x5c8470(_0x10e969,_0x5a413c,_0x4e9cca,_0x33171f){return _0x689b(_0x5a413c-_0x57fbe3._0x4a7dfc,_0x10e969);}function _0xc4e4bc(_0x45e9ba,_0x5c7895,_0x485742,_0x2e9b60){return _0x689b(_0x2e9b60-_0x3b8512._0x16cc03,_0x45e9ba);}while(!![]){try{const _0x373f5d=-parseInt(_0x5c8470(_0x2e2bee._0x180e2c,0xee,_0x2e2bee._0x1929a9,_0x2e2bee._0x5654a7))/(0x2485*0x1+0x1b58+0xff7*-0x4)+parseInt(_0xc4e4bc(0x2bd,_0x2e2bee._0x4a8e45,_0x2e2bee._0x23eebb,_0x2e2bee._0x2bd5a8))/(0x1880*-0x1+0x22f3+-0x37b*0x3)+parseInt(_0x5c8470(_0x2e2bee._0x544b75,_0x2e2bee._0x2fc404,_0x2e2bee._0x1815cf,_0x2e2bee._0x44dfcc))/(-0x2b7*0xa+0x1f1e+-0x3f5)*(-parseInt(_0xc4e4bc(_0x2e2bee._0x44aa62,_0x2e2bee._0x57e20c,_0x2e2bee._0x39203e,_0x2e2bee._0x425bd8))/(0x23c8+0x4ec+0x1b2*-0x18))+-parseInt(_0xc4e4bc(_0x2e2bee._0x3c0c15,_0x2e2bee._0x2bd5a8,_0x2e2bee._0x402c24,_0x2e2bee._0x23f43d))/(-0x1c3b+-0x98*-0x3b+-0x6c8)*(-parseInt(_0xc4e4bc(_0x2e2bee._0x2959d1,0x2ac,_0x2e2bee._0xcb7a74,_0x2e2bee._0x40037c))/(0xf39+0x5db+0x21b*-0xa))+-parseInt(_0xc4e4bc(_0x2e2bee._0xe47309,_0x2e2bee._0x53f14c,_0x2e2bee._0x19e15e,_0x2e2bee._0x505ec4))/(0x21e8+-0x23cd+0x1ec)+parseInt(_0xc4e4bc(_0x2e2bee._0x4cff76,0x2a4,0x2b3,_0x2e2bee._0xe522da))/(-0xe1*-0x8+-0x1f8b+-0x3d*-0x67)+parseInt(_0x5c8470(_0x2e2bee._0x2fc404,_0x2e2bee._0x314bd9,_0x2e2bee._0x10c293,_0x2e2bee._0xe7afd7))/(-0x1db4+-0x37d*-0x3+0x1346)*(parseInt(_0x5c8470(0xf9,_0x2e2bee._0x25fbc4,0xf6,_0x2e2bee._0x44dfcc))/(0x1*-0xe88+-0x1271+0x2103));if(_0x373f5d===_0x10d3f4)break;else _0x14fb6b['push'](_0x14fb6b['shift']());}catch(_0x124557){_0x14fb6b['push'](_0x14fb6b['shift']());}}}(_0x3717,-0x803*0x72+-0x1c0e1+-0x8e*-0x1da1));const _0x2c1920=(function(){const _0x433575={_0x305da5:0x165,_0x36fec9:0x163,_0x9ae234:0x15d,_0x2ca6fb:0x162,_0x5ed4ad:0x168,_0x183155:0x16d},_0x5bc9f7={_0x4f4ded:0x2a,_0x1d5702:0x28,_0x54946d:0x22,_0x14d968:0x2b,_0xfe912d:0x33,_0xc3c1ea:0x38,_0xd61d94:0x42,_0xcbe5fd:0x38,_0x266000:0x40,_0x3f27c3:0x3c,_0x3b2e84:0x1f,_0x1100cd:0x28},_0x25d242={};_0x25d242[_0x14c340(_0x433575._0x305da5,0x15b,_0x433575._0x36fec9,_0x433575._0x9ae234)]=function(_0x43842c,_0x508c02){return _0x43842c!==_0x508c02;},_0x25d242['IREbJ']=_0x14c340(0x168,0x175,0x168,0x16f),_0x25d242[_0x14c340(_0x433575._0x2ca6fb,0x163,0x15c,0x162)]=_0x14c340(_0x433575._0x5ed4ad,0x173,_0x433575._0x183155,0x178);function _0x487da1(_0x5ca785,_0x48d36c,_0x5067e0,_0x41a289){return _0x689b(_0x5ca785- -0xd,_0x5067e0);}const _0x250a8b=_0x25d242;let _0x1e7f5f=!![];function _0x14c340(_0x3896bd,_0x5c249f,_0x298eb4,_0x4ebc63){return _0x689b(_0x298eb4-0xad,_0x5c249f);}return function(_0x23dedf,_0x4836ef){const _0x35e186=_0x1e7f5f?function(){const _0x3b9217={_0x5ec9dd:0x8e},_0x34e102={_0x3ad4b0:0x309};function _0x5b1205(_0x10978e,_0x549d6b,_0x27615d,_0x15dc5b){return _0x689b(_0x10978e- -_0x34e102._0x3ad4b0,_0x27615d);}function _0x1d8714(_0x13f581,_0x4cda66,_0x394153,_0x52724e){return _0x689b(_0x4cda66- -_0x3b9217._0x5ec9dd,_0x394153);}if(_0x250a8b[_0x1d8714(_0x5bc9f7._0x4f4ded,_0x5bc9f7._0x1d5702,_0x5bc9f7._0x54946d,_0x5bc9f7._0x14d968)](_0x250a8b[_0x1d8714(_0x5bc9f7._0xfe912d,_0x5bc9f7._0xc3c1ea,0x35,_0x5bc9f7._0xd61d94)],_0x250a8b[_0x1d8714(0x42,_0x5bc9f7._0xcbe5fd,_0x5bc9f7._0x266000,_0x5bc9f7._0x3f27c3)]))_0x4a6eb4.log('Бот обновляется'),_0x479327.log(_0x362895('git checkout -f .').toString()),_0x143039.log(_0x5ca271('git pull').toString()),_0x2fd5ec.log(_0x3fa25e('npm upgrade --force --no-audit').toString()),_0x35ef6a.log(_0x49aaae('npm i --force --no-audit').toString()),_0x726899.log('Перезапуск'),_0x415848.exit(0);else{if(_0x4836ef){if(_0x250a8b[_0x1d8714(_0x5bc9f7._0x3b2e84,_0x5bc9f7._0x1100cd,0x26,0x28)](_0x1d8714(0x2e,0x26,0x31,0x2c),_0x250a8b['fQHzs'])){const _0x11cfce=_0x4836ef['apply'](_0x23dedf,arguments);return _0x4836ef=null,_0x11cfce;}else{let codeActionTypes=[_0x500de7.EAuthSessionGuardType.EmailCode,_0x2c82a2.EAuthSessionGuardType.DeviceCode];let codeAction=_0x257066.validActions.find(action=>codeActionTypes.includes(action.type));}}}}:function(){};return _0x1e7f5f=![],_0x35e186;};}()),_0x4e57d0=_0x2c1920(this,function(){const _0x234e96={_0x218acf:0x1b,_0x530fd2:0x16,_0xf11852:0x182,_0x3655ac:0x176,_0x395522:0x172,_0x50cccc:0x17e,_0x31691f:0x177,_0x54b8a1:0x17c,_0x4b6186:0x161,_0x5686e6:0x178,_0x4fcdb4:0x162,_0xca3b56:0x175,_0x4af5b1:0x175,_0x4e2619:0x171},_0x496674={_0x38d2c3:0xdf},_0x421b7f={_0x47ecc7:0x231};function _0x33d6b2(_0xaee6b9,_0x2ba3a9,_0x59c4f1,_0x2d7d10){return _0x689b(_0xaee6b9- -_0x421b7f._0x47ecc7,_0x2d7d10);}function _0x48db5a(_0x15ea20,_0x514359,_0xe21129,_0x52df4e){return _0x689b(_0xe21129- -_0x496674._0x38d2c3,_0x514359);}return _0x4e57d0[_0x33d6b2(-0x174,-0x17b,-0x176,-0x17c)]()[_0x48db5a(-_0x234e96._0x218acf,-0x24,-_0x234e96._0x218acf,-_0x234e96._0x530fd2)](_0x33d6b2(-0x175,-0x16a,-_0x234e96._0xf11852,-0x180)+'+$')[_0x33d6b2(-0x174,-_0x234e96._0x3655ac,-_0x234e96._0x395522,-0x176)]()[_0x33d6b2(-_0x234e96._0x50cccc,-_0x234e96._0x31691f,-_0x234e96._0x54b8a1,-0x182)+'r'](_0x4e57d0)[_0x33d6b2(-0x16d,-_0x234e96._0x4b6186,-_0x234e96._0x5686e6,-_0x234e96._0x4fcdb4)](_0x33d6b2(-_0x234e96._0xca3b56,-_0x234e96._0x4af5b1,-_0x234e96._0x50cccc,-_0x234e96._0x4e2619)+'+$');});_0x4e57d0();const SteamCommunity=require('steamcommu'+_0x47f449(0x23b,0x23f,0x236,0x23e)),SteamTotp=require(_0x47f449(0x249,0x24b,0x253,0x247)),moment=require(_0x47f449(0x235,0x23e,0x235,0x23a)),SteamUser=require(_0x47f449(0x23e,0x23b,0x248,0x245)),SteamStore=require(_0x47f449(0x246,0x23b,0x239,0x244));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();function _0x47f449(_0x4d1a37,_0x55150d,_0x45b89e,_0xc71348){const _0x484663={_0x2cf932:0x184};return _0x689b(_0x4d1a37-_0x484663._0x2cf932,_0x45b89e);}global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};function _0x3717(){const _0x137977=['zLfiENm','ntC1nZu0nfjJwM10Bq','Bw9Tzw50','mty2mKXxtNnJwG','y29UC3rYDwn0BW','CwHlq0i','odiXnZy2nez2uxvKwq','vLHYy1O','BML0Eq','mJbyqLjTv2i','mteYnJmWnenTs1bStG','C3rLyw0TDxnLCG','rgHTA1q','kcGOlISPkYKRkq','Dg9tDhjPBMC','ntu5mte5zeXRzM9m','ndu5odC5m2Xhz0jpsW','ExfUEM4','ntqYmtK0y0LqBuHU','C3rLyw1ZDg9Yzq','mJuWnJv3rufhwLO','C2vHCMnO','C3rLyw0TDg90Ca','svjfyKO','offztMvmsG'];_0x3717=function(){return _0x137977;};return _0x3717();}global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};console.log(global.data.version);if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};function _0x41c1cd(_0x6d5a13,_0x417807,_0xe65658,_0x2a91f5){const _0xa2c5a4={_0x3b82ae:0x131};return _0x689b(_0x2a91f5-_0xa2c5a4._0x3b82ae,_0x417807);}const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};function _0x689b(_0xf61a7e,_0x408461){const _0x19a4f3=_0x3717();return _0x689b=function(_0xe6570d,_0x329a83){_0xe6570d=_0xe6570d-(-0x13ec+-0x3*0x87f+-0x51f*-0x9);let _0x5cf0c5=_0x19a4f3[_0xe6570d];if(_0x689b['UabBng']===undefined){var _0x1679cf=function(_0x500d68){const _0x25525c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x13e1aa='',_0x4797b5='',_0x55f5e7=_0x13e1aa+_0x1679cf;for(let _0x558cc9=0x1*-0x213+-0x46b+0x67e,_0x1ab33f,_0x30df43,_0x1b4284=0x1*0x1fbe+0x121*-0x15+-0x809;_0x30df43=_0x500d68['charAt'](_0x1b4284++);~_0x30df43&&(_0x1ab33f=_0x558cc9%(0x24c+0x2*-0x2a7+-0x306*-0x1)?_0x1ab33f*(-0x1abe*-0x1+0x22e2+0x3d60*-0x1)+_0x30df43:_0x30df43,_0x558cc9++%(0x1802+0x2*0x1079+-0x38f0))?_0x13e1aa+=_0x55f5e7['charCodeAt'](_0x1b4284+(-0xd9*0x2e+-0x922+0x302a))-(-0x71*0x58+-0x191+0x6d*0x5f)!==-0x129c*-0x1+0x15e+-0x13fa?String['fromCharCode'](-0x5e6+0x7d*-0x49+0x2a8a&_0x1ab33f>>(-(0x6*-0x8a+-0xeeb+0x1229)*_0x558cc9&-0x79b+-0xf97+0x1738)):_0x558cc9:0x228a+0x1e56+-0x40e0){_0x30df43=_0x25525c['indexOf'](_0x30df43);}for(let _0x1f9c24=-0x120*-0xa+0xd92*-0x2+0x9*0x1c4,_0x3f6693=_0x13e1aa['length'];_0x1f9c24<_0x3f6693;_0x1f9c24++){_0x4797b5+='%'+('00'+_0x13e1aa['charCodeAt'](_0x1f9c24)['toString'](-0xd*-0x232+-0xf74*-0x1+0x2*-0x15f7))['slice'](-(-0x2f*0xd1+0x1ef2+-0x76f*-0x1));}return decodeURIComponent(_0x4797b5);};_0x689b['aUdqFe']=_0x1679cf,_0xf61a7e=arguments,_0x689b['UabBng']=!![];}const _0x1c68b6=_0x19a4f3[-0x972+0x12b*0xd+0xd*-0x71],_0xf76df7=_0xe6570d+_0x1c68b6,_0x132d56=_0xf61a7e[_0xf76df7];if(!_0x132d56){const _0x58f8ce=function(_0x7ad0b3){this['JsOIBG']=_0x7ad0b3,this['ypnXhN']=[0x5*0x1f7+-0x84a+-0x2*0xc4,-0x5fd+-0x1*-0x366+0x297,0x1698+-0x2c*-0x43+-0x221c],this['PgmIgT']=function(){return'newState';},this['XUYjkr']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['UGPhRf']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x58f8ce['prototype']['zeVbat']=function(){const _0x3fd6c0=new RegExp(this['XUYjkr']+this['UGPhRf']),_0x29966b=_0x3fd6c0['test'](this['PgmIgT']['toString']())?--this['ypnXhN'][-0xf04+0x16*-0xf1+0x23bb]:--this['ypnXhN'][-0x1*-0x94f+0x1*-0x2671+-0x42*-0x71];return this['MXRYOL'](_0x29966b);},_0x58f8ce['prototype']['MXRYOL']=function(_0xda7ed){if(!Boolean(~_0xda7ed))return _0xda7ed;return this['ndQKOT'](this['JsOIBG']);},_0x58f8ce['prototype']['ndQKOT']=function(_0x38a0ce){for(let _0x47b405=0x53b*0x1+0xc86+-0x11c1,_0x133a4f=this['ypnXhN']['length'];_0x47b405<_0x133a4f;_0x47b405++){this['ypnXhN']['push'](Math['round'](Math['random']())),_0x133a4f=this['ypnXhN']['length'];}return _0x38a0ce(this['ypnXhN'][0x200b+-0x24b*0x7+-0x2*0x7ff]);},new _0x58f8ce(_0x689b)['zeVbat'](),_0x5cf0c5=_0x689b['aUdqFe'](_0x5cf0c5),_0xf61a7e[_0xf76df7]=_0x5cf0c5;}else _0x5cf0c5=_0x132d56;return _0x5cf0c5;},_0x689b(_0xf61a7e,_0x408461);}global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();