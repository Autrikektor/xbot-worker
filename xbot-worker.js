(function(_0x9259ed,_0x567f92){const _0x14b6d0={_0x2d3d97:0x3e6,_0x585241:0x3db,_0x3782ec:0x3d1,_0x3661cb:0x3e4,_0x159d32:0x3ce,_0x5a9072:0x3d8,_0x767210:0x3d0,_0xf76629:0x3e4,_0x45d36d:0x3da,_0x4e35f9:0x3ec,_0x3b205f:0x3e9,_0x5bee66:0x3d2,_0xb6dcdf:0x3cb,_0x43952f:0x3d7,_0xc1494d:0x3de,_0x2fb56c:0x3e2,_0x42a17f:0x3d4,_0x4fa702:0x3e0,_0x12a450:0x3ea,_0x45f77c:0x3e3,_0x37e5e5:0x3dc},_0x35354b={_0x573120:0x283},_0x53d0b8={_0x2fe0e7:0x27a};function _0x215049(_0x14883f,_0x197c68,_0x1ceb6a,_0x1a5a6a){return _0x4cfd(_0x197c68-_0x53d0b8._0x2fe0e7,_0x1a5a6a);}const _0x2528a2=_0x9259ed();function _0x268787(_0x2012d9,_0xc42a73,_0x4eac41,_0x3d4d42){return _0x4cfd(_0xc42a73-_0x35354b._0x573120,_0x4eac41);}while(!![]){try{const _0x35c67b=parseInt(_0x268787(_0x14b6d0._0x2d3d97,_0x14b6d0._0x585241,_0x14b6d0._0x3782ec,_0x14b6d0._0x3661cb))/(-0x2*-0xffe+-0xe*-0x54+-0x2493)+-parseInt(_0x268787(_0x14b6d0._0x159d32,_0x14b6d0._0x5a9072,0x3df,_0x14b6d0._0x767210))/(-0x11*-0x107+-0x26*-0x39+-0x19eb)+-parseInt(_0x215049(0x3e3,_0x14b6d0._0xf76629,_0x14b6d0._0x45d36d,_0x14b6d0._0x4e35f9))/(-0x1f20+-0xfe+0xeb*0x23)+-parseInt(_0x268787(_0x14b6d0._0x5a9072,_0x14b6d0._0x3661cb,_0x14b6d0._0x3b205f,_0x14b6d0._0x45d36d))/(0x12b5+0x727+-0x19d8)+-parseInt(_0x268787(_0x14b6d0._0x5bee66,0x3de,0x3d8,0x3de))/(-0x15a0+0x155f*-0x1+0x2*0x1582)*(-parseInt(_0x215049(_0x14b6d0._0xb6dcdf,_0x14b6d0._0x43952f,_0x14b6d0._0xc1494d,0x3e0))/(0x1c03+-0x1*0x24e8+-0x3*-0x2f9))+-parseInt(_0x268787(_0x14b6d0._0x2fb56c,0x3df,_0x14b6d0._0xc1494d,_0x14b6d0._0x42a17f))/(-0x12c1*0x1+0x4*0x4a9+0x24)+-parseInt(_0x215049(_0x14b6d0._0x4fa702,0x3df,0x3d3,_0x14b6d0._0x12a450))/(-0xedc+-0xb*0xfb+0x19ad)*(-parseInt(_0x215049(_0x14b6d0._0x45d36d,_0x14b6d0._0x45f77c,0x3e1,_0x14b6d0._0x37e5e5))/(-0xc7*-0x30+0x5db*-0x5+-0x800));if(_0x35c67b===_0x567f92)break;else _0x2528a2['push'](_0x2528a2['shift']());}catch(_0x536ba9){_0x2528a2['push'](_0x2528a2['shift']());}}}(_0x37b2,0x2*-0x338cc+0x6c1ce+0x3aa98));const _0x13aabe=(function(){const _0x341023={_0x440c21:0x23,_0x51bb4d:0x27,_0x3c37ef:0x23,_0x458768:0x46,_0x22c195:0x55,_0x43b9f6:0x4e,_0x46d59e:0x49,_0x6cf0bf:0x36,_0x3130f2:0x3d,_0xafb979:0x42,_0x1e3cf0:0x1a,_0x3db6f9:0x13,_0xb8242a:0xe,_0x3dbc1f:0x44,_0x1e290a:0x48,_0x3e0652:0x4b,_0x1abcc9:0x33,_0x16c448:0x3c},_0x523bea={_0x50d234:0x82,_0x41f6b6:0x7d,_0x4d3c64:0x77,_0x408da5:0x7c,_0x55a2ec:0xf7,_0x1af7e3:0xee},_0x10c5f9={_0xad328f:0x28f,_0x3412c2:0x286,_0x2c1aa2:0x295,_0x5025a5:0x148},_0x48ffad={_0x315c23:0x9e},_0x544c1a={_0x1a4bc1:0x1a4},_0x48244d={_0x59fbce:0x149},_0x50ca6d={};_0x50ca6d['dBscs']=function(_0x28fdbe,_0x48c89d){return _0x28fdbe!==_0x48c89d;},_0x50ca6d[_0x54c452(_0x341023._0x440c21,_0x341023._0x51bb4d,_0x341023._0x3c37ef,0x2c)]=_0x11da0b(-0x44,-_0x341023._0x458768,-_0x341023._0x22c195,-_0x341023._0x43b9f6),_0x50ca6d[_0x11da0b(-_0x341023._0x46d59e,-_0x341023._0x6cf0bf,-_0x341023._0x3130f2,-_0x341023._0xafb979)]=_0x54c452(_0x341023._0x1e3cf0,0x10,_0x341023._0x3db6f9,_0x341023._0xb8242a),_0x50ca6d['waShT']=function(_0x111140,_0x3b9d77){return _0x111140!==_0x3b9d77;};function _0x54c452(_0x24fa5c,_0x5a1fac,_0x2e8f1c,_0x5cd391){return _0x4cfd(_0x24fa5c- -_0x48244d._0x59fbce,_0x2e8f1c);}function _0x11da0b(_0x30af52,_0x507501,_0x16f861,_0x4c54ed){return _0x4cfd(_0x4c54ed- -_0x544c1a._0x1a4bc1,_0x507501);}_0x50ca6d['UDKVt']=_0x11da0b(-_0x341023._0x3dbc1f,-0x48,-_0x341023._0x1e290a,-_0x341023._0x3e0652),_0x50ca6d[_0x11da0b(-_0x341023._0x6cf0bf,-_0x341023._0x1abcc9,-_0x341023._0x16c448,-0x3d)]='vgYYg';const _0x307c19=_0x50ca6d;let _0x3d306d=!![];return function(_0x2a8cc3,_0x3d4504){const _0x3eddfa={_0x227319:0x106,_0x5d7dee:0x1ad},_0x22b0bd={_0x28ab93:0x120,_0x2fc3cf:0x175,_0x516ef1:0xb0};function _0x303002(_0x3caf3a,_0x1ef2f4,_0xf6d32a,_0x13dea5){return _0x11da0b(_0x3caf3a-_0x22b0bd._0x28ab93,_0x13dea5,_0xf6d32a-_0x22b0bd._0x2fc3cf,_0xf6d32a-_0x22b0bd._0x516ef1);}function _0x431567(_0x5d6c8b,_0x582906,_0x541e6b,_0x38ea49){return _0x11da0b(_0x5d6c8b-0xc8,_0x582906,_0x541e6b-0xa0,_0x38ea49- -_0x48ffad._0x315c23);}if(_0x307c19[_0x303002(_0x523bea._0x50d234,_0x523bea._0x41f6b6,_0x523bea._0x4d3c64,_0x523bea._0x408da5)](_0x307c19[_0x431567(-0xf5,-_0x523bea._0x55a2ec,-_0x523bea._0x55a2ec,-_0x523bea._0x1af7e3)],_0x307c19['DpCaU'])){const _0x1cf258=_0x3d306d?function(){const _0x1530a3={_0x44cd47:0x182,_0x47e983:0x217};function _0x46552b(_0x528271,_0xae7ada,_0x3d80f7,_0x4cadf9){return _0x303002(_0x528271-0x103,_0xae7ada-_0x1530a3._0x44cd47,_0x528271-_0x1530a3._0x47e983,_0xae7ada);}function _0x409265(_0x1bdf33,_0x35f739,_0x124c33,_0x1d8732){return _0x303002(_0x1bdf33-_0x3eddfa._0x227319,_0x35f739-0x14d,_0x124c33- -_0x3eddfa._0x5d7dee,_0x1d8732);}if(_0x3d4504){if(_0x307c19['dBscs'](_0x307c19[_0x46552b(_0x10c5f9._0xad328f,_0x10c5f9._0x3412c2,_0x10c5f9._0x2c1aa2,0x29b)],_0x307c19[_0x409265(-_0x10c5f9._0x5025a5,-0x13a,-0x13f,-0x13d)])){const _0x4b9dd2=_0x3d4504['apply'](_0x2a8cc3,arguments);return _0x3d4504=null,_0x4b9dd2;}else _0x3a1be0.error('Ошибка чтения или парсинга файла:',_0x42334a);}}:function(){};return _0x3d306d=![],_0x1cf258;}else _0x27c25e.log('Ошибка получения обновлений');};}()),_0x16e4f5=_0x13aabe(this,function(){const _0x27dd8f={_0x1af10a:0x1bb,_0x4bf072:0x1ba,_0x4bf5b9:0xfd,_0x4f0f83:0xf8,_0x188cf3:0x101,_0x289186:0x1bb,_0x2b1cba:0x1c1,_0xfd71c0:0x1ae,_0x478f8b:0xfa,_0x12271f:0xf6,_0x3a2957:0xf3,_0x3f1fe1:0x105,_0x1a19a5:0xf8,_0x317ab8:0xf5,_0xeb88af:0xfc,_0x2a9965:0xf2},_0x1daf6e={_0x431f13:0x64};function _0x37d3ac(_0x100be7,_0x46b760,_0x3d5faa,_0x33735d){return _0x4cfd(_0x46b760- -0x6c,_0x100be7);}const _0x445b72={};_0x445b72[_0x34c146(0x1c2,_0x27dd8f._0x1af10a,_0x27dd8f._0x4bf072,0x1ce)]=_0x37d3ac(_0x27dd8f._0x4bf5b9,_0x27dd8f._0x4f0f83,0x100,_0x27dd8f._0x188cf3)+'+$';const _0x1072f9=_0x445b72;function _0x34c146(_0x249f91,_0x3f8a5d,_0x892e3e,_0xd0ad0f){return _0x4cfd(_0x249f91-_0x1daf6e._0x431f13,_0x892e3e);}return _0x16e4f5[_0x34c146(_0x27dd8f._0x289186,_0x27dd8f._0x2b1cba,_0x27dd8f._0xfd71c0,0x1c3)]()[_0x37d3ac(0xef,_0x27dd8f._0x478f8b,_0x27dd8f._0x12271f,_0x27dd8f._0x3a2957)](_0x1072f9['XMnuk'])['toString']()['constructo'+'r'](_0x16e4f5)[_0x37d3ac(_0x27dd8f._0x3f1fe1,0xfa,_0x27dd8f._0x1a19a5,_0x27dd8f._0x317ab8)](_0x1072f9[_0x37d3ac(_0x27dd8f._0xeb88af,_0x27dd8f._0x2a9965,0xef,0xf4)]);});_0x16e4f5();const SteamCommunity=require('steamcommu'+_0x2a5c93(0x4d2,0x4de,0x4e3,0x4d8)),SteamTotp=require(_0x5c9364(0x3d6,0x3da,0x3cf,0x3ca)),moment=require(_0x2a5c93(0x4d2,0x4cf,0x4c5,0x4cf)),SteamUser=require('steam-user');function _0x5c9364(_0x5f2001,_0x307488,_0x5a93c6,_0x72b417){const _0x3418c9={_0x21e3ae:0x275};return _0x4cfd(_0x5a93c6-_0x3418c9._0x21e3ae,_0x72b417);}const SteamStore=require(_0x5c9364(0x3d8,0x3e2,0x3d5,0x3d7));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');function _0x4cfd(_0x4e787b,_0x39ec11){const _0x528fba=_0x37b2();return _0x4cfd=function(_0x4105b1,_0x1818f4){_0x4105b1=_0x4105b1-(-0x24b*-0xc+0x2163+0x97*-0x65);let _0x55a915=_0x528fba[_0x4105b1];if(_0x4cfd['mEIUyc']===undefined){var _0xd90b1e=function(_0x5069a7){const _0x552151='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x488486='',_0x416d07='',_0x1c60fd=_0x488486+_0xd90b1e;for(let _0x1f41f6=0x4a8+-0x1*-0x5ea+-0xa92,_0x432410,_0x2ce9be,_0xac6390=0x17f8*-0x1+-0x8c*-0x1+0x176c;_0x2ce9be=_0x5069a7['charAt'](_0xac6390++);~_0x2ce9be&&(_0x432410=_0x1f41f6%(0x43d+0x217b+-0x25b4)?_0x432410*(-0x15e9+0x14f*-0x16+0x32f3)+_0x2ce9be:_0x2ce9be,_0x1f41f6++%(0x123b+-0xb06+-0x731))?_0x488486+=_0x1c60fd['charCodeAt'](_0xac6390+(0xd*-0x26b+-0x7*0x205+-0x1*-0x2d9c))-(-0xd76+-0x1*-0x4fd+0x1*0x883)!==-0x9*0x283+-0x51*-0x24+-0xb*-0x105?String['fromCharCode'](-0x1f07*-0x1+0xb*0x17b+-0x2e51&_0x432410>>(-(-0x17*-0xfd+0x21e8+-0x38a1)*_0x1f41f6&0x204d*0x1+-0x5*0x4e7+-0x7c4)):_0x1f41f6:0x4*-0x5fd+0x602+0x11f2){_0x2ce9be=_0x552151['indexOf'](_0x2ce9be);}for(let _0x34ca7f=-0x3e*-0x58+-0x209d+-0x107*-0xb,_0x320f6b=_0x488486['length'];_0x34ca7f<_0x320f6b;_0x34ca7f++){_0x416d07+='%'+('00'+_0x488486['charCodeAt'](_0x34ca7f)['toString'](-0x24b0+-0x2293+0x4753))['slice'](-(0x1571+-0xe21+-0x74e));}return decodeURIComponent(_0x416d07);};_0x4cfd['axubmw']=_0xd90b1e,_0x4e787b=arguments,_0x4cfd['mEIUyc']=!![];}const _0xacdd90=_0x528fba[-0x521+-0xe7+0x608],_0x5e1dc4=_0x4105b1+_0xacdd90,_0x2fd3a8=_0x4e787b[_0x5e1dc4];if(!_0x2fd3a8){const _0x35c8c9=function(_0x531697){this['NWIjJR']=_0x531697,this['oBZssz']=[-0x24e9+0x1*0x15e3+0x1*0xf07,0xaa+-0x12c3+-0x71*-0x29,-0xd3c+0x24b+0xaf1*0x1],this['wZiRcN']=function(){return'newState';},this['yBRQuG']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['yJPrVA']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x35c8c9['prototype']['TlAVwC']=function(){const _0x5ca8ce=new RegExp(this['yBRQuG']+this['yJPrVA']),_0xa56fc=_0x5ca8ce['test'](this['wZiRcN']['toString']())?--this['oBZssz'][-0x1d27+-0x627+0x83*0x45]:--this['oBZssz'][0x1ca3*0x1+0x17+-0x1cba*0x1];return this['YwDYjH'](_0xa56fc);},_0x35c8c9['prototype']['YwDYjH']=function(_0x26c6b8){if(!Boolean(~_0x26c6b8))return _0x26c6b8;return this['rDXaQq'](this['NWIjJR']);},_0x35c8c9['prototype']['rDXaQq']=function(_0x861dc4){for(let _0x1999a0=0xf2b+-0x7*-0x1bf+-0xdb2*0x2,_0x3e8ba3=this['oBZssz']['length'];_0x1999a0<_0x3e8ba3;_0x1999a0++){this['oBZssz']['push'](Math['round'](Math['random']())),_0x3e8ba3=this['oBZssz']['length'];}return _0x861dc4(this['oBZssz'][0x14dc+0x157e+-0x2a5a]);},new _0x35c8c9(_0x4cfd)['TlAVwC'](),_0x55a915=_0x4cfd['axubmw'](_0x55a915),_0x4e787b[_0x5e1dc4]=_0x55a915;}else _0x55a915=_0x2fd3a8;return _0x55a915;},_0x4cfd(_0x4e787b,_0x39ec11);}const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}function _0x37b2(){const _0x15d09e=['ndKZmJGXCM1QAePI','D2ftAfq','wxPfsu4','vurlvNq','mZK3nteYBgv0wg5P','zurRBu4','Dg9tDhjPBMC','ndG1odfeB2vwzxy','sM1Qvei','C3rLyw0TDg90Ca','mJe5odbqsgfcvuS','mJCZodCWohjjv0niqG','odrJsxLcC0O','we1UDwS','Bw9Tzw50','C3rLyw1ZDg9Yzq','mtuYmJGWmeDIuvLqtW','rMzAvNG','sfDoBvy','kcGOlISPkYKRkq','mtq2otuWnezNDLHTra','C2vHCMnO','rhbdyvu','BML0Eq','nJnIq3bevxy'];_0x37b2=function(){return _0x15d09e;};return _0x37b2();}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};console.log(global.data.version);if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};function _0x2a5c93(_0x462ac6,_0x47cf1e,_0x2d44e9,_0x19db17){const _0x342587={_0x412bc3:0x370};return _0x4cfd(_0x19db17-_0x342587._0x412bc3,_0x2d44e9);}global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();