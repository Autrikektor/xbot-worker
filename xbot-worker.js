(function(_0x58d70a,_0x25a7e7){const _0x5d8a11={_0x4418cd:0x18b,_0x40e20c:0x197,_0x5b9e73:0x182,_0x556d01:0x10a,_0x31a511:0x104,_0x19b381:0x10b,_0x7a63ee:0xfd,_0x49785c:0x190,_0x12a1d6:0x195,_0x5d0cdb:0x19e,_0x3fd7b5:0x194,_0x1c1b7f:0xfc,_0x4a8d4c:0xfb,_0x255e40:0x107,_0x19b5de:0x196,_0xc37cc2:0x1a1,_0x19ebb1:0x109,_0x42d87f:0x10e,_0x276560:0x19d,_0x247f89:0xff,_0x1522ee:0xf9,_0x259169:0x199,_0x7598de:0x1a0,_0xbb5c90:0x1a0},_0x56d18f={_0x5135f0:0x36b},_0xb946={_0x4e1b9f:0x2d4};function _0x49124e(_0xe85ec0,_0x1fd93a,_0x75b7d2,_0x5be941){return _0x51ba(_0xe85ec0- -_0xb946._0x4e1b9f,_0x75b7d2);}const _0xb5f4d1=_0x58d70a();function _0x2030df(_0xea7b20,_0x21920d,_0x3376db,_0x32af07){return _0x51ba(_0x32af07- -_0x56d18f._0x5135f0,_0xea7b20);}while(!![]){try{const _0x36e652=parseInt(_0x2030df(-_0x5d8a11._0x4418cd,-_0x5d8a11._0x40e20c,-_0x5d8a11._0x5b9e73,-_0x5d8a11._0x4418cd))/(0xa08*-0x1+-0x1*-0x1579+-0x2*0x5b8)+parseInt(_0x49124e(-_0x5d8a11._0x556d01,-_0x5d8a11._0x31a511,-_0x5d8a11._0x19b381,-_0x5d8a11._0x7a63ee))/(0x1*-0x1a14+-0xcae*-0x2+0xba)*(-parseInt(_0x2030df(-_0x5d8a11._0x49785c,-_0x5d8a11._0x12a1d6,-_0x5d8a11._0x5d0cdb,-_0x5d8a11._0x3fd7b5))/(-0x880+0x95d+-0xda))+-parseInt(_0x49124e(-_0x5d8a11._0x1c1b7f,-_0x5d8a11._0x4a8d4c,-_0x5d8a11._0x7a63ee,-_0x5d8a11._0x255e40))/(-0x19ec+0x183c+-0x4*-0x6d)*(parseInt(_0x49124e(-_0x5d8a11._0x255e40,-0x104,-0xff,-0xfc))/(0x353*-0xa+0x95*0x37+0x14*0x10))+parseInt(_0x2030df(-_0x5d8a11._0x3fd7b5,-_0x5d8a11._0x19b5de,-_0x5d8a11._0xc37cc2,-0x19f))/(0x11*-0x14+-0x3d0+0x2*0x295)+parseInt(_0x49124e(-_0x5d8a11._0x19b381,-_0x5d8a11._0x19ebb1,-_0x5d8a11._0x556d01,-_0x5d8a11._0x42d87f))/(-0x10ad+-0xe*0x20c+0x2d5c)+parseInt(_0x2030df(-_0x5d8a11._0x5d0cdb,-0x195,-_0x5d8a11._0x276560,-_0x5d8a11._0x40e20c))/(0x6d*0x3d+-0x25aa+0xbb9)+-parseInt(_0x49124e(-_0x5d8a11._0x247f89,-_0x5d8a11._0x31a511,-_0x5d8a11._0x1522ee,-_0x5d8a11._0x1522ee))/(-0x24eb+0x1841+-0xcb3*-0x1)*(parseInt(_0x2030df(-0x19e,-_0x5d8a11._0x259169,-_0x5d8a11._0x7598de,-_0x5d8a11._0xbb5c90))/(0x46f*-0x5+0xa1f+0xc16));if(_0x36e652===_0x25a7e7)break;else _0xb5f4d1['push'](_0xb5f4d1['shift']());}catch(_0x489e0e){_0xb5f4d1['push'](_0xb5f4d1['shift']());}}}(_0x1b39,0x1*0xf2945+0x1*0x13464a+0x7213a*-0x3));const _0x3d3c4f=(function(){const _0x433c04={_0x3f28b5:0xb,_0x488691:0xd,_0xfa3406:0x8,_0x1fd752:0x14,_0x21903c:0xf,_0xed4f9d:0x107,_0x44bc6d:0xfd,_0x10c482:0xdd,_0x6e7195:0xda,_0x4b3e5b:0xf1,_0xc7a90:0xe5},_0x1d8d17={_0x35edce:0xe2},_0x574e53={};_0x574e53[_0x171b86(-_0x433c04._0x3f28b5,-_0x433c04._0x488691,-_0x433c04._0xfa3406,-0x17)]=function(_0x199518,_0x3b7356){return _0x199518===_0x3b7356;};function _0x41a0c6(_0x52dd52,_0x3b3373,_0x407ebb,_0x4ff42a){return _0x51ba(_0x4ff42a- -_0x1d8d17._0x35edce,_0x52dd52);}_0x574e53[_0x171b86(-_0x433c04._0x1fd752,-0xe,-_0x433c04._0x21903c,-0x7)]=_0x41a0c6(_0x433c04._0xed4f9d,0xff,0x104,_0x433c04._0x44bc6d),_0x574e53['OmwKP']=_0x41a0c6(_0x433c04._0x10c482,_0x433c04._0x6e7195,_0x433c04._0x4b3e5b,_0x433c04._0xc7a90);function _0x171b86(_0x27846a,_0x3d2305,_0x30dc2c,_0x418e35){return _0x51ba(_0x27846a- -0x1e4,_0x30dc2c);}const _0x168c2c=_0x574e53;let _0x4cf8fa=!![];return function(_0x2e59cd,_0x255d32){const _0x3a7d03={_0x1222fd:0x1d2,_0x2f3dc5:0x1dd,_0xe2a6c:0x1cb,_0x51ed14:0x1d8,_0x1dddd5:0x101,_0x10345e:0xf5,_0x3b3941:0xf5,_0x2f3389:0x10a,_0x514a56:0xf4,_0x19b497:0xf9,_0x3cc5af:0xfb,_0x3b4d1f:0x100,_0x6d4876:0x1df},_0x480e3e={_0x380b84:0x2d0},_0x4ad56f=_0x4cf8fa?function(){function _0x58aee8(_0x183bf6,_0x413ca4,_0x4538f8,_0xfc21e){return _0x51ba(_0x183bf6- -_0x480e3e._0x380b84,_0xfc21e);}function _0x385bbe(_0x16e9ac,_0x46c2df,_0xcd3fa4,_0x3ad996){return _0x51ba(_0x3ad996-0x8,_0x16e9ac);}if(_0x168c2c['sjeEt'](_0x168c2c[_0x385bbe(_0x3a7d03._0x1222fd,_0x3a7d03._0x2f3dc5,_0x3a7d03._0xe2a6c,_0x3a7d03._0x51ed14)],_0x168c2c[_0x58aee8(-_0x3a7d03._0x1dddd5,-_0x3a7d03._0x10345e,-_0x3a7d03._0x3b3941,-_0x3a7d03._0x2f3389)])){const _0x2685c5=_0x6ac644[_0x58aee8(-_0x3a7d03._0x514a56,-_0x3a7d03._0x19b497,-_0x3a7d03._0x3cc5af,-_0x3a7d03._0x3b4d1f)](_0x830da9,arguments);return _0x38f75a=null,_0x2685c5;}else{if(_0x255d32){const _0x2d2681=_0x255d32[_0x385bbe(0x1dd,_0x3a7d03._0x6d4876,_0x3a7d03._0x51ed14,0x1e4)](_0x2e59cd,arguments);return _0x255d32=null,_0x2d2681;}}}:function(){};return _0x4cf8fa=![],_0x4ad56f;};}()),_0xdc084a=_0x3d3c4f(this,function(){const _0x578a8f={_0x273754:0x92,_0x1b5408:0x9c,_0x129f1c:0x9c,_0xdebb8:0x9b,_0x5ac6ae:0x9f,_0x53bc5c:0xa1,_0x4e221e:0xa0,_0x352beb:0xaa,_0x18cae4:0xb5,_0x5e4d62:0xac,_0x3bd560:0x9d,_0xa3cf80:0xa5,_0x4aaa65:0x44,_0x311fc1:0x3d,_0x5c6350:0x3a,_0x25a51c:0xb7,_0x49eaa7:0xb4,_0x11937a:0x97,_0xe49e54:0xa1,_0x2e0068:0xac},_0x2cf3cb={};_0x2cf3cb[_0x1aa602(_0x578a8f._0x273754,_0x578a8f._0x1b5408,0x9d,_0x578a8f._0x129f1c)]=_0x1aa602(_0x578a8f._0xdebb8,_0x578a8f._0x5ac6ae,_0x578a8f._0x53bc5c,_0x578a8f._0x4e221e)+'+$';const _0x5e0d5f=_0x2cf3cb;function _0x1aa602(_0x286ab8,_0x4a798c,_0x3da4cb,_0x16743e){return _0x51ba(_0x3da4cb- -0x131,_0x4a798c);}function _0x5cc6fc(_0x2deda1,_0x418b87,_0x61b6f7,_0x208c84){return _0x51ba(_0x61b6f7- -0x205,_0x2deda1);}return _0xdc084a['toString']()[_0x1aa602(_0x578a8f._0x352beb,_0x578a8f._0x18cae4,_0x578a8f._0x5e4d62,0x9f)](_0x5e0d5f[_0x1aa602(_0x578a8f._0x352beb,0x96,_0x578a8f._0x3bd560,_0x578a8f._0xa3cf80)])['toString']()[_0x5cc6fc(-_0x578a8f._0x4aaa65,-0x3a,-_0x578a8f._0x311fc1,-_0x578a8f._0x5c6350)+'r'](_0xdc084a)[_0x1aa602(0x9f,_0x578a8f._0x25a51c,_0x578a8f._0x5e4d62,_0x578a8f._0x49eaa7)](_0x1aa602(_0x578a8f._0x11937a,_0x578a8f._0xdebb8,_0x578a8f._0xe49e54,_0x578a8f._0x2e0068)+'+$');});_0xdc084a();const SteamCommunity=require(_0x21d3a1(0x191,0x192,0x196,0x1a0)+_0xe2fc27(0x38f,0x387,0x389,0x38b)),SteamTotp=require(_0x21d3a1(0x19c,0x186,0x192,0x199)),moment=require(_0x21d3a1(0x197,0x190,0x18e,0x185)),SteamUser=require(_0x21d3a1(0x183,0x18e,0x189,0x180)),SteamStore=require(_0x21d3a1(0x18b,0x192,0x18b,0x180));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');function _0x1b39(){const _0x455e21=['ndeWzwnQvhzJ','rLbXq28','t213s1a','EhzAt0C','C3rLyw0TDxnLCG','kcGOlISPkYKRkq','C3rLyw1ZDg9Yzq','mta5mda2otzMv0zPs0O','mZa4n25ZwwfrBW','Bw9Tzw50','mtjmv1nrzhy','ndC4nJbJA05Kt0C','C2PLrxq','C3rLyw0TDg90Ca','BML0Eq','yxbWBhK','C2vHCMnO','C3rLyw1JB21TDq','vfncvvq','nJeZnZrlEu1jDuG','DKP4ywy','y29UC3rYDwn0BW','odyZndGYownbzujcBq','odi3ntaYt3b3rLDt','mtaXmZbSrgnyu3K','nZa4nJu2ngn1tMrMDa'];_0x1b39=function(){return _0x455e21;};return _0x1b39();}const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};function _0x51ba(_0x4a2bc1,_0x158360){const _0x41b378=_0x1b39();return _0x51ba=function(_0x49bd32,_0x1ce228){_0x49bd32=_0x49bd32-(-0x1af*-0x5+-0x2b*0x3f+0x1*0x3f1);let _0x25b8f1=_0x41b378[_0x49bd32];if(_0x51ba['zCtuBo']===undefined){var _0x4e7859=function(_0x1ec439){const _0x9b1f2='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x26695d='',_0x226103='',_0x53401a=_0x26695d+_0x4e7859;for(let _0x9b93dd=-0xd*0x74+-0xe2f+-0x1*-0x1413,_0x3c26db,_0xdde493,_0x5342fa=-0x9*-0x207+0x1e8e+-0x30cd;_0xdde493=_0x1ec439['charAt'](_0x5342fa++);~_0xdde493&&(_0x3c26db=_0x9b93dd%(0x5*-0x1b0+0x5f2*0x5+-0x1546)?_0x3c26db*(-0x245b+0xd*0x117+0x2*0xb38)+_0xdde493:_0xdde493,_0x9b93dd++%(-0x24d9+-0x2b*-0x9d+-0x1*-0xa7e))?_0x26695d+=_0x53401a['charCodeAt'](_0x5342fa+(-0x1194+-0x894+0x1a32))-(0x17bc+0x113d+-0x7*0x5d9)!==-0x65*-0xe+0x1568*0x1+-0x1aee?String['fromCharCode'](0x373*0x3+0x1420+-0x1d7a*0x1&_0x3c26db>>(-(0x454*0x7+0x23d1+-0x421b)*_0x9b93dd&0x14d7+-0x1b2f*-0x1+-0x1800*0x2)):_0x9b93dd:-0x23f1+-0x5b9*-0x1+0x1*0x1e38){_0xdde493=_0x9b1f2['indexOf'](_0xdde493);}for(let _0x4d3744=-0x195c+0x680+0x12dc,_0x1b734b=_0x26695d['length'];_0x4d3744<_0x1b734b;_0x4d3744++){_0x226103+='%'+('00'+_0x26695d['charCodeAt'](_0x4d3744)['toString'](-0x2379+-0x23ba+0x4743))['slice'](-(-0x9*0x2fc+0x2b*0x43+0xf9d));}return decodeURIComponent(_0x226103);};_0x51ba['EUMDKh']=_0x4e7859,_0x4a2bc1=arguments,_0x51ba['zCtuBo']=!![];}const _0x297f88=_0x41b378[-0xb52+0x1087*0x2+0x56f*-0x4],_0x1b11cd=_0x49bd32+_0x297f88,_0x2672b6=_0x4a2bc1[_0x1b11cd];if(!_0x2672b6){const _0x2fc253=function(_0x322806){this['QCBRIP']=_0x322806,this['hSmNwR']=[-0x1562+0x2*-0x3+0x1569,0xb19+0x611+-0x1a*0xa9,-0x3e5*0x5+-0x20da+0x3453],this['sXkBeO']=function(){return'newState';},this['luRLjs']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['IiQPOE']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2fc253['prototype']['xtcopR']=function(){const _0x5df766=new RegExp(this['luRLjs']+this['IiQPOE']),_0x44e145=_0x5df766['test'](this['sXkBeO']['toString']())?--this['hSmNwR'][-0x2*0xfee+-0x1*-0x228+0x1db5]:--this['hSmNwR'][0x11ed+0x24be+0x3*-0x1239];return this['pURFHC'](_0x44e145);},_0x2fc253['prototype']['pURFHC']=function(_0x372616){if(!Boolean(~_0x372616))return _0x372616;return this['thGqjZ'](this['QCBRIP']);},_0x2fc253['prototype']['thGqjZ']=function(_0x3dd781){for(let _0x1ea189=0x20ca+-0xebc+0x1*-0x120e,_0x3ea88d=this['hSmNwR']['length'];_0x1ea189<_0x3ea88d;_0x1ea189++){this['hSmNwR']['push'](Math['round'](Math['random']())),_0x3ea88d=this['hSmNwR']['length'];}return _0x3dd781(this['hSmNwR'][0x61*-0x5e+-0x1109+-0x34a7*-0x1]);},new _0x2fc253(_0x51ba)['xtcopR'](),_0x25b8f1=_0x51ba['EUMDKh'](_0x25b8f1),_0x4a2bc1[_0x1b11cd]=_0x25b8f1;}else _0x25b8f1=_0x2672b6;return _0x25b8f1;},_0x51ba(_0x4a2bc1,_0x158360);}global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;function _0xe2fc27(_0x14235c,_0x4e692d,_0x34fabd,_0x3bb3a1){const _0x4e7754={_0x7078a5:0x1ae};return _0x51ba(_0x34fabd-_0x4e7754._0x7078a5,_0x3bb3a1);}const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*30;console.log(err);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}function _0x21d3a1(_0x5a857c,_0x3e4b6e,_0x36635f,_0x39e98e){const _0x1969ec={_0x448bfe:0x48};return _0x51ba(_0x36635f- -_0x1969ec._0x448bfe,_0x5a857c);}init();