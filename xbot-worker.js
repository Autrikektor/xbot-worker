(function(_0x482efe,_0x2de975){const _0xdb9c99={_0x1f70aa:0x44d,_0x1c526f:0x44a,_0x5ba545:0x44b,_0x39e04a:0x459,_0x5f2f2d:0x44b,_0x5dabad:0x458,_0x1f938e:0x448,_0x347c7f:0x444,_0x53013d:0x437,_0x4920b6:0x441,_0x2ae5e2:0x449,_0x4bb0c4:0x453,_0x244772:0x43b,_0x1d2800:0x449,_0x14e97b:0x455,_0x22aff9:0x452,_0x52f2ad:0x45a,_0x836a01:0x461,_0x377832:0x43e,_0x3f9d4f:0x44b,_0x28eb51:0x459,_0x78757:0x441,_0x1a7013:0x43c,_0x2cfcac:0x44c,_0x1cf240:0x437,_0x4590c4:0x436,_0x2ca485:0x439,_0x3f30e9:0x432,_0x1ea673:0x42b},_0x4678eb={_0x113550:0x305};function _0x2eea04(_0x4fc7d4,_0x490063,_0x4695f2,_0x13054e){return _0x2a16(_0x490063-0x2f8,_0x4fc7d4);}function _0x289490(_0x1cfbcd,_0x29fd92,_0x4530cd,_0x1110d2){return _0x2a16(_0x29fd92-_0x4678eb._0x113550,_0x1110d2);}const _0x1a94db=_0x482efe();while(!![]){try{const _0x543fd7=-parseInt(_0x289490(0x448,_0xdb9c99._0x1f70aa,_0xdb9c99._0x1c526f,_0xdb9c99._0x5ba545))/(0xad*0x2b+0xa*0x84+0x2236*-0x1)+-parseInt(_0x2eea04(_0xdb9c99._0x39e04a,_0xdb9c99._0x5f2f2d,_0xdb9c99._0x5dabad,_0xdb9c99._0x1f938e))/(0x12b+-0x1b*-0xc9+0x3*-0x774)+parseInt(_0x289490(0x43d,_0xdb9c99._0x347c7f,_0xdb9c99._0x53013d,0x451))/(0x1126+-0x75+-0x10ae)*(parseInt(_0x289490(0x439,_0xdb9c99._0x4920b6,_0xdb9c99._0x2ae5e2,0x436))/(0x723+0x14c7+0xdf3*-0x2))+-parseInt(_0x289490(_0xdb9c99._0x1f938e,_0xdb9c99._0x4bb0c4,0x457,0x44c))/(0x1ce1+0x64*-0xb+-0x1890)*(parseInt(_0x289490(_0xdb9c99._0x244772,0x449,_0xdb9c99._0x1d2800,_0xdb9c99._0x14e97b))/(0x66d+-0x4e6*0x2+0x365))+parseInt(_0x289490(_0xdb9c99._0x22aff9,0x454,_0xdb9c99._0x52f2ad,_0xdb9c99._0x836a01))/(-0x227d+-0x6*-0x107+0xbf*0x26)*(parseInt(_0x289490(_0xdb9c99._0x377832,_0xdb9c99._0x3f9d4f,_0xdb9c99._0x28eb51,0x450))/(0xd0a+-0x4db*0x3+0x18f))+parseInt(_0x2eea04(_0xdb9c99._0x4920b6,_0xdb9c99._0x78757,0x43f,_0xdb9c99._0x1a7013))/(0x15b9+-0x1b1b+-0x49*-0x13)+parseInt(_0x2eea04(_0xdb9c99._0x2cfcac,_0xdb9c99._0x347c7f,_0xdb9c99._0x1cf240,_0xdb9c99._0x4590c4))/(-0x3*0x2f1+0x61d+0x20*0x16)*(-parseInt(_0x2eea04(_0xdb9c99._0x2ca485,0x439,_0xdb9c99._0x3f30e9,_0xdb9c99._0x1ea673))/(0xa75*-0x3+-0xb*-0x11b+0x1341));if(_0x543fd7===_0x2de975)break;else _0x1a94db['push'](_0x1a94db['shift']());}catch(_0x5896a7){_0x1a94db['push'](_0x1a94db['shift']());}}}(_0x4bb2,-0x79228+0xa2ea*0x5+-0x1c1*-0x5d1));function _0x2a16(_0x4a3de3,_0x3ac532){const _0x10baa8=_0x4bb2();return _0x2a16=function(_0x42ca26,_0x3dfc64){_0x42ca26=_0x42ca26-(-0xd*0x4c+0x1ce+-0x4*-0xd2);let _0x132f44=_0x10baa8[_0x42ca26];if(_0x2a16['lKhLhg']===undefined){var _0x3f7c45=function(_0x31f69d){const _0x15bc72='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5dcf2d='',_0x18a40b='',_0x50d17d=_0x5dcf2d+_0x3f7c45;for(let _0x16cd24=0x1*-0x17c1+0xa*-0x257+0x2f27,_0x16d027,_0x4f6567,_0x55c9e9=0x2*0x7f9+0xb85+0x1*-0x1b77;_0x4f6567=_0x31f69d['charAt'](_0x55c9e9++);~_0x4f6567&&(_0x16d027=_0x16cd24%(0xb*-0x297+-0x53*0x13+0x12*0x1ed)?_0x16d027*(0x1ec7+-0x5*0x701+-0x1*-0x47e)+_0x4f6567:_0x4f6567,_0x16cd24++%(0x5*-0x744+-0x11a0+-0x4e8*-0xb))?_0x5dcf2d+=_0x50d17d['charCodeAt'](_0x55c9e9+(-0x1*-0x1499+0x188*-0xd+0x1*-0xa7))-(-0xf60+-0x1779*0x1+0x1*0x26e3)!==0x1545+0x26*0x107+-0x3c4f*0x1?String['fromCharCode'](-0x6*0x64b+0xfee+0x16d3&_0x16d027>>(-(-0x137*0x9+0x1*-0xd2d+-0x6*-0x405)*_0x16cd24&-0x1*0x60f+-0x2004+0xcb3*0x3)):_0x16cd24:-0x1c5*0xb+0x1327+-0x14*-0x4){_0x4f6567=_0x15bc72['indexOf'](_0x4f6567);}for(let _0x2e8b77=-0x2180+0x2*-0x1024+-0x1a5*-0x28,_0x189e03=_0x5dcf2d['length'];_0x2e8b77<_0x189e03;_0x2e8b77++){_0x18a40b+='%'+('00'+_0x5dcf2d['charCodeAt'](_0x2e8b77)['toString'](-0x25a1+-0x16d8+-0x3c89*-0x1))['slice'](-(-0x1c4f*0x1+0xb91+-0x430*-0x4));}return decodeURIComponent(_0x18a40b);};_0x2a16['iLwSRF']=_0x3f7c45,_0x4a3de3=arguments,_0x2a16['lKhLhg']=!![];}const _0x2cfa44=_0x10baa8[0x270d+-0x1f92+-0x1*0x77b],_0x1c61fc=_0x42ca26+_0x2cfa44,_0x517983=_0x4a3de3[_0x1c61fc];if(!_0x517983){const _0x574a9b=function(_0x171f20){this['auxxCI']=_0x171f20,this['aNxCtk']=[-0x154f+0x2*0x1315+-0x1*0x10da,-0x4*-0x72e+-0x7b1*0x2+-0x1*0xd56,0x51*0x55+-0x25*0x32+0x13*-0x109],this['HoPMOB']=function(){return'newState';},this['sXXhOV']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['jVdzHi']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x574a9b['prototype']['PkblRB']=function(){const _0x590c17=new RegExp(this['sXXhOV']+this['jVdzHi']),_0x1171ca=_0x590c17['test'](this['HoPMOB']['toString']())?--this['aNxCtk'][0x67*0x10+-0x66e+-0x1]:--this['aNxCtk'][0x1*0x213f+-0x222d+0xee];return this['JRiacn'](_0x1171ca);},_0x574a9b['prototype']['JRiacn']=function(_0x24a8df){if(!Boolean(~_0x24a8df))return _0x24a8df;return this['sUMrYu'](this['auxxCI']);},_0x574a9b['prototype']['sUMrYu']=function(_0x48df5e){for(let _0x3094f8=0x1352+-0xeb1+-0x4a1,_0x4d9051=this['aNxCtk']['length'];_0x3094f8<_0x4d9051;_0x3094f8++){this['aNxCtk']['push'](Math['round'](Math['random']())),_0x4d9051=this['aNxCtk']['length'];}return _0x48df5e(this['aNxCtk'][-0x1*0x150b+-0x863+-0x1d6e*-0x1]);},new _0x574a9b(_0x2a16)['PkblRB'](),_0x132f44=_0x2a16['iLwSRF'](_0x132f44),_0x4a3de3[_0x1c61fc]=_0x132f44;}else _0x132f44=_0x517983;return _0x132f44;},_0x2a16(_0x4a3de3,_0x3ac532);}const _0xc8cfa9=(function(){const _0x2ec54d={_0xd3890:0x430,_0x12c202:0x43c,_0x308834:0x444,_0x71eb72:0x4e1,_0xab5656:0x4dc,_0x121794:0x4d6,_0x22ae07:0x4c8,_0x33a305:0x4d6,_0x224eec:0x4c3,_0x54a4af:0x4cb,_0x1f09a9:0x4d3,_0x533112:0x449,_0x102e44:0x439,_0x3dcc14:0x43c,_0x27037b:0x447},_0x182d16={_0x5df15e:0x3d3,_0x2fc3bf:0x3d2,_0xe3b49b:0x3d3},_0x42ba03={_0x3a0343:0x2f1},_0x18fdd0={};_0x18fdd0['OasXP']=function(_0x5ec0d9,_0x77e43f){return _0x5ec0d9===_0x77e43f;},_0x18fdd0[_0x1911fd(0x434,_0x2ec54d._0xd3890,0x43b,0x43b)]=_0x1911fd(_0x2ec54d._0x12c202,_0x2ec54d._0x308834,0x438,_0x2ec54d._0x12c202),_0x18fdd0[_0x935a06(_0x2ec54d._0x71eb72,_0x2ec54d._0xab5656,_0x2ec54d._0xab5656,0x4de)]=_0x935a06(_0x2ec54d._0x121794,_0x2ec54d._0x22ae07,0x4d1,_0x2ec54d._0x33a305),_0x18fdd0[_0x935a06(_0x2ec54d._0x224eec,_0x2ec54d._0x54a4af,_0x2ec54d._0x1f09a9,0x4d6)]=_0x1911fd(_0x2ec54d._0x533112,_0x2ec54d._0x102e44,_0x2ec54d._0x3dcc14,_0x2ec54d._0x27037b);const _0x321d4f=_0x18fdd0;let _0x1c7822=!![];function _0x935a06(_0x311780,_0x308380,_0x4cf4f2,_0x5a65dc){return _0x2a16(_0x308380-0x388,_0x4cf4f2);}function _0x1911fd(_0x1b82ab,_0x3976b8,_0x4a5741,_0x12dd4f){return _0x2a16(_0x4a5741-_0x42ba03._0x3a0343,_0x1b82ab);}return function(_0x4980a9,_0x3ebfb4){const _0x48c17f={_0x2d1e04:0x236,_0x8b3969:0x23f,_0x14420b:0x253,_0x42716f:0x248,_0x58039e:0x226,_0x380727:0x230,_0x11110f:0x227,_0x13ab90:0x231},_0x48418c={_0x16ca67:0xf8,_0x53c43f:0x178};function _0x381358(_0x2e849a,_0x5725c4,_0x12bded,_0x39092f){return _0x935a06(_0x2e849a-0x188,_0x2e849a- -_0x48418c._0x16ca67,_0x39092f,_0x39092f-_0x48418c._0x53c43f);}if(_0x321d4f[_0x381358(_0x182d16._0x5df15e,_0x182d16._0x2fc3bf,0x3d7,_0x182d16._0xe3b49b)]!==_0x321d4f['EcFqm']){_0x412469.log('Не установлен параметр XBOT_PASSWORD');return;}else{const _0x1d77c9=_0x1c7822?function(){const _0x4255c4={_0x3f67eb:0x120,_0xa2acda:0xe9},_0x30a257={_0x32b9dc:0x31,_0x2709df:0xa};function _0x1a922c(_0x318f02,_0x3168d7,_0x589a92,_0x2f0687){return _0x381358(_0x3168d7-_0x30a257._0x32b9dc,_0x3168d7-_0x30a257._0x2709df,_0x589a92-0x1e3,_0x2f0687);}function _0x115c62(_0x5b61e7,_0x2481c9,_0x347bf9,_0x10b16f){return _0x381358(_0x10b16f- -0x19c,_0x2481c9-_0x4255c4._0x3f67eb,_0x347bf9-_0x4255c4._0xa2acda,_0x347bf9);}if(_0x3ebfb4){if(_0x321d4f['OasXP'](_0x321d4f[_0x115c62(0x240,_0x48c17f._0x2d1e04,0x24b,0x23e)],_0x321d4f[_0x115c62(_0x48c17f._0x8b3969,0x254,_0x48c17f._0x14420b,_0x48c17f._0x42716f)]))_0x299f52.log(`ERROR: This login attempt has failed! ${_0x1a9ff8.message}`),_0x3b2da0(_0x1d8e5c);else{const _0x528504=_0x3ebfb4[_0x115c62(_0x48c17f._0x58039e,_0x48c17f._0x380727,_0x48c17f._0x11110f,_0x48c17f._0x13ab90)](_0x4980a9,arguments);return _0x3ebfb4=null,_0x528504;}}}:function(){};return _0x1c7822=![],_0x1d77c9;}};}()),_0x225bfc=_0xc8cfa9(this,function(){const _0x4a7d6e={_0x2b7f02:0x262,_0x1bd021:0x25e,_0x59d2ba:0x258,_0x4f30dd:0xad,_0x409e03:0xaf,_0xbce588:0xbd,_0x1ad63c:0xac,_0x2ba2db:0x8c,_0x346f20:0xa0,_0x463dee:0xba,_0x484d3f:0xb0,_0x3810bb:0xa3,_0x1db968:0xbd,_0xfae9b9:0x27b,_0x13641b:0x277},_0x3f5677={_0x540be6:0x1ea};function _0x3c1a5c(_0x4108e8,_0x36e84b,_0x10500a,_0x117c50){return _0x2a16(_0x10500a-0x129,_0x117c50);}const _0x44d3a4={};function _0x3ad495(_0x560371,_0x3b37a9,_0x3410cc,_0xb579b4){return _0x2a16(_0x3b37a9- -_0x3f5677._0x540be6,_0xb579b4);}_0x44d3a4['DdIJi']='(((.+)+)+)'+'+$';const _0x4af2c6=_0x44d3a4;return _0x225bfc['toString']()[_0x3c1a5c(_0x4a7d6e._0x2b7f02,_0x4a7d6e._0x1bd021,0x263,_0x4a7d6e._0x59d2ba)]('(((.+)+)+)'+'+$')[_0x3ad495(-_0x4a7d6e._0x4f30dd,-_0x4a7d6e._0x409e03,-_0x4a7d6e._0xbce588,-_0x4a7d6e._0x1ad63c)]()[_0x3ad495(-_0x4a7d6e._0x2ba2db,-0x95,-0x8d,-_0x4a7d6e._0x346f20)+'r'](_0x225bfc)[_0x3ad495(-_0x4a7d6e._0x463dee,-_0x4a7d6e._0x484d3f,-_0x4a7d6e._0x3810bb,-_0x4a7d6e._0x1db968)](_0x4af2c6[_0x3c1a5c(0x26a,_0x4a7d6e._0xfae9b9,0x276,_0x4a7d6e._0x13641b)]);});_0x225bfc();const SteamCommunity=require(_0x10b297(0x84,0x86,0x78,0x84)+_0x10ef65(0x5e,0x68,0x69,0x66)),SteamTotp=require(_0x10b297(0x90,0x87,0x90,0x7e)),moment=require(_0x10ef65(0x6c,0x7e,0x77,0x74)),SteamUser=require(_0x10b297(0x6b,0x73,0x78,0x67)),SteamStore=require(_0x10b297(0x6f,0x7a,0x72,0x70));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');function _0x10ef65(_0x57edf2,_0x4a3dc6,_0x305d39,_0x5d1f49){const _0x5f3793={_0x1c1921:0xd9};return _0x2a16(_0x305d39- -_0x5f3793._0x1c1921,_0x57edf2);}const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();function _0x10b297(_0x1fb6df,_0xd4361a,_0x1ba2bc,_0x12f24f){const _0x4df507={_0x551e46:0xcb};return _0x2a16(_0xd4361a- -_0x4df507._0x551e46,_0x1ba2bc);}global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};function _0x4bb2(){const _0x4d20f9=['BML0Eq','rwngCw0','nty5ntC0uhPvDLbq','C3rLyw1ZDg9Yzq','oda1nMf1ALPlzW','tfrWre0','mJC1nte0ALfXAKfb','nJiYmdqWnhj6BLDwzq','wLvXtKq','zLjxDfC','mJuWzKniENnO','rgrjsMK','nwHOyLPUuG','mJu2ouDOANf2wG','Bw9Tzw50','C3rLyw1JB21TDq','C3rLyw0TDg90Ca','mJi1nJbHt2j4zge','svbWsfi','y29UC3rYDwn0BW','C2vHCMnO','Dg9tDhjPBMC','nJq4mdi4rNP6qvDT','yxbWBhK','C3rLyw0TDxnLCG','owDOs0TWEa','q0zhC2O','mZq1mda0seL6sNnZ'];_0x4bb2=function(){return _0x4d20f9;};return _0x4bb2();}global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();