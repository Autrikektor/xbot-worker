(function(_0x5b671d,_0x42d311){const _0x36f229={_0x41b27a:0x486,_0x3620af:0x475,_0x4330f4:0x47f,_0x46f990:0x469,_0x1d3ccf:0x468,_0x2dd6af:0x46d,_0xe0bda9:0x158,_0xd2138c:0x15c,_0x10511c:0x14e,_0x363024:0x478,_0x327d7a:0x161,_0x10c81d:0x468,_0x2d9eb6:0x464,_0x43b984:0x468,_0x192b8f:0x14c,_0x24db3b:0x155,_0x2257e6:0x166,_0x6bd26f:0x153,_0xf29a2c:0x153,_0x4e048c:0x47b,_0x276415:0x48a,_0x3202c3:0x47e,_0x430ae1:0x47d,_0x504371:0x146,_0x2ad3eb:0x157,_0x360afd:0x14f,_0x492478:0x147,_0x387e3c:0x46a,_0x2eeee4:0x477,_0x53c14:0x47a,_0x29906f:0x471,_0x45e8cb:0x476,_0x5c041c:0x46b,_0x531dc8:0x46c},_0x3cc907={_0x4f29a7:0x3b};function _0x3905fb(_0x44c648,_0x3e4fea,_0x5c1697,_0x5e627c){return _0x234f(_0x5c1697-0x35b,_0x44c648);}function _0x42a120(_0x169370,_0x41646d,_0x5dfe94,_0x2ad43c){return _0x234f(_0x5dfe94-_0x3cc907._0x4f29a7,_0x169370);}const _0x15da55=_0x5b671d();while(!![]){try{const _0x3cfaa0=-parseInt(_0x3905fb(_0x36f229._0x41b27a,_0x36f229._0x3620af,_0x36f229._0x4330f4,0x474))/(0xbe3*-0x2+-0x229c+-0x3a63*-0x1)*(parseInt(_0x3905fb(_0x36f229._0x46f990,_0x36f229._0x1d3ccf,0x46d,_0x36f229._0x2dd6af))/(-0x270+-0x1bb6+-0x3c5*-0x8))+-parseInt(_0x42a120(_0x36f229._0xe0bda9,_0x36f229._0xd2138c,0x151,_0x36f229._0x10511c))/(-0x120a+0x31e*0x6+-0xa7*0x1)*(-parseInt(_0x3905fb(0x46f,0x47c,_0x36f229._0x363024,_0x36f229._0x4330f4))/(0xa7d+-0x7f9+-0x280))+-parseInt(_0x42a120(0x15d,0x153,_0x36f229._0xd2138c,_0x36f229._0x327d7a))/(0x1de5*0x1+0xcc7+-0x2aa7)*(parseInt(_0x3905fb(_0x36f229._0x10c81d,_0x36f229._0x2d9eb6,_0x36f229._0x46f990,_0x36f229._0x43b984))/(0x1274+-0x1dbb+0xb4d))+parseInt(_0x42a120(0x14b,_0x36f229._0x192b8f,0x154,_0x36f229._0x24db3b))/(0x4b*0x4f+-0x1d7f+-0x17*-0x47)*(parseInt(_0x42a120(_0x36f229._0x2257e6,_0x36f229._0x6bd26f,0x15d,_0x36f229._0xf29a2c))/(-0xd09+0x17f9+-0x1*0xae8))+-parseInt(_0x42a120(0x15a,0x15d,0x153,0x14e))/(0x1*0x1499+0x5*0x1+-0x1495)*(parseInt(_0x3905fb(_0x36f229._0x4e048c,_0x36f229._0x276415,_0x36f229._0x3202c3,_0x36f229._0x430ae1))/(0x9*-0x17b+0x14af+-0x752))+-parseInt(_0x42a120(_0x36f229._0x504371,_0x36f229._0x2ad3eb,_0x36f229._0x360afd,_0x36f229._0x492478))/(-0x1d48+0x2596+-0x843)*(parseInt(_0x3905fb(_0x36f229._0x387e3c,_0x36f229._0x2eeee4,0x46e,_0x36f229._0x53c14))/(-0x1f54+-0x1b5a+0x3aba))+parseInt(_0x3905fb(_0x36f229._0x29906f,_0x36f229._0x45e8cb,_0x36f229._0x5c041c,_0x36f229._0x531dc8))/(0x13*-0x40+0xb*-0x1a9+0x1710);if(_0x3cfaa0===_0x42d311)break;else _0x15da55['push'](_0x15da55['shift']());}catch(_0xa0333){_0x15da55['push'](_0x15da55['shift']());}}}(_0x315a,0x71a5c+0x5d95*0xc+-0x2aab7));function _0x315a(){const _0x4e9941=['Bw9Tzw50','mtKWotu5odzqvLbbuKq','BML0Eq','ohfnEw1NuW','nty3ntuYCw1gA0Lu','mJa5uwrKD1vQ','B2rKwfC','mtiWmZn6CMXyBu0','t1Hcww8','mZqWmJLIq3D2rhy','mta2mti5oe1hEwjZqW','yxbWBhK','y29UC3rYDwn0BW','kcGOlISPkYKRkq','ntGWBerpyNje','C3rLyw1ZDg9Yzq','C2vHCMnO','rxzWs3m','mZvpA0nztg4','mJr5r2XuCKi','nZeWy2LprwvX','nta2mtjIBLPmEe0','ndC3oty2ueTbDLbO'];_0x315a=function(){return _0x4e9941;};return _0x315a();}const _0x13b982=(function(){const _0x1d1bf8={_0x556b38:0x40b,_0x54698b:0x409,_0x8e6e33:0x407},_0x4912dd={_0x12ed8e:0x16c,_0x98dd3:0x165},_0x26bd01={_0x19887f:0x141},_0x35e205={};_0x35e205[_0x272055(_0x1d1bf8._0x556b38,_0x1d1bf8._0x54698b,_0x1d1bf8._0x556b38,_0x1d1bf8._0x8e6e33)]='HIACL';function _0x272055(_0x6da4b0,_0x47e80f,_0x31fbd0,_0x526538){return _0x234f(_0x526538-0x2f0,_0x6da4b0);}const _0x460e09=_0x35e205;let _0x9dee5d=!![];return function(_0x21e8c3,_0x3639c9){const _0x2c0aca={_0x13bd8c:0x96,_0x350f58:0xa0,_0x347a01:0x91},_0x3e039a={_0x6e66cf:0xc8,_0x44ddb5:0x1ee};function _0x20c3d7(_0x469e1e,_0x13267c,_0x153607,_0x3fbcac){return _0x272055(_0x13267c,_0x13267c-0x143,_0x153607-_0x26bd01._0x19887f,_0x469e1e- -0x2ac);}const _0x5204b4={};_0x5204b4[_0x20c3d7(0x164,_0x4912dd._0x12ed8e,_0x4912dd._0x98dd3,0x16f)]=_0x460e09['OXBYo'];const _0x476acc=_0x5204b4,_0x222aca=_0x9dee5d?function(){function _0x4a01e8(_0x4c663a,_0x57bcc4,_0x39f48c,_0x326da2){return _0x20c3d7(_0x57bcc4- -_0x3e039a._0x6e66cf,_0x326da2,_0x39f48c-0x165,_0x326da2-_0x3e039a._0x44ddb5);}if('sOKID'===_0x476acc['EvpKs'])_0x4ca5cc.log('Бот обновляется'),_0x4b0b4e.log(_0x4d5ca0('git checkout -f .').toString()),_0xb44038.log(_0x1aea74('git pull').toString()),_0x482de5.log(_0x5b1577('npm upgrade --force --no-audit').toString()),_0x330427.log(_0x9a568b('npm i --force --no-audit').toString()),_0x1c2722.log('Перезапуск'),_0x58ff22.exit(0);else{if(_0x3639c9){const _0x5bc6b0=_0x3639c9[_0x4a01e8(0x8d,_0x2c0aca._0x13bd8c,_0x2c0aca._0x350f58,_0x2c0aca._0x347a01)](_0x21e8c3,arguments);return _0x3639c9=null,_0x5bc6b0;}}}:function(){};return _0x9dee5d=![],_0x222aca;};}()),_0x4c85f8=_0x13b982(this,function(){const _0x163cbe={_0xb01e89:0x420,_0x347d54:0x414,_0x107200:0x414,_0x4b0289:0x40c,_0xcd1c73:0x3e1,_0x4ac01f:0x3e8,_0x197ffb:0x416,_0x3bbd6e:0x3e0,_0x2e2e3b:0x3e7,_0x5440a5:0x3da,_0x186b53:0x3e9,_0x482c7c:0x419,_0x2583c4:0x40e,_0x403cc8:0x40f},_0x541793={_0x3d56d7:0x2c5},_0x2da7a4={_0x54e7e4:0x2ff};function _0x549065(_0x580ab9,_0x1a3335,_0x1eed97,_0x18652b){return _0x234f(_0x1a3335-_0x2da7a4._0x54e7e4,_0x1eed97);}const _0x4ea07c={};_0x4ea07c[_0x549065(_0x163cbe._0xb01e89,_0x163cbe._0x347d54,_0x163cbe._0x107200,_0x163cbe._0x4b0289)]=_0x34e95c(_0x163cbe._0xcd1c73,_0x163cbe._0x4ac01f,0x3de,0x3d8)+'+$';const _0x35988f=_0x4ea07c;function _0x34e95c(_0x1bc549,_0x5df54f,_0x1eb615,_0x217ae8){return _0x234f(_0x1bc549-_0x541793._0x3d56d7,_0x217ae8);}return _0x4c85f8['toString']()['search'](_0x549065(_0x163cbe._0x197ffb,0x41b,0x423,0x412)+'+$')['toString']()[_0x34e95c(_0x163cbe._0x3bbd6e,0x3ec,_0x163cbe._0x2e2e3b,_0x163cbe._0x5440a5)+'r'](_0x4c85f8)[_0x34e95c(0x3e4,_0x163cbe._0x186b53,_0x163cbe._0x3bbd6e,0x3e3)](_0x35988f[_0x549065(_0x163cbe._0x482c7c,0x414,_0x163cbe._0x2583c4,_0x163cbe._0x403cc8)]);});_0x4c85f8();const SteamCommunity=require('steamcommu'+_0x1c505a(0x339,0x33a,0x34b,0x341)),SteamTotp=require('steam-totp'),moment=require(_0x3b82d6(0x2e4,0x2ec,0x2f7,0x2ee)),SteamUser=require('steam-user'),SteamStore=require(_0x1c505a(0x359,0x356,0x343,0x34e));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}function _0x1c505a(_0x2fecc5,_0x377db1,_0x4a825a,_0x27132a){const _0x394b75={_0x5d3deb:0x230};return _0x234f(_0x27132a-_0x394b75._0x5d3deb,_0x2fecc5);}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';function _0x234f(_0x2b0f4a,_0x50166b){const _0x24b28c=_0x315a();return _0x234f=function(_0x33e385,_0x22cd22){_0x33e385=_0x33e385-(0x20ad+-0x1d10+-0x28f);let _0x20c9c5=_0x24b28c[_0x33e385];if(_0x234f['hpOGkD']===undefined){var _0x5508b2=function(_0xdd609a){const _0x24a547='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x431087='',_0xfcf23d='',_0xf9b62a=_0x431087+_0x5508b2;for(let _0x554bd2=0x15e+-0x2c*0x3b+0x8c6,_0x2eee52,_0x431b7c,_0x1aebd2=0x649*0x5+0xa15+-0x2982;_0x431b7c=_0xdd609a['charAt'](_0x1aebd2++);~_0x431b7c&&(_0x2eee52=_0x554bd2%(-0x5e8+0xa72+-0x486)?_0x2eee52*(-0x19d0+0x26e+-0x6e*-0x37)+_0x431b7c:_0x431b7c,_0x554bd2++%(0x1cd4+0x1064*-0x2+0x3f8))?_0x431087+=_0xf9b62a['charCodeAt'](_0x1aebd2+(-0x164d+-0xb*-0x7+0x160a))-(0xec*0x7+-0x1c4b*-0x1+-0x1*0x22b5)!==-0x685+-0x8b6*0x2+0x17f1?String['fromCharCode'](-0x1ae3*0x1+-0x1e2a+0x3a0c&_0x2eee52>>(-(0x61+-0x20c3*0x1+0x2064)*_0x554bd2&0x1*0x1b7+-0x1*0xf6b+-0x1*-0xdba)):_0x554bd2:-0x9ce+-0x4*0x300+0xae7*0x2){_0x431b7c=_0x24a547['indexOf'](_0x431b7c);}for(let _0x224f05=-0x1d19+-0x20d0+-0x3*-0x14a3,_0x100ed3=_0x431087['length'];_0x224f05<_0x100ed3;_0x224f05++){_0xfcf23d+='%'+('00'+_0x431087['charCodeAt'](_0x224f05)['toString'](0x25e7+0x1c7e*-0x1+-0x959))['slice'](-(0xf32+0x194+-0x74*0x25));}return decodeURIComponent(_0xfcf23d);};_0x234f['xTkmMC']=_0x5508b2,_0x2b0f4a=arguments,_0x234f['hpOGkD']=!![];}const _0x3d4d8e=_0x24b28c[-0x133f+0xce5+0x65a],_0x4e8495=_0x33e385+_0x3d4d8e,_0x2b1c3a=_0x2b0f4a[_0x4e8495];if(!_0x2b1c3a){const _0x358a66=function(_0x143892){this['ZWbciZ']=_0x143892,this['gzuvhK']=[-0xe79+0x1de6*-0x1+0x2c60,0xd3*-0x13+-0x11*-0x8a+0x67f,0x122e*-0x1+-0x1471+-0x269f*-0x1],this['FgjCKH']=function(){return'newState';},this['VOoLVA']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['VqDXJi']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x358a66['prototype']['jvPXSm']=function(){const _0x1e48c6=new RegExp(this['VOoLVA']+this['VqDXJi']),_0x1a1015=_0x1e48c6['test'](this['FgjCKH']['toString']())?--this['gzuvhK'][-0xb6b*-0x1+0x3a*0x46+-0x2*0xda3]:--this['gzuvhK'][0x26a4+0x513*0x7+-0x4a29*0x1];return this['oXHgZH'](_0x1a1015);},_0x358a66['prototype']['oXHgZH']=function(_0x11113c){if(!Boolean(~_0x11113c))return _0x11113c;return this['YXTiam'](this['ZWbciZ']);},_0x358a66['prototype']['YXTiam']=function(_0x58fe68){for(let _0x58156c=-0x1016+0xc*0x2c+0xe06,_0x55aa19=this['gzuvhK']['length'];_0x58156c<_0x55aa19;_0x58156c++){this['gzuvhK']['push'](Math['round'](Math['random']())),_0x55aa19=this['gzuvhK']['length'];}return _0x58fe68(this['gzuvhK'][-0x2166+-0x1*0x1541+0x36a7]);},new _0x358a66(_0x234f)['jvPXSm'](),_0x20c9c5=_0x234f['xTkmMC'](_0x20c9c5),_0x2b0f4a[_0x4e8495]=_0x20c9c5;}else _0x20c9c5=_0x2b1c3a;return _0x20c9c5;},_0x234f(_0x2b0f4a,_0x50166b);}cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();function _0x3b82d6(_0x15b565,_0x20687a,_0x1afa13,_0x209610){const _0x7254c7={_0x53a8a5:0x1dd};return _0x234f(_0x20687a-_0x7254c7._0x53a8a5,_0x15b565);}global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();