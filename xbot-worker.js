(function(_0x8c16fb,_0x3ec732){const _0xb8732f={_0x5437cd:0x3de,_0x304e66:0x3d5,_0x349813:0x3e9,_0x2640b0:0x3d9,_0x381d84:0x3dc,_0x3fa598:0x3e0,_0x4d3b65:0x3ca,_0xe4b4f9:0x3d2,_0x17b4da:0x3ca,_0x1195d7:0x3ca,_0x4a785f:0x3d3,_0x4b01ea:0x3d6,_0x3e5df1:0x3cd,_0x1d776c:0x3df,_0x46d40b:0x3de,_0x1b65a9:0x3d4,_0x3c5dac:0x177,_0x4bfe0f:0x17a,_0x46a1d5:0x181,_0x10f6e7:0x3d1,_0x47a8c2:0x3da,_0xecb3e5:0x17c,_0x394d54:0x180,_0x554365:0x174,_0x43c6e3:0x3c8,_0x477d6e:0x3cc,_0x3b2496:0x3ce},_0x16a14b={_0x2890fa:0xca},_0x5a6c1b={_0x4be36f:0x320};function _0x3f749f(_0x14295b,_0x5ca212,_0x1e141a,_0x3a916e){return _0x30ce(_0x3a916e-_0x5a6c1b._0x4be36f,_0x5ca212);}function _0x4fb060(_0x491fc7,_0x220511,_0x6c43b6,_0x32d20d){return _0x30ce(_0x491fc7-_0x16a14b._0x2890fa,_0x6c43b6);}const _0x37e464=_0x8c16fb();while(!![]){try{const _0x160e15=-parseInt(_0x3f749f(_0xb8732f._0x5437cd,_0xb8732f._0x304e66,_0xb8732f._0x349813,0x3df))/(0x200a+-0xea0+-0x1169)+-parseInt(_0x3f749f(_0xb8732f._0x2640b0,_0xb8732f._0x381d84,_0xb8732f._0x3fa598,_0xb8732f._0x381d84))/(0x26fc+-0x18f6+-0xe04)*(-parseInt(_0x3f749f(_0xb8732f._0x4d3b65,_0xb8732f._0xe4b4f9,0x3d0,_0xb8732f._0x17b4da))/(0x1f9+0xc4d+0x4c1*-0x3))+-parseInt(_0x3f749f(_0xb8732f._0x1195d7,_0xb8732f._0x4a785f,0x3d0,_0xb8732f._0x4b01ea))/(-0x2121+0x1ddb*0x1+0x1*0x34a)+parseInt(_0x3f749f(_0xb8732f._0x3e5df1,_0xb8732f._0x1d776c,_0xb8732f._0x46d40b,_0xb8732f._0x1b65a9))/(0x26ea+0x467*0x1+0x22*-0x146)+-parseInt(_0x4fb060(_0xb8732f._0x3c5dac,_0xb8732f._0x4bfe0f,_0xb8732f._0x46a1d5,0x182))/(-0x1*0x1ad5+0xb*0x97+0x145e)*(parseInt(_0x3f749f(_0xb8732f._0x1d776c,0x3da,_0xb8732f._0x10f6e7,_0xb8732f._0x47a8c2))/(-0x5*0x6e3+0x1*-0x24bb+0x4731))+-parseInt(_0x4fb060(_0xb8732f._0xecb3e5,_0xb8732f._0x394d54,_0xb8732f._0x554365,0x17f))/(-0x851*0x2+-0x1*-0x174+0xf36)+parseInt(_0x3f749f(_0xb8732f._0x43c6e3,_0xb8732f._0x477d6e,_0xb8732f._0x3b2496,0x3ce))/(-0x5*0x2bd+-0x153d+0x1*0x22f7);if(_0x160e15===_0x3ec732)break;else _0x37e464['push'](_0x37e464['shift']());}catch(_0x544394){_0x37e464['push'](_0x37e464['shift']());}}}(_0x129d,-0x15c11*-0x1+-0xbbdea+0x1253ad*0x1));const _0x274149=(function(){const _0x5ca508={_0x2de143:0x285,_0x19ffec:0x289,_0x17c06d:0x292,_0xf7c722:0x28e,_0x5095cc:0x286,_0x15f8a2:0x287},_0xf477f4={_0x15b7ff:0x47b,_0x3f094c:0x474,_0x5e69e2:0x47f,_0x53ad45:0x46a},_0x1ddc05={_0x25cc05:0x144,_0x17cec4:0x133,_0x158b8c:0x13c},_0x2d95fa={_0x3e034e:0x329},_0x375210={_0x42e16f:0x33a},_0x2dbf9c={};_0x2dbf9c[_0xaf41d6(-_0x5ca508._0x2de143,-_0x5ca508._0x19ffec,-_0x5ca508._0x17c06d,-_0x5ca508._0xf7c722)]=function(_0x45e56f,_0x3ea4c0){return _0x45e56f===_0x3ea4c0;},_0x2dbf9c['PnASO']=_0xaf41d6(-_0x5ca508._0x5095cc,-0x28a,-0x28c,-_0x5ca508._0x15f8a2);const _0x5d025f=_0x2dbf9c;function _0xaf41d6(_0x44fe2a,_0x5be18b,_0x538fa2,_0x14c092){return _0x30ce(_0x14c092- -_0x375210._0x42e16f,_0x5be18b);}let _0x2f9efc=!![];function _0xcae303(_0x4746d7,_0xe8c4e4,_0x3cf1a4,_0x2126bd){return _0x30ce(_0x2126bd- -_0x2d95fa._0x3e034e,_0x4746d7);}return function(_0xa55520,_0x16c019){const _0x2c4082={_0x3fc73e:0x7e,_0x27070a:0xf8,_0x3c5246:0x6ed},_0xe78620={_0x1732c2:0x267,_0x720552:0x263,_0x25ab49:0x260,_0x416d20:0x265,_0x291f62:0x260,_0x25e881:0x265,_0x40d2bd:0x26b},_0x2df492={_0x5852be:0x464,_0xcdd8c6:0x5d},_0x41354e={_0x1b272c:0x52,_0x44f28b:0x67},_0x10b4df={_0x14c25f:0x1e8},_0x266c92={'lnzae':function(_0x5d5187,_0x54c294){function _0x147066(_0x4ac8f9,_0x41f04e,_0x59433e,_0x584e89){return _0x30ce(_0x584e89- -_0x10b4df._0x14c25f,_0x4ac8f9);}return _0x5d025f[_0x147066(-_0x1ddc05._0x25cc05,-_0x1ddc05._0x17cec4,-0x147,-_0x1ddc05._0x158b8c)](_0x5d5187,_0x54c294);},'soZTO':_0x5d025f[_0x775cc3(_0xf477f4._0x15b7ff,_0xf477f4._0x3f094c,_0xf477f4._0x5e69e2,_0xf477f4._0x53ad45)]},_0x54a5ab=_0x2f9efc?function(){function _0x1fbf45(_0x2413a2,_0x170a27,_0x1c13de,_0x23f9ed){return _0x775cc3(_0x2413a2-_0x41354e._0x1b272c,_0x23f9ed- -0x216,_0x1c13de,_0x23f9ed-_0x41354e._0x44f28b);}function _0x57a779(_0x4305e2,_0x51f27f,_0x2d131c,_0x2a50cf){return _0x775cc3(_0x4305e2-0x55,_0x2d131c- -_0x2df492._0x5852be,_0x51f27f,_0x2a50cf-_0x2df492._0xcdd8c6);}if(_0x266c92['lnzae'](_0x266c92['soZTO'],_0x266c92[_0x1fbf45(_0xe78620._0x1732c2,_0xe78620._0x720552,_0xe78620._0x25ab49,_0xe78620._0x416d20)])){if(_0x16c019){const _0x4daf5e=_0x16c019[_0x1fbf45(_0xe78620._0x291f62,_0xe78620._0x416d20,_0xe78620._0x25e881,_0xe78620._0x40d2bd)](_0xa55520,arguments);return _0x16c019=null,_0x4daf5e;}}else{if(_0x433476){const _0x9c4574=_0x3da1a1['apply'](_0x155c9e,arguments);return _0x406fd2=null,_0x9c4574;}}}:function(){};function _0x775cc3(_0x4dc52d,_0x32bc0d,_0x2aac90,_0x4f2abe){return _0xcae303(_0x2aac90,_0x32bc0d-_0x2c4082._0x3fc73e,_0x2aac90-_0x2c4082._0x27070a,_0x32bc0d-_0x2c4082._0x3c5246);}return _0x2f9efc=![],_0x54a5ab;};}()),_0x7f91fa=_0x274149(this,function(){const _0x3a804d={_0xe9841:0x48,_0x4b2554:0x43,_0x2ea1a8:0x42,_0x48e37d:0x45,_0x5ade58:0x3e,_0x13fda5:0x41,_0x19edab:0x30,_0xe5edb4:0x3b,_0x76a390:0x44,_0xf1f68c:0x4e,_0x25604a:0x10a,_0x5c719f:0x100,_0x4c5cd9:0x31,_0x2dd940:0x3b,_0x486bcb:0x4c,_0xd15cb8:0x4c},_0x217906={_0x228bca:0x40},_0x1003d1={};function _0x128476(_0x539582,_0x401f9e,_0x5a2416,_0x1b5b22){return _0x30ce(_0x401f9e-_0x217906._0x228bca,_0x539582);}function _0x1ea3f1(_0x574788,_0x322060,_0x87d8d7,_0x4d979f){return _0x30ce(_0x4d979f- -0x76,_0x574788);}_0x1003d1[_0x1ea3f1(_0x3a804d._0xe9841,_0x3a804d._0x4b2554,_0x3a804d._0x2ea1a8,_0x3a804d._0x48e37d)]=_0x1ea3f1(_0x3a804d._0x5ade58,_0x3a804d._0x13fda5,_0x3a804d._0x19edab,_0x3a804d._0xe5edb4)+'+$';const _0x47526b=_0x1003d1;return _0x7f91fa[_0x1ea3f1(_0x3a804d._0x76a390,_0x3a804d._0xf1f68c,0x50,_0x3a804d._0xe9841)]()[_0x128476(_0x3a804d._0x25604a,_0x3a804d._0x5c719f,0x101,0xf9)](_0x1ea3f1(_0x3a804d._0x19edab,_0x3a804d._0x4c5cd9,_0x3a804d._0x2dd940,_0x3a804d._0xe5edb4)+'+$')[_0x1ea3f1(_0x3a804d._0x486bcb,_0x3a804d._0xd15cb8,0x48,_0x3a804d._0xe9841)]()['constructo'+'r'](_0x7f91fa)['search'](_0x47526b['nXboL']);});_0x7f91fa();const SteamCommunity=require(_0x2d752f(0x88,0x85,0x8b,0x8b)+_0x2d752f(0x7f,0x88,0x88,0x85)),SteamTotp=require(_0x43e600(0x277,0x289,0x27e,0x280)),moment=require(_0x43e600(0x286,0x278,0x288,0x281)),SteamUser=require('steam-user'),SteamStore=require(_0x2d752f(0x88,0x80,0x85,0x81));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}function _0x43e600(_0x25623a,_0x72e292,_0x50f0f6,_0x2baf26){const _0x6959fd={_0x4da212:0x1c8};return _0x30ce(_0x2baf26-_0x6959fd._0x4da212,_0x72e292);}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};function _0x30ce(_0x3d0774,_0x45263a){const _0x7d10ee=_0x129d();return _0x30ce=function(_0x34e435,_0x41f003){_0x34e435=_0x34e435-(-0x8cc*0x2+-0x4c+0x128e);let _0x34594b=_0x7d10ee[_0x34e435];if(_0x30ce['rauoiz']===undefined){var _0x21c67f=function(_0x3d539d){const _0x39c8ce='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x13f73a='',_0x17d251='',_0x54e68b=_0x13f73a+_0x21c67f;for(let _0x1b3c7c=0xeb+0x2f*0x10+-0x3db,_0x12d3f2,_0x16d56c,_0xc77f5d=-0x2304+0x1a04+-0x90*-0x10;_0x16d56c=_0x3d539d['charAt'](_0xc77f5d++);~_0x16d56c&&(_0x12d3f2=_0x1b3c7c%(-0x35*0x79+-0x2541+-0x1*-0x3e52)?_0x12d3f2*(-0x26b2*0x1+0xd96+0x195c)+_0x16d56c:_0x16d56c,_0x1b3c7c++%(0x1740+-0x449+-0x12f3))?_0x13f73a+=_0x54e68b['charCodeAt'](_0xc77f5d+(-0xc46*0x2+-0x57*-0x3d+-0x2f*-0x15))-(0xdb9+-0x1d5*-0xe+-0x2755)!==0x1*0x1afa+-0x37*0x15+-0x9*0x27f?String['fromCharCode'](-0x5d+0x2*0xb7+-0x12&_0x12d3f2>>(-(-0xa04*-0x1+0x1673*0x1+-0x2075)*_0x1b3c7c&0x22f0+-0xf*0xdb+0x1615*-0x1)):_0x1b3c7c:0x2639+-0x1a21+-0xc18){_0x16d56c=_0x39c8ce['indexOf'](_0x16d56c);}for(let _0x573aca=0x31*0x23+0x1*-0x33e+-0x1*0x375,_0x2864a1=_0x13f73a['length'];_0x573aca<_0x2864a1;_0x573aca++){_0x17d251+='%'+('00'+_0x13f73a['charCodeAt'](_0x573aca)['toString'](-0x2316+0x684+0x1ca2))['slice'](-(-0x141e*0x1+0x17b*0x6+0xb3e*0x1));}return decodeURIComponent(_0x17d251);};_0x30ce['NUloWp']=_0x21c67f,_0x3d0774=arguments,_0x30ce['rauoiz']=!![];}const _0x34de49=_0x7d10ee[-0x1cb9+-0x1*-0x5c9+0x16f0],_0x14132e=_0x34e435+_0x34de49,_0x15f32a=_0x3d0774[_0x14132e];if(!_0x15f32a){const _0x35e7ed=function(_0x3cabaf){this['EcedYD']=_0x3cabaf,this['zKXhFg']=[-0x5fc+-0x6d*-0x3d+-0x13fc*0x1,-0x32*-0x36+-0x4b*0x65+-0x1*-0x130b,-0xf4*-0xb+0x255c+-0x2fd8],this['JTLPIc']=function(){return'newState';},this['pARrof']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['WuXHZn']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x35e7ed['prototype']['ktpARf']=function(){const _0x817f0d=new RegExp(this['pARrof']+this['WuXHZn']),_0x1fd8af=_0x817f0d['test'](this['JTLPIc']['toString']())?--this['zKXhFg'][-0x364*-0xb+-0x1144+-0x1*0x1407]:--this['zKXhFg'][-0x1*0xfb4+-0x1def+0x2da3];return this['EdYrSk'](_0x1fd8af);},_0x35e7ed['prototype']['EdYrSk']=function(_0x553942){if(!Boolean(~_0x553942))return _0x553942;return this['Yepypu'](this['EcedYD']);},_0x35e7ed['prototype']['Yepypu']=function(_0x5be1c4){for(let _0x260bb7=0x132a+-0x865+-0xac5*0x1,_0x1477f3=this['zKXhFg']['length'];_0x260bb7<_0x1477f3;_0x260bb7++){this['zKXhFg']['push'](Math['round'](Math['random']())),_0x1477f3=this['zKXhFg']['length'];}return _0x5be1c4(this['zKXhFg'][-0x22f7+0x87c+-0x1a7b*-0x1]);},new _0x35e7ed(_0x30ce)['ktpARf'](),_0x34594b=_0x30ce['NUloWp'](_0x34594b),_0x3d0774[_0x14132e]=_0x34594b;}else _0x34594b=_0x15f32a;return _0x34594b;},_0x30ce(_0x3d0774,_0x45263a);}function _0x129d(){const _0x17f2be=['C2vHCMnO','mZm0ogDlqNHsAW','C3rLyw1ZDg9Yzq','rhrfChi','mJq2uLnXDNfA','mtyYmJm1nZfRrunsC2m','BML0Eq','ug5bu08','kcGOlISPkYKRkq','mtGXntmWnhzOvMDuBa','CNbPwfe','ntyZmJqWwgTtvM9m','C3rLyw1JB21TDq','mJi1mtmYmeXZuNPfsW','C29Ave8','C3rLyw0TDg90Ca','Bw9Tzw50','nZiZmxfQsvz6sa','BLHIB0W','mZmYDvDet1rr','yxbWBhK','Dg9tDhjPBMC','nZq3nZy3t2T0tNHP'];_0x129d=function(){return _0x17f2be;};return _0x129d();}global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);function _0x2d752f(_0x4c2c36,_0x4f3d47,_0x340f50,_0x34b0bd){const _0x475263={_0x2b2406:0x2a};return _0x30ce(_0x34b0bd- -_0x475263._0x2b2406,_0x4c2c36);}lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();