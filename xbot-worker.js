function _0x1c41(_0x2a2451,_0x402af5){const _0x4ad06e=_0x2014();return _0x1c41=function(_0x3809a3,_0x352954){_0x3809a3=_0x3809a3-(0x532*-0x3+-0x3*-0x8+0x1038);let _0x558ea7=_0x4ad06e[_0x3809a3];if(_0x1c41['oPAWeJ']===undefined){var _0x566d24=function(_0x386ada){const _0x1fa03c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x21dcc7='',_0x9fee81='',_0x27bac2=_0x21dcc7+_0x566d24;for(let _0x3fbcb1=-0x1dc7+-0x1d*0x35+0x23c8,_0x1cb194,_0x4791f5,_0x289697=-0x1*-0x6eb+0x16a4+-0x1d8f;_0x4791f5=_0x386ada['charAt'](_0x289697++);~_0x4791f5&&(_0x1cb194=_0x3fbcb1%(-0x13bf+0x1bc8+-0x805)?_0x1cb194*(-0x1945+0x6*0x239+0xc2f)+_0x4791f5:_0x4791f5,_0x3fbcb1++%(-0x2704+0x563*-0x2+0x31ce))?_0x21dcc7+=_0x27bac2['charCodeAt'](_0x289697+(-0x92c+-0x158b+0x1ec1))-(-0x1992*0x1+0x1*-0x1f2a+-0x38c6*-0x1)!==0xf11+0x3*-0xc52+-0x3b*-0x5f?String['fromCharCode'](-0x2382+-0x1*0xc93+0x188a*0x2&_0x1cb194>>(-(0x234b+-0x216d+-0x1dc)*_0x3fbcb1&0x1808+0x65*-0x12+0x21d*-0x8)):_0x3fbcb1:0xfc8*-0x1+0x4c*0x7f+0x57b*-0x4){_0x4791f5=_0x1fa03c['indexOf'](_0x4791f5);}for(let _0x4a3e40=0x1276*-0x1+-0x1ed4+-0x18a5*-0x2,_0x4b7714=_0x21dcc7['length'];_0x4a3e40<_0x4b7714;_0x4a3e40++){_0x9fee81+='%'+('00'+_0x21dcc7['charCodeAt'](_0x4a3e40)['toString'](-0x2374*0x1+-0x54b*-0x2+-0x1*-0x18ee))['slice'](-(-0x13de*-0x1+0x283*0x1+0x53*-0x45));}return decodeURIComponent(_0x9fee81);};_0x1c41['BGnhfg']=_0x566d24,_0x2a2451=arguments,_0x1c41['oPAWeJ']=!![];}const _0x220a57=_0x4ad06e[-0x2*-0xe2f+-0x21fc+0x59e],_0x4a7b8d=_0x3809a3+_0x220a57,_0x27736b=_0x2a2451[_0x4a7b8d];if(!_0x27736b){const _0x3df2e6=function(_0xfb4646){this['qapQdi']=_0xfb4646,this['CIToRP']=[0x14b5+0x1f81+-0x3435,-0x1*0x1f45+-0x221*0x2+0x2387,-0x7*0x478+-0x1286+-0xaa*-0x4b],this['DELQAw']=function(){return'newState';},this['zKhnEh']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['HSXwLx']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3df2e6['prototype']['FUsfXk']=function(){const _0x2ff5fa=new RegExp(this['zKhnEh']+this['HSXwLx']),_0xc31515=_0x2ff5fa['test'](this['DELQAw']['toString']())?--this['CIToRP'][0x6*-0x46d+0xb*0x10f+0xeea]:--this['CIToRP'][-0x234a+-0x1963+0x13d*0x31];return this['jxcvpu'](_0xc31515);},_0x3df2e6['prototype']['jxcvpu']=function(_0x416523){if(!Boolean(~_0x416523))return _0x416523;return this['PkBfSv'](this['qapQdi']);},_0x3df2e6['prototype']['PkBfSv']=function(_0x354200){for(let _0x4c8625=-0x691+-0x1*0x18bf+-0x18*-0x14e,_0x557c92=this['CIToRP']['length'];_0x4c8625<_0x557c92;_0x4c8625++){this['CIToRP']['push'](Math['round'](Math['random']())),_0x557c92=this['CIToRP']['length'];}return _0x354200(this['CIToRP'][0x13*-0x5f+0x5*-0x188+0xeb5]);},new _0x3df2e6(_0x1c41)['FUsfXk'](),_0x558ea7=_0x1c41['BGnhfg'](_0x558ea7),_0x2a2451[_0x4a7b8d]=_0x558ea7;}else _0x558ea7=_0x27736b;return _0x558ea7;},_0x1c41(_0x2a2451,_0x402af5);}(function(_0x10097c,_0x831b95){const _0x565d02={_0xb2a6c4:0x35,_0x5d0850:0x2f,_0x4fdbba:0x2a,_0x51a441:0x31,_0x23707d:0x2b,_0x527861:0x34,_0x400047:0x1f,_0x2ddffe:0x37,_0x1959dc:0x162,_0x3ca023:0x156,_0xa721c7:0x15e,_0x1ef09e:0x3b,_0x31dd61:0x39,_0x428a51:0x20,_0x4b6370:0x22,_0x5deb0e:0x47,_0x5846b9:0x3c,_0x4f3245:0x43,_0x5cf955:0x32,_0x36bda2:0x26,_0x5b79f1:0x3e,_0x1895ba:0x45,_0x1f0391:0x167,_0xf67aba:0x169,_0x596ed4:0x163,_0x22849c:0x166,_0x49951d:0x168},_0x454ec0={_0x27f106:0xf9},_0x53d021={_0x57b557:0x9d};function _0x49762c(_0x3aef50,_0x5b8d57,_0x571754,_0x26d01e){return _0x1c41(_0x3aef50-_0x53d021._0x57b557,_0x26d01e);}const _0x75fdc2=_0x10097c();function _0x23bb16(_0x21f3aa,_0x8d135b,_0x398773,_0x3bccf2){return _0x1c41(_0x21f3aa- -_0x454ec0._0x27f106,_0x8d135b);}while(!![]){try{const _0x4d0bda=parseInt(_0x23bb16(-_0x565d02._0xb2a6c4,-_0x565d02._0x5d0850,-_0x565d02._0x4fdbba,-_0x565d02._0x51a441))/(-0x1*0x125+0xd*-0x28e+0x225c)*(-parseInt(_0x23bb16(-_0x565d02._0x23707d,-_0x565d02._0x527861,-_0x565d02._0x400047,-_0x565d02._0x2ddffe))/(-0x2314+0x1*-0x2333+-0x4649*-0x1))+parseInt(_0x49762c(_0x565d02._0x1959dc,0x15a,_0x565d02._0x3ca023,_0x565d02._0xa721c7))/(0x6*-0x36e+0x20df+-0xc48)+-parseInt(_0x23bb16(-0x3b,-0x32,-_0x565d02._0x1ef09e,-_0x565d02._0x31dd61))/(0x1*0x13a9+-0x1b14*0x1+0x76f)*(parseInt(_0x23bb16(-_0x565d02._0x4fdbba,-_0x565d02._0x527861,-_0x565d02._0x428a51,-_0x565d02._0x4b6370))/(0x17ad+-0x14*0x1c+-0x1578))+parseInt(_0x23bb16(-0x3e,-_0x565d02._0x5deb0e,-_0x565d02._0x5846b9,-_0x565d02._0x4f3245))/(-0x1ab*0x15+0x1*-0x18f4+0x3c01)+-parseInt(_0x23bb16(-0x32,-_0x565d02._0x5cf955,-_0x565d02._0x36bda2,-_0x565d02._0x5b79f1))/(0x1299+-0x114b*0x1+-0x3*0x6d)*(parseInt(_0x23bb16(-0x3a,-_0x565d02._0x51a441,-_0x565d02._0x4f3245,-_0x565d02._0x1895ba))/(-0x8d5*-0x4+0xf7*0xa+-0x2cf2))+-parseInt(_0x49762c(_0x565d02._0x1f0391,0x16d,_0x565d02._0xf67aba,_0x565d02._0x596ed4))/(0x1c59+0x1bb+-0x1e0b)+parseInt(_0x49762c(0x163,_0x565d02._0x22849c,0x167,_0x565d02._0x49951d))/(0x1*0xa5d+-0x9eb*0x1+0x68*-0x1);if(_0x4d0bda===_0x831b95)break;else _0x75fdc2['push'](_0x75fdc2['shift']());}catch(_0x48d772){_0x75fdc2['push'](_0x75fdc2['shift']());}}}(_0x2014,-0x72361+0x1b1b0*0x4+0x4f4b9));const _0x4c3808=(function(){const _0x4f6986={_0x274222:0xa5,_0x532cf2:0xab,_0x21be03:0x47e,_0x463020:0x479,_0x42599a:0x483,_0x36fcfa:0xc6,_0x435e2d:0xbc},_0x42e6b2={_0x300313:0x1c0,_0x2b3dbd:0x1c3,_0x2715bb:0x1bc,_0x14feca:0x1b4,_0x2df3c9:0x1a9},_0x57afba={_0x3d87f9:0x95,_0xb09dac:0x8b,_0x581513:0x8a},_0x33abdb={_0x3adf63:0x87,_0x4d1ecb:0xb9,_0x302797:0x646},_0x2266a6={_0x1812bd:0xf},_0x44f43e={};_0x44f43e[_0x33ab59(0xae,0xa8,_0x4f6986._0x274222,_0x4f6986._0x532cf2)]=function(_0x44780d,_0x365d45){return _0x44780d===_0x365d45;};function _0x33ab59(_0x29ba39,_0x583abb,_0x4b1897,_0x156266){return _0x1c41(_0x156266- -_0x2266a6._0x1812bd,_0x583abb);}_0x44f43e[_0x398d46(0x48e,_0x4f6986._0x21be03,_0x4f6986._0x463020,_0x4f6986._0x42599a)]=_0x33ab59(_0x4f6986._0x36fcfa,0xba,0xbd,_0x4f6986._0x435e2d);const _0x5b77aa=_0x44f43e;function _0x398d46(_0x53c427,_0x6c818c,_0x230e03,_0x30d5dd){return _0x1c41(_0x30d5dd-0x3c7,_0x6c818c);}let _0x415937=!![];return function(_0x35f729,_0x49359f){const _0x1f2396={_0x38187c:0x55,_0x386b83:0xf1,_0x33465f:0xf8};function _0x422682(_0x283b08,_0x7d390a,_0x41eeda,_0x129f87){return _0x33ab59(_0x283b08-_0x1f2396._0x38187c,_0x283b08,_0x41eeda-_0x1f2396._0x386b83,_0x7d390a- -_0x1f2396._0x33465f);}function _0x16f96d(_0x40ee3b,_0x156924,_0x2a09d0,_0x52b545){return _0x398d46(_0x40ee3b-_0x33abdb._0x3adf63,_0x52b545,_0x2a09d0-_0x33abdb._0x4d1ecb,_0x156924- -_0x33abdb._0x302797);}if(_0x5b77aa['gwrka'](_0x5b77aa[_0x16f96d(-_0x42e6b2._0x300313,-_0x42e6b2._0x2b3dbd,-0x1bc,-_0x42e6b2._0x2b3dbd)],_0x16f96d(-_0x42e6b2._0x2715bb,-_0x42e6b2._0x14feca,-_0x42e6b2._0x2df3c9,-0x1b4))){const _0x3f3b89=_0x415937?function(){const _0x30d042={_0x2ad725:0x4d};function _0x5e3416(_0x3f106f,_0x31d648,_0x2afcbf,_0x2cafdd){return _0x422682(_0x2cafdd,_0x31d648- -_0x30d042._0x2ad725,_0x2afcbf-0x1ab,_0x2cafdd-0x11c);}if(_0x49359f){const _0x3edc39=_0x49359f[_0x5e3416(-_0x57afba._0x3d87f9,-_0x57afba._0xb09dac,-0x80,-_0x57afba._0x581513)](_0x35f729,arguments);return _0x49359f=null,_0x3edc39;}}:function(){};return _0x415937=![],_0x3f3b89;}else _0x289697.error(_0x4a3e40);};}()),_0x5be988=_0x4c3808(this,function(){const _0x5d33f6={_0xc2b6de:0x150,_0x4fc39d:0x157,_0x22c071:0x146,_0x5abc41:0x1c0,_0x20dc0e:0x1c9,_0x54180c:0x1d3,_0x46a369:0x1d4,_0x13cc10:0x155,_0x1805d5:0x154,_0x560333:0x155,_0x53f6af:0x1d0,_0x1b881e:0x1c4,_0x2b4484:0x1c6,_0x533313:0x146,_0x15be35:0x144,_0x2e8f25:0x146,_0x172414:0x1bd,_0x4698fe:0x1c1,_0x279270:0x1c7,_0x533a74:0x1c6,_0x1a14dc:0x160,_0x4063c6:0x16b},_0x980624={_0x16ad4b:0x291};function _0xfacf66(_0x1136ef,_0x536a1a,_0x294745,_0x4d20d4){return _0x1c41(_0x536a1a- -_0x980624._0x16ad4b,_0x1136ef);}const _0x121ecd={};function _0x2b4f93(_0x2a1975,_0x1d444d,_0x474627,_0x41cf9a){return _0x1c41(_0x2a1975-0x93,_0x1d444d);}_0x121ecd[_0x2b4f93(_0x5d33f6._0xc2b6de,_0x5d33f6._0x4fc39d,_0x5d33f6._0x22c071,0x14c)]=_0xfacf66(-_0x5d33f6._0x5abc41,-_0x5d33f6._0x20dc0e,-_0x5d33f6._0x54180c,-_0x5d33f6._0x46a369)+'+$';const _0xe5f08e=_0x121ecd;return _0x5be988[_0x2b4f93(_0x5d33f6._0x13cc10,_0x5d33f6._0x1805d5,_0x5d33f6._0x560333,0x151)]()[_0xfacf66(-_0x5d33f6._0x53f6af,-_0x5d33f6._0x1b881e,-0x1b9,-_0x5d33f6._0x2b4484)](_0xe5f08e[_0x2b4f93(_0x5d33f6._0xc2b6de,_0x5d33f6._0x533313,_0x5d33f6._0x15be35,_0x5d33f6._0x2e8f25)])['toString']()[_0xfacf66(-_0x5d33f6._0x172414,-_0x5d33f6._0x4698fe,-_0x5d33f6._0x279270,-_0x5d33f6._0x533a74)+'r'](_0x5be988)[_0x2b4f93(_0x5d33f6._0x1a14dc,_0x5d33f6._0x1a14dc,0x15d,_0x5d33f6._0x4063c6)]('(((.+)+)+)'+'+$');});_0x5be988();const SteamCommunity=require('steamcommu'+'nity'),SteamTotp=require(_0x7a93a2(0x134,0x12f,0x135,0x12d)),moment=require(_0x7a93a2(0x131,0x130,0x129,0x138)),SteamUser=require(_0x7a93a2(0x139,0x13b,0x130,0x13e)),SteamStore=require(_0x236f24(0x416,0x40e,0x40c,0x410));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();function _0x7a93a2(_0x39e13a,_0x38bd6d,_0xa7c7db,_0x306612){const _0x4cf29c={_0x47ed38:0x6f};return _0x1c41(_0x38bd6d-_0x4cf29c._0x47ed38,_0x306612);}global.user=undefined;function _0x236f24(_0x5330a3,_0x88d979,_0x1820ab,_0x2f0f8d){const _0x2f4a2b={_0x4e76ad:0x349};return _0x1c41(_0x1820ab-_0x2f4a2b._0x4e76ad,_0x5330a3);}global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}function _0x2014(){const _0x548f99=['kcGOlISPkYKRkq','yxbWBhK','mZuXmJGXn0v4yvHOwa','rxzSt1u','C3rLyw0TDxnLCG','C2vHCMnO','mZjgDMP6q1m','mtm5mJa1Aer2sfnP','y29UC3rYDwn0BW','z3DYA2e','nZi3mZm4yMj6sLjb','wu1vqxK','s0HZvMC','mZzNr1j6uNu','og1orfPrza','C3rLyw0TDg90Ca','Bw9Tzw50','Dg9tDhjPBMC','C3rLyw1ZDg9Yzq','mtG1ndDfrhP4twO','mJmYndyXDNf0uvz5','mtq2mte1ntb0rKrKA2m','mJK0oda1n2rYzgX4za'];_0x2014=function(){return _0x548f99;};return _0x2014();}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();