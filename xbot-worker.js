(function(_0x2d78d3,_0x6bef8d){const _0xd2de41={_0x44666e:0x1f8,_0x42ed4a:0x1e4,_0x52e722:0x1e4,_0x3a56b9:0x1,_0x135a4b:0x2,_0x69d9c6:0x1e7,_0x23ae16:0x1d6,_0x110c44:0x1df,_0x4e1871:0x1d8,_0x2915e3:0x4,_0x420ff1:0x3,_0x376803:0x15,_0x17cb24:0x6,_0x200b22:0x10,_0x260f78:0x1da,_0x374478:0x1e6,_0x801bd:0x1d9,_0xc6769e:0x1de,_0x2e7995:0x1e5,_0x242565:0x1de,_0x563880:0x1dc,_0x52488c:0x13,_0x5af888:0x10,_0x133949:0x12,_0x5bf628:0x1d9,_0x296a80:0x1d8,_0x1bc7b6:0x1d8},_0x434328={_0x496382:0x99},_0x5ece6d=_0x2d78d3();function _0x26fbab(_0xdf5c19,_0x21efb5,_0x190ad1,_0x42fff4){return _0x1a95(_0xdf5c19- -0x28f,_0x190ad1);}function _0x1bbcd4(_0x439ed1,_0x6734b4,_0x284238,_0x5b3cae){return _0x1a95(_0x284238- -_0x434328._0x496382,_0x439ed1);}while(!![]){try{const _0x2df861=-parseInt(_0x26fbab(-0x1ee,-_0xd2de41._0x44666e,-_0xd2de41._0x42ed4a,-_0xd2de41._0x52e722))/(-0x2*0x118c+0x11a8+0x1171)+parseInt(_0x1bbcd4(0x3,_0xd2de41._0x3a56b9,_0xd2de41._0x135a4b,0x7))/(0x2455+-0x1c46+-0x80d)*(-parseInt(_0x26fbab(-0x1e5,-_0xd2de41._0x69d9c6,-0x1f2,-_0xd2de41._0x23ae16))/(-0x2632+0x4f*0x61+0x3*0x2c2))+-parseInt(_0x26fbab(-_0xd2de41._0x110c44,-_0xd2de41._0x4e1871,-0x1da,-0x1e3))/(0x1b1c+0x123f+-0x2d57)+-parseInt(_0x1bbcd4(0x12,0x8,_0xd2de41._0x2915e3,_0xd2de41._0x420ff1))/(0x1c18+-0x1f13+0x10*0x30)+parseInt(_0x1bbcd4(0x3,_0xd2de41._0x376803,_0xd2de41._0x17cb24,_0xd2de41._0x200b22))/(-0x3d*-0x47+0x1*0x2231+0x3ee*-0xd)*(-parseInt(_0x26fbab(-_0xd2de41._0x4e1871,-_0xd2de41._0x260f78,-_0xd2de41._0x374478,-_0xd2de41._0x801bd))/(0x81*-0x2d+-0x2669*0x1+0x3d1d))+parseInt(_0x26fbab(-_0xd2de41._0xc6769e,-_0xd2de41._0x2e7995,-_0xd2de41._0x242565,-_0xd2de41._0x563880))/(-0x22db+-0x1c73*-0x1+0x670)*(parseInt(_0x1bbcd4(_0xd2de41._0x52488c,_0xd2de41._0x5af888,_0xd2de41._0x133949,0xe))/(-0x1299+-0x79*0x42+-0x3*-0x109c))+parseInt(_0x26fbab(-_0xd2de41._0x5bf628,-_0xd2de41._0x296a80,-_0xd2de41._0x1bc7b6,-_0xd2de41._0x2e7995))/(0x655*0x1+0x350*-0x2+0x55);if(_0x2df861===_0x6bef8d)break;else _0x5ece6d['push'](_0x5ece6d['shift']());}catch(_0xf778e5){_0x5ece6d['push'](_0x5ece6d['shift']());}}}(_0x5c1f,-0x161f40+0x457e5+0xc*0x27a1b));const _0xf26434=(function(){const _0x254a14={_0x47dac1:0xb3,_0x10b740:0xc1,_0x3c289d:0xac,_0x31d0ef:0xbc,_0x424be4:0x5b,_0x2f0192:0x57,_0x440c39:0x50,_0x4e95ea:0x42,_0x5b861c:0x41,_0x45cbd1:0xb5,_0x4a7490:0xa5,_0x55cb3b:0xab,_0x2d333d:0xa3,_0x117b2f:0x9b,_0x40eb64:0xb0,_0x24fef9:0xbc,_0xba9ce5:0xbb},_0xf855e6={_0xdf52d3:0x26c,_0x1ea9d7:0x275,_0x351fe6:0x26a,_0x290f16:0x25a,_0x27ea19:0x4b,_0x164d37:0x58,_0x21eb47:0x5a,_0x4fe0a9:0x261,_0x55167f:0x255,_0x37e462:0x254},_0x30877e={_0x4754ed:0x20a,_0x4c0222:0x8f},_0x19745e={_0x5245b7:0xfe},_0x57343d={_0x505b6c:0x153},_0x40329a={};_0x40329a[_0xc02835(-_0x254a14._0x47dac1,-_0x254a14._0x10b740,-_0x254a14._0x3c289d,-_0x254a14._0x31d0ef)]=function(_0x362a16,_0x38cd08){return _0x362a16!==_0x38cd08;},_0x40329a['YyHeq']=_0x18b761(-0x5a,-0x65,-_0x254a14._0x424be4,-_0x254a14._0x2f0192);function _0xc02835(_0x3ef88b,_0x5108b2,_0x39367d,_0x19382c){return _0x1a95(_0x3ef88b- -_0x57343d._0x505b6c,_0x5108b2);}_0x40329a['KpDyP']=_0x18b761(-_0x254a14._0x440c39,-_0x254a14._0x4e95ea,-0x5f,-_0x254a14._0x5b861c);function _0x18b761(_0x23b81d,_0x121d61,_0x4c8869,_0x2ca497){return _0x1a95(_0x23b81d- -_0x19745e._0x5245b7,_0x121d61);}_0x40329a[_0xc02835(-_0x254a14._0x45cbd1,-_0x254a14._0x4a7490,-_0x254a14._0x31d0ef,-0xa7)]=function(_0x1d0387,_0x4816de){return _0x1d0387!==_0x4816de;},_0x40329a[_0xc02835(-_0x254a14._0x55cb3b,-_0x254a14._0x4a7490,-_0x254a14._0x2d333d,-_0x254a14._0x117b2f)]='CbsDM',_0x40329a['reIlC']=_0xc02835(-_0x254a14._0x40eb64,-_0x254a14._0x24fef9,-_0x254a14._0xba9ce5,-0xa7);const _0x10f74c=_0x40329a;let _0x2aea67=!![];return function(_0x155399,_0xdd60e1){const _0x40f6f5={_0x47cf6a:0x136,_0x4754c1:0x135,_0x4efe14:0x2a7,_0x390e42:0x2b6,_0x3f1288:0x298,_0x6a1cf1:0x2b0,_0x4e9f9e:0x297,_0x9f1811:0x29a,_0x5d22e2:0x295,_0x3605a6:0x292,_0x25682f:0x291,_0x2b081c:0x289,_0x11a8eb:0x294},_0x4bdc4b={_0x533e10:0x1a4,_0x2d936b:0x128},_0x1d3e63={_0x36ba79:0x51,_0x430aff:0x180};function _0xdafd50(_0x3874b0,_0x573a45,_0x26eb4c,_0x255714){return _0x18b761(_0x26eb4c- -_0x30877e._0x4754ed,_0x255714,_0x26eb4c-_0x30877e._0x4c0222,_0x255714-0x1a);}function _0xa44994(_0xcc7b2f,_0x1a5f67,_0x445bb1,_0x39dfce){return _0xc02835(_0x445bb1-_0x1d3e63._0x36ba79,_0xcc7b2f,_0x445bb1-_0x1d3e63._0x430aff,_0x39dfce-0x14c);}if(_0x10f74c[_0xdafd50(-_0xf855e6._0xdf52d3,-_0xf855e6._0x1ea9d7,-_0xf855e6._0x351fe6,-_0xf855e6._0x290f16)](_0x10f74c[_0xa44994(-_0xf855e6._0x27ea19,-_0xf855e6._0x164d37,-_0xf855e6._0x21eb47,-0x51)],_0x10f74c[_0xdafd50(-0x264,-_0xf855e6._0x4fe0a9,-_0xf855e6._0x55167f,-_0xf855e6._0x37e462)])){const _0x5b3fa8=_0x2aea67?function(){const _0x355545={_0x3ca59c:0xf2,_0x21fd00:0x241,_0x15de60:0x1b5};function _0x4efbca(_0x4911eb,_0x24779f,_0x24953b,_0x5e1096){return _0xa44994(_0x24779f,_0x24779f-_0x355545._0x3ca59c,_0x4911eb- -_0x355545._0x21fd00,_0x5e1096-_0x355545._0x15de60);}function _0x2f923f(_0x1fa9c4,_0x343511,_0x353842,_0x1ae45d){return _0xdafd50(_0x1fa9c4-_0x4bdc4b._0x533e10,_0x343511-0x6f,_0x1fa9c4-_0x4bdc4b._0x2d936b,_0x343511);}if(_0x10f74c['BOWjz'](_0x2f923f(-0x13c,-0x13c,-_0x40f6f5._0x47cf6a,-_0x40f6f5._0x4754c1),_0x10f74c[_0x4efbca(-_0x40f6f5._0x4efe14,-_0x40f6f5._0x390e42,-_0x40f6f5._0x3f1288,-_0x40f6f5._0x6a1cf1)])){_0x30b477.log('Не установлен параметр XBOT_SHARED_SECRET');return;}else{if(_0xdd60e1){if(_0x10f74c[_0x4efbca(-_0x40f6f5._0x4e9f9e,-0x29f,-_0x40f6f5._0x9f1811,-_0x40f6f5._0x3f1288)]!==_0x4efbca(-_0x40f6f5._0x5d22e2,-_0x40f6f5._0x3605a6,-_0x40f6f5._0x25682f,-_0x40f6f5._0x2b081c))_0x9011e4.log('Ошибка получения обновлений');else{const _0x3c3837=_0xdd60e1[_0x4efbca(-_0x40f6f5._0x11a8eb,-0x29c,-0x28a,-0x290)](_0x155399,arguments);return _0xdd60e1=null,_0x3c3837;}}}}:function(){};return _0x2aea67=![],_0x5b3fa8;}else{_0x1a1ade.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}};}()),_0x1ac23d=_0xf26434(this,function(){const _0x50e140={_0x22d8de:0x196,_0x5b52e1:0x1a2,_0x1e5ed1:0x191,_0x1222e7:0x185,_0x2865f3:0x17c,_0x1487d5:0x279,_0x5004c9:0x271,_0x471932:0x26c,_0x2afce3:0x18e,_0x120ef2:0x186,_0x2f1dec:0x17b,_0x145e28:0x26b,_0x5b67c9:0x25d,_0xb307fb:0x26c,_0x121114:0x18b,_0x5f3320:0x177,_0x5d703b:0x187,_0x2a4a65:0x27f,_0x3cde12:0x275,_0x2181fc:0x27c,_0x27a1eb:0x277},_0x445b20={};function _0x32ad75(_0x34069b,_0x12b5d9,_0x46d2d6,_0x336771){return _0x1a95(_0x46d2d6- -0x23e,_0x12b5d9);}_0x445b20[_0x32ad75(-_0x50e140._0x22d8de,-0x18c,-0x19c,-_0x50e140._0x5b52e1)]=_0x32ad75(-0x17b,-_0x50e140._0x1e5ed1,-_0x50e140._0x1222e7,-_0x50e140._0x2865f3)+'+$';const _0x3a6c15=_0x445b20;function _0x500488(_0x478825,_0x58be0e,_0xd00dfe,_0x1dc104){return _0x1a95(_0xd00dfe- -0x31e,_0x1dc104);}return _0x1ac23d[_0x500488(-_0x50e140._0x1487d5,-0x26d,-_0x50e140._0x5004c9,-_0x50e140._0x471932)]()[_0x32ad75(-_0x50e140._0x2afce3,-0x190,-_0x50e140._0x120ef2,-_0x50e140._0x2f1dec)]('(((.+)+)+)'+'+$')[_0x500488(-_0x50e140._0x471932,-_0x50e140._0x145e28,-_0x50e140._0x5004c9,-0x274)]()[_0x500488(-_0x50e140._0x5b67c9,-0x271,-_0x50e140._0xb307fb,-_0x50e140._0x5004c9)+'r'](_0x1ac23d)[_0x32ad75(-_0x50e140._0x121114,-_0x50e140._0x5f3320,-0x186,-_0x50e140._0x5d703b)](_0x3a6c15[_0x500488(-_0x50e140._0x2a4a65,-_0x50e140._0x3cde12,-_0x50e140._0x2181fc,-_0x50e140._0x27a1eb)]);});_0x1ac23d();const SteamCommunity=require(_0x1a9a89(0x1b5,0x1a5,0x1aa,0x1a7)+_0xc9cb81(-0x1ad,-0x192,-0x19b,-0x19e)),SteamTotp=require(_0x1a9a89(0x1a7,0x1b1,0x1ac,0x1a2)),moment=require(_0xc9cb81(-0x1a6,-0x1a1,-0x1a0,-0x19d)),SteamUser=require(_0xc9cb81(-0x1a6,-0x1ab,-0x1a0,-0x1ad)),SteamStore=require(_0x1a9a89(0x1aa,0x19c,0x1a9,0x1a5));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}function _0x5c1f(){const _0xfe788a=['DKLLDKW','ndeYoti0oe9bAhrhCq','qK9xANO','mZGYndi4re1vAfbS','qMDhyMG','sLLJq3a','v2DJsKG','C3rLyw0TDxnLCG','C3rLyw1ZDg9Yzq','C3rLyw1JB21TDq','zLbICuy','C3rLyw0TDg90Ca','mZq1otu3vK5cy05q','ntrrEevuuKe','s3beEva','Dg9tDhjPBMC','vMnmuu8','yxbWBhK','otK0ndy0D3biqKzt','mte0mJi5nNrAuM1syG','y29UC3rYDwn0BW','CMvjBem','BML0Eq','Bw9Tzw50','mJqXnJi2mdbyAK1yEeO','mtrht0XrvhO','C2vHCMnO','kcGOlISPkYKRkq','nNLlshDTDa','wxLizxe','nJGZnZaWzfjjrvnc'];_0x5c1f=function(){return _0xfe788a;};return _0x5c1f();}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;function _0x1a95(_0x311637,_0x580f0c){const _0x3173c6=_0x5c1f();return _0x1a95=function(_0x37b14b,_0x584de5){_0x37b14b=_0x37b14b-(0x995+-0x22c9+0x19cf);let _0x2c91dd=_0x3173c6[_0x37b14b];if(_0x1a95['dHZltl']===undefined){var _0x333c1d=function(_0x151bbb){const _0x49b0cc='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5ac2da='',_0x3896b1='',_0x14363d=_0x5ac2da+_0x333c1d;for(let _0x36be57=-0x48d*-0x8+-0x2*0x8a5+-0x2*0x98f,_0x399166,_0x2d8ef,_0x8c1cb=0x5b*0x5+-0x1581+-0x19*-0xca;_0x2d8ef=_0x151bbb['charAt'](_0x8c1cb++);~_0x2d8ef&&(_0x399166=_0x36be57%(-0x3*-0x693+0x23*-0xf1+0xd3e)?_0x399166*(0xbd3*-0x3+-0x17*0x7c+0x2edd*0x1)+_0x2d8ef:_0x2d8ef,_0x36be57++%(0x1*0x4a+-0x2*0x5f2+-0xb9e*-0x1))?_0x5ac2da+=_0x14363d['charCodeAt'](_0x8c1cb+(-0x2332+-0x923+0x2c5f))-(-0x1471*0x1+-0xaf9*0x3+0x3566)!==-0x3*-0x19+0x1*-0xfad+0xf62?String['fromCharCode'](-0x1610+-0x24a3+0x3bb2&_0x399166>>(-(0x2371+0x1fa1+-0x4310)*_0x36be57&0x1*0x1003+-0x192c+-0x92f*-0x1)):_0x36be57:0x11af*-0x1+-0x2064+0x3213){_0x2d8ef=_0x49b0cc['indexOf'](_0x2d8ef);}for(let _0x4f6f9e=-0x120b+0x1808+-0x5fd,_0xe4abf=_0x5ac2da['length'];_0x4f6f9e<_0xe4abf;_0x4f6f9e++){_0x3896b1+='%'+('00'+_0x5ac2da['charCodeAt'](_0x4f6f9e)['toString'](0x29*0xc7+-0x1406*0x1+-0xbc9))['slice'](-(-0x1*0x2124+-0x5c6*-0x5+-0x8*-0x89));}return decodeURIComponent(_0x3896b1);};_0x1a95['TtSEls']=_0x333c1d,_0x311637=arguments,_0x1a95['dHZltl']=!![];}const _0x98948d=_0x3173c6[0xfae+0xd5*0x2+-0x1158],_0x1fd3f1=_0x37b14b+_0x98948d,_0x21a80a=_0x311637[_0x1fd3f1];if(!_0x21a80a){const _0x137750=function(_0x526491){this['mAwBJJ']=_0x526491,this['kWPGAE']=[-0xea5+-0x1709*-0x1+-0x863,0xca8+0x1d3e+0x15a*-0x1f,-0x1*-0x162a+-0xa09+-0xc21],this['MnbGau']=function(){return'newState';},this['axtxoI']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['qHVXJM']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x137750['prototype']['aDmagx']=function(){const _0x176f36=new RegExp(this['axtxoI']+this['qHVXJM']),_0x11b9a6=_0x176f36['test'](this['MnbGau']['toString']())?--this['kWPGAE'][0x2574+-0xf2b+-0x7c*0x2e]:--this['kWPGAE'][-0x2048+0x1a5c+0x5ec];return this['ssxUYl'](_0x11b9a6);},_0x137750['prototype']['ssxUYl']=function(_0x90f3ca){if(!Boolean(~_0x90f3ca))return _0x90f3ca;return this['CwKrbf'](this['mAwBJJ']);},_0x137750['prototype']['CwKrbf']=function(_0x190cd3){for(let _0x1b0b63=0x3e5*0x7+0x2b0+0x1c3*-0x11,_0x55a6b7=this['kWPGAE']['length'];_0x1b0b63<_0x55a6b7;_0x1b0b63++){this['kWPGAE']['push'](Math['round'](Math['random']())),_0x55a6b7=this['kWPGAE']['length'];}return _0x190cd3(this['kWPGAE'][-0x8b1+-0x1*0x551+0xe02]);},new _0x137750(_0x1a95)['aDmagx'](),_0x2c91dd=_0x1a95['TtSEls'](_0x2c91dd),_0x311637[_0x1fd3f1]=_0x2c91dd;}else _0x2c91dd=_0x21a80a;return _0x2c91dd;},_0x1a95(_0x311637,_0x580f0c);}try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}function _0x1a9a89(_0x5c8c78,_0x4df256,_0x5b90e4,_0x528fd3){return _0x1a95(_0x5b90e4-0x103,_0x4df256);}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}function _0xc9cb81(_0x36bc7f,_0x3c9257,_0x841a89,_0x1b8731){const _0x4a6767={_0x2f05af:0x252};return _0x1a95(_0x1b8731- -_0x4a6767._0x2f05af,_0x841a89);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();