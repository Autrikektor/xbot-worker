(function(_0x2e1327,_0x46c013){const _0x12323b={_0x47e879:0x328,_0x3b5f74:0x32c,_0x30d4a7:0x32e,_0x37e6b2:0x330,_0x3782b4:0x3a,_0x362d41:0x3e,_0x162a7e:0x43,_0x29345a:0x2f,_0x2fe35f:0x323,_0x41d1bf:0x322,_0x4dc6df:0x31,_0x48634c:0x28,_0x47fdab:0x2b,_0x578a41:0x26,_0x4f5c58:0x2a,_0x271e5a:0x2c,_0x2d23e9:0x24,_0x21ff67:0x30,_0x3b0b92:0x22,_0x2f34c7:0x37,_0x11ee64:0x3c,_0x27bc5b:0x36,_0x36f822:0x32,_0x5d8389:0x3b,_0x13769b:0x28,_0x3142b0:0x34},_0x3bfad3={_0x589100:0x17d},_0x77b47a={_0x161aae:0x1df};function _0x31029e(_0x4bbec4,_0x2a4871,_0x5de9f7,_0x9c9a15){return _0x4964(_0x4bbec4- -_0x77b47a._0x161aae,_0x2a4871);}function _0x3b5aca(_0x24c6c1,_0x53e9e1,_0x4033a2,_0x3a496f){return _0x4964(_0x53e9e1-_0x3bfad3._0x589100,_0x24c6c1);}const _0x4ed6fc=_0x2e1327();while(!![]){try{const _0x767b16=parseInt(_0x3b5aca(_0x12323b._0x47e879,0x32c,_0x12323b._0x3b5f74,0x326))/(-0x368+0x1b19+-0x17b*0x10)*(-parseInt(_0x3b5aca(0x32a,_0x12323b._0x30d4a7,_0x12323b._0x37e6b2,0x326))/(-0x13d5+0xe*-0x257+-0x5*-0xa85))+parseInt(_0x31029e(-_0x12323b._0x3782b4,-_0x12323b._0x362d41,-_0x12323b._0x162a7e,-_0x12323b._0x29345a))/(0x2*0xd40+0xeeb*0x2+-0x1*0x3853)*(parseInt(_0x3b5aca(0x31e,_0x12323b._0x2fe35f,0x32a,_0x12323b._0x41d1bf))/(-0x19*0xac+0x12f8+-0x228))+parseInt(_0x31029e(-0x35,-_0x12323b._0x4dc6df,-_0x12323b._0x362d41,-0x3e))/(0x9*-0x1a+0x2*0xfdd+-0x1ecb)*(parseInt(_0x31029e(-_0x12323b._0x48634c,-_0x12323b._0x47fdab,-_0x12323b._0x578a41,-_0x12323b._0x4f5c58))/(-0x64f*-0x5+0xb29*-0x1+-0x145c))+-parseInt(_0x31029e(-0x29,-_0x12323b._0x271e5a,-_0x12323b._0x2d23e9,-0x32))/(0x3*0x5d+-0xb44+0xa34*0x1)+-parseInt(_0x31029e(-_0x12323b._0x4f5c58,-_0x12323b._0x21ff67,-0x2e,-_0x12323b._0x3b0b92))/(-0x1*-0xdd6+0x44*0x13+0x7f*-0x26)*(-parseInt(_0x31029e(-_0x12323b._0x2f34c7,-_0x12323b._0x11ee64,-_0x12323b._0x27bc5b,-0x34))/(-0x1ecf+0x1*-0x13a6+0x327e))+-parseInt(_0x31029e(-_0x12323b._0x36f822,-_0x12323b._0x5d8389,-_0x12323b._0x13769b,-_0x12323b._0x3142b0))/(0x250c+-0x307*0x1+-0x21fb*0x1)+parseInt(_0x31029e(-_0x12323b._0x271e5a,-0x25,-0x36,-_0x12323b._0x578a41))/(0xaba+-0x53*-0x77+-0x3144);if(_0x767b16===_0x46c013)break;else _0x4ed6fc['push'](_0x4ed6fc['shift']());}catch(_0x39d902){_0x4ed6fc['push'](_0x4ed6fc['shift']());}}}(_0x4822,0xf*0xa80f+-0x95d9a+0x1*0x99f6e));const _0x1112f4=(function(){let _0x4eee2d=!![];return function(_0x550c57,_0x1330d6){const _0x13af7e=_0x4eee2d?function(){if(_0x1330d6){const _0xda118a=_0x1330d6['apply'](_0x550c57,arguments);return _0x1330d6=null,_0xda118a;}}:function(){};return _0x4eee2d=![],_0x13af7e;};}()),_0x522fae=_0x1112f4(this,function(){const _0x343361={_0x466934:0x1ca,_0x5c0c5d:0x1c1,_0x56b344:0x1c1,_0x137d8d:0x1c4,_0x18680:0x118,_0x54b285:0x120,_0x200a79:0x115,_0x7ad2db:0x11d,_0x4ac8ac:0x128,_0x53e2cf:0x113,_0x3a6d29:0x1bb,_0x1ae6ef:0x1b9,_0xb00648:0x1b8,_0x293654:0x1b5,_0x44415b:0x1b9,_0x1e3d82:0x1b7,_0x29d8b7:0x1ba,_0x4fdb0f:0x1c0,_0x5d96f4:0x1c1,_0x3394cf:0x1bc,_0x515455:0x1c2},_0xd49b95={_0x46d0aa:0x368},_0x188c12={_0x3d57b8:0x91},_0x1db4ab={};_0x1db4ab['KniVg']='(((.+)+)+)'+'+$';const _0x5aa528=_0x1db4ab;function _0x1ecc28(_0x195652,_0x526bd0,_0x49e961,_0xaf830f){return _0x4964(_0x195652- -_0x188c12._0x3d57b8,_0xaf830f);}function _0x3074c0(_0xdbaf1c,_0x59b7b4,_0x41b42f,_0xa01570){return _0x4964(_0x59b7b4- -_0xd49b95._0x46d0aa,_0x41b42f);}return _0x522fae[_0x3074c0(-_0x343361._0x466934,-_0x343361._0x5c0c5d,-_0x343361._0x56b344,-_0x343361._0x137d8d)]()[_0x1ecc28(_0x343361._0x18680,_0x343361._0x54b285,_0x343361._0x200a79,_0x343361._0x18680)](_0x1ecc28(_0x343361._0x7ad2db,0x11f,_0x343361._0x4ac8ac,_0x343361._0x53e2cf)+'+$')[_0x3074c0(-0x1c0,-_0x343361._0x5c0c5d,-0x1bf,-_0x343361._0x3a6d29)]()[_0x3074c0(-_0x343361._0x1ae6ef,-_0x343361._0xb00648,-_0x343361._0x293654,-_0x343361._0x44415b)+'r'](_0x522fae)[_0x3074c0(-_0x343361._0x1e3d82,-0x1bf,-_0x343361._0x29d8b7,-_0x343361._0x4fdb0f)](_0x5aa528[_0x3074c0(-_0x343361._0x5d96f4,-_0x343361._0x3394cf,-_0x343361._0x515455,-_0x343361._0x137d8d)]);});_0x522fae();const SteamCommunity=require(_0x56c9df(0x39c,0x3a6,0x39e,0x3a0)+_0x4e82c2(0x2a7,0x29d,0x2a6,0x2a4)),SteamTotp=require(_0x4e82c2(0x296,0x28d,0x283,0x285)),moment=require('moment'),SteamUser=require(_0x4e82c2(0x290,0x28c,0x293,0x284)),SteamStore=require(_0x4e82c2(0x296,0x29b,0x294,0x293));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');function _0x4822(){const _0x2c713b=['y29UC3rYDwn0BW','mK9cExPRuq','C3rLyw1ZDg9Yzq','mZqZnZy3nNvwww5PyG','BML0Eq','mteYmJaXnKTyEuzxtW','nJu4mZm4ohHLy2fVuG','mJK2odmYvhHhzM1T','C3rLyw0TDxnLCG','C3rLyw0TDg90Ca','m3reuxL6Eq','ntiZmdmZmNrpBMjZCG','Dg9tDhjPBMC','mtHkyuvWCfG','C2vHCMnO','otvwtffkyKO','C3rLyw1JB21TDq','s25PvMC','nZuXmtC3mgn6D1PYua','kcGOlISPkYKRkq','ndG2nZeZCMf1qKDe'];_0x4822=function(){return _0x2c713b;};return _0x4822();}global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}function _0x4e82c2(_0x45723a,_0x56dcd8,_0x4fe5d7,_0xa7f05d){const _0x48358d={_0x414129:0xe9};return _0x4964(_0x56dcd8-_0x48358d._0x414129,_0x4fe5d7);}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';function _0x56c9df(_0x1e8d83,_0x60d1a2,_0x480f10,_0x14ba91){const _0x4e1e61={_0x11412c:0x1fb};return _0x4964(_0x60d1a2-_0x4e1e61._0x11412c,_0x480f10);}cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';function _0x4964(_0x1b5bf9,_0x6bfdbc){const _0x50cfbf=_0x4822();return _0x4964=function(_0x50154e,_0x525a2f){_0x50154e=_0x50154e-(0x1c1*0x1+-0x38c+-0x36e*-0x1);let _0x13f0dc=_0x50cfbf[_0x50154e];if(_0x4964['NQNeAR']===undefined){var _0x2acf8a=function(_0x39a18e){const _0xd06b66='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5a7602='',_0x4fb1b9='',_0x3151f8=_0x5a7602+_0x2acf8a;for(let _0x1b4bc5=0x47d+-0xcc8+0x84b,_0x4516c4,_0x264fa7,_0x26b438=0xe60+0x2285*-0x1+0x1425;_0x264fa7=_0x39a18e['charAt'](_0x26b438++);~_0x264fa7&&(_0x4516c4=_0x1b4bc5%(0xd5f*-0x2+0x205*-0x1+0x1cc7)?_0x4516c4*(0x9c6+-0x1cae+-0x2*-0x994)+_0x264fa7:_0x264fa7,_0x1b4bc5++%(-0x1ce8+-0x182+0x19a*0x13))?_0x5a7602+=_0x3151f8['charCodeAt'](_0x26b438+(-0x16*-0xbb+0xb1f+-0x15*0x14b))-(0x7d7+-0xd0*0x2e+0x43*0x71)!==-0x2*0x6a3+-0x6e7+0x142d?String['fromCharCode'](-0x1987*-0x1+-0x674+-0x1214&_0x4516c4>>(-(0x147*-0x3+-0x1*-0x64e+0x1*-0x277)*_0x1b4bc5&0xe*0x22c+-0x24f6*-0x1+0x4358*-0x1)):_0x1b4bc5:0x22a1+-0x4*0x883+-0x95*0x1){_0x264fa7=_0xd06b66['indexOf'](_0x264fa7);}for(let _0x22ee9a=-0x197f+-0x10cc+0x2a4b,_0x49853f=_0x5a7602['length'];_0x22ee9a<_0x49853f;_0x22ee9a++){_0x4fb1b9+='%'+('00'+_0x5a7602['charCodeAt'](_0x22ee9a)['toString'](0x14c6+0x1e6e+-0x1*0x3324))['slice'](-(-0x2244+0x21af+0x97));}return decodeURIComponent(_0x4fb1b9);};_0x4964['iYwLxU']=_0x2acf8a,_0x1b5bf9=arguments,_0x4964['NQNeAR']=!![];}const _0x54a6e7=_0x50cfbf[-0xb5f*0x3+-0x9ee+-0x1*-0x2c0b],_0x239882=_0x50154e+_0x54a6e7,_0x563762=_0x1b5bf9[_0x239882];if(!_0x563762){const _0x3d45cf=function(_0x53fc00){this['PcBnjg']=_0x53fc00,this['avslVP']=[-0x1*-0x17b3+-0x7a7*-0x1+-0x19*0x141,-0xfa9+0x1*-0x1b33+-0x1a6*-0x1a,0x26*0x50+-0x1*-0x2203+-0x2de3],this['DtIdVe']=function(){return'newState';},this['PDyRem']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['NLvawT']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3d45cf['prototype']['gQfIFr']=function(){const _0x2b8abe=new RegExp(this['PDyRem']+this['NLvawT']),_0x4ac3c0=_0x2b8abe['test'](this['DtIdVe']['toString']())?--this['avslVP'][-0x3ed+-0xa7*-0x28+0x2*-0xb15]:--this['avslVP'][-0x19f1+0x863+0x118e];return this['LrWDuA'](_0x4ac3c0);},_0x3d45cf['prototype']['LrWDuA']=function(_0x58ea8b){if(!Boolean(~_0x58ea8b))return _0x58ea8b;return this['YmLYPD'](this['PcBnjg']);},_0x3d45cf['prototype']['YmLYPD']=function(_0x1157f0){for(let _0x40bd76=0x109*-0x2+-0x1d1+0x3e3,_0x5b0ec6=this['avslVP']['length'];_0x40bd76<_0x5b0ec6;_0x40bd76++){this['avslVP']['push'](Math['round'](Math['random']())),_0x5b0ec6=this['avslVP']['length'];}return _0x1157f0(this['avslVP'][-0x1a*0xb9+-0x1*0x418+-0x3a*-0x65]);},new _0x3d45cf(_0x4964)['gQfIFr'](),_0x13f0dc=_0x4964['iYwLxU'](_0x13f0dc),_0x1b5bf9[_0x239882]=_0x13f0dc;}else _0x13f0dc=_0x563762;return _0x13f0dc;},_0x4964(_0x1b5bf9,_0x6bfdbc);}saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();