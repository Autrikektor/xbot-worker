(function(_0x523362,_0x4c547a){const _0x3ae75d={_0x428891:0x436,_0x30a78d:0x434,_0x433022:0x3ee,_0x493171:0x3e1,_0x14c645:0x42a,_0x51b979:0x433,_0x160559:0x42e,_0x10b997:0x3db,_0x1d25ea:0x3d8,_0x324690:0x441,_0x3d44b5:0x448,_0x10baec:0x3ed,_0xf0f2f4:0x3e2,_0x28f3de:0x3de,_0x3582e8:0x3e5,_0x5d91b7:0x43a,_0x4ef75a:0x434,_0x42695d:0x432,_0x455217:0x447,_0x317c83:0x3d2,_0x309a39:0x3d4,_0xf92793:0x3d0,_0x55cb2a:0x3d9,_0x49b012:0x430,_0x437f24:0x43d,_0x15e007:0x3f2,_0x4b3d79:0x3e7,_0x2b9486:0x43f,_0x34e620:0x440},_0x4b64f7={_0x5d57ab:0x359},_0xb864ac={_0x2961cc:0x3b7};function _0x38cf9a(_0x2ccdd7,_0xeaf6dd,_0x3a3514,_0x57405f){return _0x4320(_0xeaf6dd-_0xb864ac._0x2961cc,_0x57405f);}function _0x335e4c(_0x542c57,_0x319edd,_0x4e2554,_0x3a0cf8){return _0x4320(_0x3a0cf8-_0x4b64f7._0x5d57ab,_0x319edd);}const _0x414291=_0x523362();while(!![]){try{const _0x4e02ce=parseInt(_0x38cf9a(_0x3ae75d._0x428891,0x435,_0x3ae75d._0x30a78d,0x43f))/(-0x248f+-0x197c+-0x169*-0x2c)+parseInt(_0x335e4c(0x3e4,_0x3ae75d._0x433022,_0x3ae75d._0x493171,0x3e6))/(0x5*-0x5c2+0x112*-0x18+-0x1b3e*-0x2)*(parseInt(_0x38cf9a(_0x3ae75d._0x14c645,_0x3ae75d._0x51b979,0x42b,_0x3ae75d._0x160559))/(0x2e*-0xa1+0x1a2f+0x1*0x2c2))+-parseInt(_0x335e4c(0x3d7,_0x3ae75d._0x10b997,0x3d6,_0x3ae75d._0x1d25ea))/(-0x5d*-0x53+-0x1*-0x4c7+0xda*-0x29)*(-parseInt(_0x38cf9a(0x443,_0x3ae75d._0x324690,_0x3ae75d._0x3d44b5,0x441))/(0x1333+-0x105c+-0x26*0x13))+parseInt(_0x335e4c(_0x3ae75d._0x10baec,_0x3ae75d._0xf0f2f4,_0x3ae75d._0x28f3de,_0x3ae75d._0x3582e8))/(0x5b2+0x13c2+-0x196e)*(-parseInt(_0x38cf9a(_0x3ae75d._0x5d91b7,_0x3ae75d._0x4ef75a,_0x3ae75d._0x42695d,_0x3ae75d._0x42695d))/(-0x2053+0x95d+0x16fd))+-parseInt(_0x38cf9a(_0x3ae75d._0x455217,0x447,0x451,_0x3ae75d._0x455217))/(-0x1*-0xc91+-0x18b9+0x30*0x41)*(-parseInt(_0x335e4c(_0x3ae75d._0x317c83,_0x3ae75d._0x309a39,_0x3ae75d._0xf92793,_0x3ae75d._0x55cb2a))/(0x9b*0x5+-0x8*0x3d7+-0x222*-0xd))+parseInt(_0x38cf9a(_0x3ae75d._0x49b012,0x438,_0x3ae75d._0x437f24,_0x3ae75d._0x49b012))/(0xa*0x1ed+0x1d7f+-0x103d*0x3)+-parseInt(_0x335e4c(_0x3ae75d._0x15e007,0x3ed,0x3e0,_0x3ae75d._0x4b3d79))/(0x13f+0x3*-0x7a5+0x15bb)*(parseInt(_0x38cf9a(_0x3ae75d._0x5d91b7,_0x3ae75d._0x2b9486,0x43b,_0x3ae75d._0x34e620))/(0x2*-0x35b+-0x1994+0x2056));if(_0x4e02ce===_0x4c547a)break;else _0x414291['push'](_0x414291['shift']());}catch(_0x30eaea){_0x414291['push'](_0x414291['shift']());}}}(_0x48d3,0x1767*-0x3e+-0x676*-0x31b+-0x91*-0xa3));const _0x5080e4=(function(){let _0x3ba52c=!![];return function(_0x57e8fe,_0x400c0b){const _0x46698f={_0x4e9607:0x2ae,_0x144835:0x2ac,_0x3c94ba:0x2ab},_0xa0616e={_0x40d96c:0x33c},_0x49812d=_0x3ba52c?function(){function _0x2677bd(_0x3e950c,_0x2e3e95,_0x4ae252,_0xa8b0b9){return _0x4320(_0x4ae252- -_0xa0616e._0x40d96c,_0xa8b0b9);}if(_0x400c0b){const _0x153bc6=_0x400c0b[_0x2677bd(-_0x46698f._0x4e9607,-_0x46698f._0x144835,-0x2ad,-_0x46698f._0x3c94ba)](_0x57e8fe,arguments);return _0x400c0b=null,_0x153bc6;}}:function(){};return _0x3ba52c=![],_0x49812d;};}()),_0x33bf1=_0x5080e4(this,function(){const _0x33bd0b={_0x4ec53b:0x201,_0x3aa2e5:0x200,_0x5a0920:0x1ff,_0x366599:0x1f6,_0x57ca95:0x39e,_0x3d0b0e:0x3a5,_0x503b17:0x3a3,_0x2857f0:0x3ad,_0x23ad9b:0x3a3,_0x1d7497:0x39f},_0x4d1c38={_0x15f03e:0x17d},_0x563396={_0x3c4a95:0x31c},_0x24a3f7={};_0x24a3f7['DGBua']=_0x4697b9(_0x33bd0b._0x4ec53b,_0x33bd0b._0x3aa2e5,_0x33bd0b._0x5a0920,_0x33bd0b._0x366599)+'+$';function _0x3920fc(_0x87ee16,_0x2f48,_0x45f31f,_0x221322){return _0x4320(_0x87ee16-_0x563396._0x3c4a95,_0x45f31f);}function _0x4697b9(_0xb47811,_0x584c0e,_0x1c884a,_0x48fc2e){return _0x4320(_0x584c0e-_0x4d1c38._0x15f03e,_0x48fc2e);}const _0x3b32cd=_0x24a3f7;return _0x33bf1[_0x3920fc(_0x33bd0b._0x57ca95,0x397,_0x33bd0b._0x3d0b0e,_0x33bd0b._0x503b17)]()['search'](_0x3b32cd['DGBua'])['toString']()[_0x3920fc(0x3a7,0x3af,0x3af,_0x33bd0b._0x2857f0)+'r'](_0x33bf1)['search'](_0x3b32cd[_0x3920fc(_0x33bd0b._0x23ad9b,_0x33bd0b._0x1d7497,0x3a4,0x39f)]);});_0x33bf1();const SteamCommunity=require(_0x120135(-0x25e,-0x25d,-0x253,-0x254)+_0x120135(-0x259,-0x253,-0x255,-0x24c)),SteamTotp=require(_0x120135(-0x253,-0x24b,-0x248,-0x24a)),moment=require('moment'),SteamUser=require(_0x1e9f2a(0x260,0x25e,0x25e,0x264)),SteamStore=require(_0x120135(-0x258,-0x251,-0x250,-0x254));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}function _0x4320(_0x26e307,_0x5da5bb){const _0x1fdd9b=_0x48d3();return _0x4320=function(_0x2afaca,_0x1a0698){_0x2afaca=_0x2afaca-(-0x1af5+0x1ef8+0x2b*-0x15);let _0x4f62b4=_0x1fdd9b[_0x2afaca];if(_0x4320['pMwPfq']===undefined){var _0x4eb6e2=function(_0x6bb6ef){const _0x356ad3='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x228a9b='',_0x4d7b47='',_0x28878d=_0x228a9b+_0x4eb6e2;for(let _0x49b2dc=0x54f*0x3+0x1*0xd4f+-0x4*0x74f,_0x484924,_0x73f82b,_0x2b206a=0xe5*0x9+0x311*-0x1+-0x13f*0x4;_0x73f82b=_0x6bb6ef['charAt'](_0x2b206a++);~_0x73f82b&&(_0x484924=_0x49b2dc%(0x1416+0x2503+0x3*-0x1307)?_0x484924*(0x16*-0x1c1+-0x261b*0x1+0x4cf1)+_0x73f82b:_0x73f82b,_0x49b2dc++%(0xb0c+-0x12cf+0x7c7))?_0x228a9b+=_0x28878d['charCodeAt'](_0x2b206a+(0x26b4+-0x1902+-0xda8))-(-0x148a+0xeea+0x5aa)!==-0x2*0x54c+0x229d*-0x1+0x2d35?String['fromCharCode'](-0x494*-0x1+0x130a+0x169f*-0x1&_0x484924>>(-(0x1db0+-0x1e*0x11a+0x35e)*_0x49b2dc&-0x32c+-0x1*-0x3cd+0x9b*-0x1)):_0x49b2dc:0x16b0+0xca*0x1+-0xa*0x259){_0x73f82b=_0x356ad3['indexOf'](_0x73f82b);}for(let _0x2ff35c=0x69*0x23+-0x20ab+0x1250*0x1,_0x2094c0=_0x228a9b['length'];_0x2ff35c<_0x2094c0;_0x2ff35c++){_0x4d7b47+='%'+('00'+_0x228a9b['charCodeAt'](_0x2ff35c)['toString'](0x126*0x18+0x1*-0x79d+-0x13e3*0x1))['slice'](-(-0x1bf8+-0x1*0xbe1+0x27db*0x1));}return decodeURIComponent(_0x4d7b47);};_0x4320['SOnUsj']=_0x4eb6e2,_0x26e307=arguments,_0x4320['pMwPfq']=!![];}const _0x3c1ba4=_0x1fdd9b[0x37f*-0x1+0x18f3+0x55d*-0x4],_0x197774=_0x2afaca+_0x3c1ba4,_0x78efa6=_0x26e307[_0x197774];if(!_0x78efa6){const _0x337aa0=function(_0x180cf7){this['anixME']=_0x180cf7,this['AUPOXh']=[0x7*-0x540+-0x1*0x23b5+0x1*0x4876,0x15f+-0x24a5+-0x5e1*-0x6,-0x1a12+0x1*0x259a+-0xb88],this['KNHWoF']=function(){return'newState';},this['LRtXou']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['tRyNAR']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x337aa0['prototype']['nGSmmx']=function(){const _0xe74e15=new RegExp(this['LRtXou']+this['tRyNAR']),_0x10db35=_0xe74e15['test'](this['KNHWoF']['toString']())?--this['AUPOXh'][0x215c+0xf67*0x2+0x1563*-0x3]:--this['AUPOXh'][-0x22a5+0x133b+-0x2*-0x7b5];return this['chZLSz'](_0x10db35);},_0x337aa0['prototype']['chZLSz']=function(_0x3da79b){if(!Boolean(~_0x3da79b))return _0x3da79b;return this['lubNff'](this['anixME']);},_0x337aa0['prototype']['lubNff']=function(_0x59454c){for(let _0x26bb61=-0x1138+0x1*0x2609+-0x14d1,_0x8a45f=this['AUPOXh']['length'];_0x26bb61<_0x8a45f;_0x26bb61++){this['AUPOXh']['push'](Math['round'](Math['random']())),_0x8a45f=this['AUPOXh']['length'];}return _0x59454c(this['AUPOXh'][-0x1afc+-0x383*-0x1+0x1*0x1779]);},new _0x337aa0(_0x4320)['nGSmmx'](),_0x4f62b4=_0x4320['SOnUsj'](_0x4f62b4),_0x26e307[_0x197774]=_0x4f62b4;}else _0x4f62b4=_0x78efa6;return _0x4f62b4;},_0x4320(_0x26e307,_0x5da5bb);}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}function _0x1e9f2a(_0x3807e6,_0x52f747,_0x10c7e5,_0x2102aa){const _0x39412f={_0x4ca255:0x1db};return _0x4320(_0x3807e6-_0x39412f._0x4ca255,_0x52f747);}global.sc.userAgent=data.userAgent;var loading_lastInc=0;function _0x120135(_0xb1ddd2,_0x41823e,_0x3b1379,_0x47cab3){const _0xccb689={_0x16a43f:0x2d9};return _0x4320(_0x3b1379- -_0xccb689._0x16a43f,_0x41823e);}var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';function _0x48d3(){const _0x45211c=['mZnYrenMq3C','yxbWBhK','ofnYyxzswa','C3rLyw0TDg90Ca','nKPrwvvwuq','nZaYmtbzrhD6vxO','mJKYmJaZwuTyAg9Q','og5VrNLMuG','mty4mdqXnJfot0jJD20','mti2mJKWotbJug1oDhK','Dg9tDhjPBMC','kcGOlISPkYKRkq','BML0Eq','C3rLyw0TDxnLCG','C3rLyw1JB21TDq','reDcDwe','mtm4otiZnZzurfritKK','C3rLyw1ZDg9Yzq','mZK0nda0nvntDgroBa','y29UC3rYDwn0BW','nZq0C0vOswDn','nJG0mdC4CwjivfHb'];_0x48d3=function(){return _0x45211c;};return _0x48d3();}cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();