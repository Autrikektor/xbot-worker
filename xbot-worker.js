(function(_0x38f166,_0x4e1402){const _0x52d573={_0x1256d5:0x122,_0x4b116e:0x116,_0x1b20fd:0x110,_0x3cff60:0x112,_0x1a6f0b:0x10f,_0x214a4d:0x118,_0x288e67:0x10d,_0x31a2b5:0x34c,_0x5aecfa:0x34d,_0x5bbbc8:0x356,_0x506302:0x358,_0x2d5892:0x363,_0x37b14e:0x359,_0x2da91d:0x35d,_0x5995d3:0x35c,_0x5329b3:0x35a,_0xaf05c6:0x352,_0x5a79af:0x353,_0x1ad44e:0x357,_0x44b745:0x360,_0xfc8e64:0x34b,_0x109ba2:0x342,_0x55b314:0x355,_0x5716bd:0x351,_0x2497c8:0x353},_0x5931e6={_0x1ef6c6:0x2e8},_0x7b6303={_0x341c34:0x18e};function _0xca4517(_0x1a1c78,_0x403bf7,_0xc40fc1,_0xaf0aa8){return _0x35ff(_0xc40fc1- -_0x7b6303._0x341c34,_0x1a1c78);}const _0x22fc2d=_0x38f166();function _0x34fcb8(_0x2f14fd,_0x9ad9ce,_0x21a9b3,_0x2ed2bf){return _0x35ff(_0x21a9b3-_0x5931e6._0x1ef6c6,_0x2f14fd);}while(!![]){try{const _0x2f127a=-parseInt(_0xca4517(-_0x52d573._0x1256d5,-_0x52d573._0x4b116e,-0x117,-_0x52d573._0x1b20fd))/(-0x1b3e+0x6b4+-0x1*-0x148b)*(-parseInt(_0xca4517(-_0x52d573._0x3cff60,-_0x52d573._0x1a6f0b,-_0x52d573._0x214a4d,-_0x52d573._0x288e67))/(-0xd1c+-0x256c+-0x1945*-0x2))+-parseInt(_0x34fcb8(_0x52d573._0x31a2b5,_0x52d573._0x5aecfa,_0x52d573._0x5bbbc8,0x34d))/(-0x4ae+-0xc39+0x10ea)+parseInt(_0x34fcb8(_0x52d573._0x506302,_0x52d573._0x2d5892,_0x52d573._0x37b14e,0x363))/(0x1e0c+-0x1ab7+-0x351)+-parseInt(_0x34fcb8(_0x52d573._0x2da91d,_0x52d573._0x5995d3,0x35b,_0x52d573._0x5329b3))/(0x13d1+0x23a+-0x1606)+-parseInt(_0x34fcb8(0x34e,0x357,_0x52d573._0xaf05c6,_0x52d573._0x5a79af))/(0x1494+0x27*0x2+-0x14dc)*(parseInt(_0x34fcb8(_0x52d573._0x1ad44e,0x355,_0x52d573._0x44b745,_0x52d573._0x506302))/(0x1c3*0xd+-0x17ed+0x1*0x10d))+-parseInt(_0x34fcb8(_0x52d573._0xfc8e64,_0x52d573._0x109ba2,_0x52d573._0x5aecfa,_0x52d573._0x55b314))/(-0x1*0xa81+-0x1ab4+0x253d)+parseInt(_0x34fcb8(_0x52d573._0x37b14e,0x35a,_0x52d573._0x5716bd,_0x52d573._0x2497c8))/(0x20*-0xc5+0xbe4+0xcc5);if(_0x2f127a===_0x4e1402)break;else _0x22fc2d['push'](_0x22fc2d['shift']());}catch(_0x3e2057){_0x22fc2d['push'](_0x22fc2d['shift']());}}}(_0x5d6e,-0x4*0x3d114+-0x1339da+0x2ef353*0x1));const _0x29d008=(function(){const _0x59908b={_0x46f4e0:0x233,_0x31b0f3:0x231,_0x5d2e68:0x232,_0x55560e:0x9d,_0x1d1501:0xaa,_0x6885f6:0xa6};let _0x7dcf2=!![];return function(_0x279ebc,_0x5d86d9){const _0x23fed5={_0x4ad48c:0x358,_0x398d43:0x35f,_0x317b79:0x356,_0x4dd329:0x2da,_0x16d156:0x2db,_0x3bbbea:0x2db,_0x3e845d:0x2df,_0x22eaa9:0x2dc},_0x3daa97={_0x50142d:0x2a,_0x51dc49:0x1af},_0x442b07={};_0x442b07[_0x278a5f(_0x59908b._0x46f4e0,_0x59908b._0x31b0f3,_0x59908b._0x46f4e0,_0x59908b._0x5d2e68)]=_0x503ca6(_0x59908b._0x55560e,_0x59908b._0x1d1501,_0x59908b._0x6885f6,0x9f);function _0x503ca6(_0x271d5b,_0x32d060,_0x3fe1a3,_0x460681){return _0x35ff(_0x460681-0x3b,_0x271d5b);}const _0x3f587b=_0x442b07,_0x4ace62=_0x7dcf2?function(){const _0x19d5b4={_0x5c09dc:0xc5,_0x49a886:0x400};function _0x567956(_0x2636db,_0x4db85a,_0x107ce9,_0x287ff4){return _0x503ca6(_0x107ce9,_0x4db85a-0x3,_0x107ce9-_0x19d5b4._0x5c09dc,_0x4db85a- -_0x19d5b4._0x49a886);}function _0x51b303(_0x632044,_0x1eb710,_0x128750,_0x40aa2f){return _0x278a5f(_0x40aa2f-0xa8,_0x1eb710-_0x3daa97._0x50142d,_0x128750-_0x3daa97._0x51dc49,_0x1eb710);}if(_0x567956(-0x35f,-_0x23fed5._0x4ad48c,-_0x23fed5._0x398d43,-_0x23fed5._0x317b79)===_0x3f587b[_0x51b303(_0x23fed5._0x4dd329,0x2d7,0x2e7,_0x23fed5._0x16d156)]){if(_0x367889)_0x4a81c8.log(_0x23b0bd);}else{if(_0x5d86d9){const _0x50ec22=_0x5d86d9[_0x51b303(_0x23fed5._0x3bbbea,_0x23fed5._0x3e845d,0x2e5,_0x23fed5._0x22eaa9)](_0x279ebc,arguments);return _0x5d86d9=null,_0x50ec22;}}}:function(){};function _0x278a5f(_0x49ed81,_0x4201a7,_0x528d9d,_0x4c2587){return _0x35ff(_0x49ed81-0x1cc,_0x4c2587);}return _0x7dcf2=![],_0x4ace62;};}()),_0x132d79=_0x29d008(this,function(){const _0x3b15d9={_0x5ab743:0x59,_0x141ad7:0x5d,_0x1f115c:0x58,_0x1ced61:0x18b,_0x4d315f:0x180,_0x5bfd15:0x183,_0x5cd720:0x189,_0xf028b9:0x195,_0x36c9d6:0x18f,_0x444a07:0x181,_0x57ab0d:0x194,_0x4712d6:0x18d,_0x2b9278:0x182,_0x550afd:0x57,_0x3abaff:0x54,_0x1428c9:0x4b,_0x39d8f3:0x190,_0xba765b:0x197,_0x41f2ef:0x185,_0x5398a2:0x19a},_0x44795c={_0x184644:0x202},_0x5fc991={_0x55bf6e:0x21},_0x26d775={};function _0x2ea1e9(_0x1d043b,_0x43b2bf,_0x5a96a7,_0x3d34f9){return _0x35ff(_0x5a96a7- -_0x5fc991._0x55bf6e,_0x43b2bf);}_0x26d775[_0x2ea1e9(_0x3b15d9._0x5ab743,_0x3b15d9._0x141ad7,_0x3b15d9._0x1f115c,0x56)]='(((.+)+)+)'+'+$';const _0x3e3118=_0x26d775;function _0x43eecb(_0x32b299,_0x4f06d3,_0x215d10,_0x4f9533){return _0x35ff(_0x32b299- -_0x44795c._0x184644,_0x215d10);}return _0x132d79[_0x43eecb(-0x188,-_0x3b15d9._0x1ced61,-_0x3b15d9._0x4d315f,-_0x3b15d9._0x5bfd15)]()['search'](_0x3e3118[_0x43eecb(-_0x3b15d9._0x5cd720,-_0x3b15d9._0xf028b9,-_0x3b15d9._0x36c9d6,-0x183)])[_0x43eecb(-0x188,-0x182,-_0x3b15d9._0x444a07,-_0x3b15d9._0x57ab0d)]()[_0x43eecb(-_0x3b15d9._0x4712d6,-0x190,-0x181,-_0x3b15d9._0x2b9278)+'r'](_0x132d79)[_0x2ea1e9(_0x3b15d9._0x550afd,_0x3b15d9._0x3abaff,_0x3b15d9._0x1428c9,0x4b)](_0x43eecb(-_0x3b15d9._0x39d8f3,-_0x3b15d9._0xba765b,-_0x3b15d9._0x41f2ef,-_0x3b15d9._0x5398a2)+'+$');});_0x132d79();const SteamCommunity=require(_0x3f4878(-0x2cb,-0x2c5,-0x2c7,-0x2bf)+'nity'),SteamTotp=require(_0x408f58(-0x266,-0x26d,-0x25e,-0x261)),moment=require(_0x3f4878(-0x2ba,-0x2b7,-0x2c2,-0x2c9)),SteamUser=require(_0x3f4878(-0x2c3,-0x2bf,-0x2bd,-0x2be)),SteamStore=require(_0x408f58(-0x26c,-0x26e,-0x267,-0x266));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};function _0x5d6e(){const _0x2e8171=['mtC0r3bSA2rO','Bw9Tzw50','C2vHCMnO','qNLzthm','oty4nZm2qMrMEufm','C3rLyw1ZDg9Yzq','C3rLyw0TDxnLCG','mZmWmZC2mg5HBxjJBa','kcGOlISPkYKRkq','ndmXnZCZnxLPuM52rq','C3rLyw0TDg90Ca','y29UC3rYDwn0BW','mKvLDLzbBW','mZKZmtm5zwnLz1zR','mJa2mZe4AhbozeTU','C2nSDhy','Dg9tDhjPBMC','yMP3A3i','ntmYoty1nNHbr2HbDW','C3rLyw1JB21TDq','BMjQvhK','yxbWBhK','mJa3ndi4mJjluxPKre8'];_0x5d6e=function(){return _0x2e8171;};return _0x5d6e();}console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}function _0x3f4878(_0xf1e83b,_0x457af7,_0x364e38,_0x39a331){const _0x4d543a={_0x5e3320:0x32d};return _0x35ff(_0x364e38- -_0x4d543a._0x5e3320,_0x457af7);}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};console.log(global.data.version);if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;function _0x408f58(_0x5877af,_0x447cb2,_0x53a49f,_0x514b53){const _0x435959={_0x17f57a:0x2d5};return _0x35ff(_0x514b53- -_0x435959._0x17f57a,_0x53a49f);}var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}function _0x35ff(_0x4a81da,_0x4b0638){const _0x5d2944=_0x5d6e();return _0x35ff=function(_0x491636,_0x44a40f){_0x491636=_0x491636-(-0x99*0x13+0x1208+0x1*-0x649);let _0x5efbda=_0x5d2944[_0x491636];if(_0x35ff['ypjzPS']===undefined){var _0x564b1f=function(_0x5c723f){const _0x247e1f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x978cc5='',_0x448ded='',_0x3010a3=_0x978cc5+_0x564b1f;for(let _0x4a7dd0=-0x92*-0x15+-0x1f*0x3d+0xeb*-0x5,_0x2cc85f,_0x4ceeba,_0x43a7cb=0x262*0xb+-0x684+-0x13b2*0x1;_0x4ceeba=_0x5c723f['charAt'](_0x43a7cb++);~_0x4ceeba&&(_0x2cc85f=_0x4a7dd0%(0x5e2*0x6+-0x1ce6+-0x662)?_0x2cc85f*(0x1bdb+0x1c34+-0x1*0x37cf)+_0x4ceeba:_0x4ceeba,_0x4a7dd0++%(-0x258a+-0x7*0x553+-0x4fd*-0xf))?_0x978cc5+=_0x3010a3['charCodeAt'](_0x43a7cb+(0xd18+-0x2355+0x1647))-(0x871+0x1*-0x21c7+-0xe8*-0x1c)!==-0x1*-0x203d+-0x1c4*0x10+-0x3fd*0x1?String['fromCharCode'](0x2*-0x1009+-0xb03+0x2c14&_0x2cc85f>>(-(0x11*-0x21+0x179b*-0x1+0x6*0x44d)*_0x4a7dd0&0xe92+0x14e9+0x2375*-0x1)):_0x4a7dd0:0x3*-0xc0f+0x4*0x132+0x1f65){_0x4ceeba=_0x247e1f['indexOf'](_0x4ceeba);}for(let _0xa1e62e=0x221+0x4f+0xd0*-0x3,_0x381972=_0x978cc5['length'];_0xa1e62e<_0x381972;_0xa1e62e++){_0x448ded+='%'+('00'+_0x978cc5['charCodeAt'](_0xa1e62e)['toString'](-0x13*-0xdd+0x4e7*-0x3+-0xb*0x26))['slice'](-(-0x5*-0x3a4+0x1d*-0xf1+0x91b));}return decodeURIComponent(_0x448ded);};_0x35ff['zQLxOA']=_0x564b1f,_0x4a81da=arguments,_0x35ff['ypjzPS']=!![];}const _0x53d53e=_0x5d2944[0x1fa9+-0x1218+-0xd91],_0x2b7fbc=_0x491636+_0x53d53e,_0x1ed5d5=_0x4a81da[_0x2b7fbc];if(!_0x1ed5d5){const _0xbb7a29=function(_0x20a100){this['PQUaux']=_0x20a100,this['IfJJke']=[0x1*0x1e6b+-0x2fc*-0x7+-0x334e,-0xbf7+0xfe*0x20+-0x13c9,0x1*0xda2+0x12b8+-0x205a],this['cPwPQS']=function(){return'newState';},this['XutLry']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['GuJqWd']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0xbb7a29['prototype']['YkRmfB']=function(){const _0x367889=new RegExp(this['XutLry']+this['GuJqWd']),_0x4a81c8=_0x367889['test'](this['cPwPQS']['toString']())?--this['IfJJke'][-0x6+0xb43*-0x1+0xb4a]:--this['IfJJke'][-0x1ffb+0xd*0xa0+0x17db];return this['GNHHnn'](_0x4a81c8);},_0xbb7a29['prototype']['GNHHnn']=function(_0x23b0bd){if(!Boolean(~_0x23b0bd))return _0x23b0bd;return this['IlGJHi'](this['PQUaux']);},_0xbb7a29['prototype']['IlGJHi']=function(_0x5e1237){for(let _0x3fd75c=0x673*-0x6+-0x8b*0x3a+0x4630,_0x3c6e35=this['IfJJke']['length'];_0x3fd75c<_0x3c6e35;_0x3fd75c++){this['IfJJke']['push'](Math['round'](Math['random']())),_0x3c6e35=this['IfJJke']['length'];}return _0x5e1237(this['IfJJke'][0x212a+-0x9*0x1+-0x2121]);},new _0xbb7a29(_0x35ff)['YkRmfB'](),_0x5efbda=_0x35ff['zQLxOA'](_0x5efbda),_0x4a81da[_0x2b7fbc]=_0x5efbda;}else _0x5efbda=_0x1ed5d5;return _0x5efbda;},_0x35ff(_0x4a81da,_0x4b0638);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();