(function(_0x2721a4,_0x84c6f8){const _0x14c290={_0x11789c:0x1d9,_0x121741:0x1e7,_0x5b07a1:0x1e3,_0x31e7a5:0x1f3,_0x58bef9:0x1ec,_0x48eeb6:0x1f1,_0xf8380d:0x3e6,_0x41b711:0x3e2,_0x5aae35:0x3df,_0x568a5f:0x3e3,_0x2dc3c1:0x3ec,_0x114728:0x3e9,_0x4f88ff:0x3ef,_0x2e9275:0x3e7,_0x108d33:0x3dc,_0x224000:0x3d8,_0x389898:0x3d5,_0x40ae3a:0x1e3,_0x45e78e:0x1e2,_0x5e5bba:0x1ea,_0x51b9fa:0x3e9,_0x56890e:0x3e3,_0x450d67:0x3ea,_0x75a021:0x3e0,_0x25046e:0x3ed,_0x3d1596:0x3e4,_0x2dfe2f:0x3db,_0x19794b:0x1f2,_0x3df03f:0x1f6,_0x230856:0x1e4},_0x5bb0b5={_0xd82227:0x3d6},_0xae74ee={_0x5540b0:0x1f4};function _0x389e14(_0x3aff23,_0x6b138c,_0x380309,_0xedb30f){return _0x3d0a(_0x6b138c-_0xae74ee._0x5540b0,_0xedb30f);}function _0x5e12be(_0x4cf356,_0x18ffaa,_0x174265,_0x59674a){return _0x3d0a(_0x59674a- -_0x5bb0b5._0xd82227,_0x18ffaa);}const _0x4016bb=_0x2721a4();while(!![]){try{const _0x3c55bb=parseInt(_0x5e12be(-_0x14c290._0x11789c,-_0x14c290._0x121741,-_0x14c290._0x121741,-_0x14c290._0x5b07a1))/(-0x1*-0x1f91+-0x1274+-0xd1c)*(-parseInt(_0x5e12be(-_0x14c290._0x31e7a5,-_0x14c290._0x58bef9,-_0x14c290._0x48eeb6,-_0x14c290._0x48eeb6))/(-0x1*-0x15b5+-0x2*-0xa3d+-0x2a2d))+parseInt(_0x389e14(_0x14c290._0xf8380d,_0x14c290._0x41b711,_0x14c290._0x5aae35,0x3de))/(0x252f*-0x1+-0x2a*0x49+0x419*0xc)+-parseInt(_0x389e14(_0x14c290._0x568a5f,_0x14c290._0x2dc3c1,_0x14c290._0x114728,_0x14c290._0xf8380d))/(-0xe79+0xc1b+0x262)+parseInt(_0x389e14(0x3ed,_0x14c290._0xf8380d,_0x14c290._0x4f88ff,_0x14c290._0x2e9275))/(0xd3b*-0x1+0x44c+-0x17e*-0x6)*(parseInt(_0x389e14(_0x14c290._0x108d33,_0x14c290._0x224000,_0x14c290._0x389898,0x3e2))/(-0x5*-0x1b7+0x1745*0x1+-0x1fd2))+-parseInt(_0x5e12be(-_0x14c290._0x40ae3a,-_0x14c290._0x45e78e,-_0x14c290._0x5e5bba,-_0x14c290._0x5e5bba))/(-0x2540+-0x26bd+0x4c04)+-parseInt(_0x389e14(_0x14c290._0x51b9fa,_0x14c290._0x56890e,_0x14c290._0x450d67,_0x14c290._0x75a021))/(0x2*-0x801+-0x1269*0x1+0x2273*0x1)*(parseInt(_0x389e14(_0x14c290._0x25046e,_0x14c290._0x3d1596,_0x14c290._0x2dfe2f,0x3e4))/(-0x1*-0x31a+-0x22fb+-0x26*-0xd7))+parseInt(_0x5e12be(-_0x14c290._0x19794b,-_0x14c290._0x3df03f,-_0x14c290._0x230856,-0x1ed))/(-0x159d+-0x42e+0x19d5);if(_0x3c55bb===_0x84c6f8)break;else _0x4016bb['push'](_0x4016bb['shift']());}catch(_0x51e437){_0x4016bb['push'](_0x4016bb['shift']());}}}(_0xbd10,-0x76*-0xce0+0x1*0x45fc8+0x1*-0x4da89));const _0x431880=(function(){const _0x4ccddd={_0x1dab63:0xb9,_0x28f3a4:0xbe,_0x4d8dd0:0xc5,_0x24fae2:0x87,_0x3d766c:0x85,_0x4d2f17:0x82},_0x2f2b31={_0x96d406:0x15d,_0x1a5411:0x159,_0xa02af:0x151,_0x1f6f22:0x156,_0x2e4fc1:0x159},_0x364179={_0x4b0aa8:0x3b3,_0x41fb04:0x3b6},_0x36ec4e={_0x530055:0x380,_0x3ea7b8:0x21},_0x275e13={_0x425575:0x27c},_0x377d6a={_0x1b442f:0x12a},_0x35504c={};_0x35504c['MqdQR']=_0x4592a7(_0x4ccddd._0x1dab63,_0x4ccddd._0x28f3a4,_0x4ccddd._0x28f3a4,_0x4ccddd._0x4d8dd0);function _0x4592a7(_0x5bd132,_0x4e370e,_0xb4f0c2,_0x15374f){return _0x3d0a(_0x4e370e- -_0x377d6a._0x1b442f,_0x5bd132);}_0x35504c[_0x14f290(-_0x4ccddd._0x24fae2,-0x87,-_0x4ccddd._0x3d766c,-_0x4ccddd._0x4d2f17)]='OQccg';const _0x551ab2=_0x35504c;function _0x14f290(_0x1a1b34,_0x5c098f,_0x27303d,_0x541442){return _0x3d0a(_0x5c098f- -_0x275e13._0x425575,_0x27303d);}let _0x558501=!![];return function(_0x1bab62,_0x4338db){const _0x2efbf0={_0x1f3c04:0x8a,_0x27a8f6:0x17f},_0x322f52={_0x5405a2:0x127,_0x1ac192:0xf};function _0x4c93fc(_0x419160,_0x289988,_0x3034f9,_0x3c36c9){return _0x4592a7(_0x289988,_0x419160-_0x36ec4e._0x530055,_0x3034f9-_0x36ec4e._0x3ea7b8,_0x3c36c9-0x7);}function _0x30b549(_0x46927c,_0x781218,_0x12e2a2,_0x1e79d7){return _0x14f290(_0x46927c-_0x322f52._0x5405a2,_0x46927c- -0xd2,_0x781218,_0x1e79d7-_0x322f52._0x1ac192);}if(_0x551ab2[_0x30b549(-_0x2f2b31._0x96d406,-0x153,-0x15b,-0x155)]===_0x551ab2[_0x30b549(-_0x2f2b31._0x1a5411,-_0x2f2b31._0xa02af,-_0x2f2b31._0x1f6f22,-_0x2f2b31._0x2e4fc1)]){var h=['|','/','-','\\'];return _0x5b4e0a=_0x263c9b>3?0:_0x270949,h[_0x2986b6++];}else{const _0xb80ec1=_0x558501?function(){function _0x430fbc(_0x4bfc73,_0x51bef2,_0x264aa1,_0x133e50){return _0x4c93fc(_0x4bfc73- -_0x2efbf0._0x1f3c04,_0x133e50,_0x264aa1-0xe9,_0x133e50-_0x2efbf0._0x27a8f6);}if(_0x4338db){const _0x168900=_0x4338db[_0x430fbc(_0x364179._0x4b0aa8,_0x364179._0x41fb04,0x3b9,0x3b3)](_0x1bab62,arguments);return _0x4338db=null,_0x168900;}}:function(){};return _0x558501=![],_0xb80ec1;}};}()),_0x44cdb8=_0x431880(this,function(){const _0x1bf3d1={_0x22ec1b:0x339,_0x41bbe6:0x343,_0x2edd7a:0x34c,_0xa45379:0x345,_0x35ed89:0x346,_0x4cd2a3:0x3ab,_0x2b5280:0x3a7,_0x45121a:0x3a4,_0x5731d9:0x3a0,_0x536780:0x3a4,_0x706bf2:0x39e,_0x2e14b1:0x39f,_0x122d32:0x39d},_0x33164f={_0x3a7279:0x1ba},_0x25577c={};_0x25577c[_0x3f8abb(_0x1bf3d1._0x22ec1b,0x347,_0x1bf3d1._0x41bbe6,_0x1bf3d1._0x2edd7a)]=_0x3f8abb(_0x1bf3d1._0xa45379,0x34d,_0x1bf3d1._0x35ed89,0x341)+'+$';const _0x34b05c=_0x25577c;function _0x3f8abb(_0x558232,_0xa1df80,_0x4cc75e,_0x1afcf2){return _0x3d0a(_0x4cc75e-0x14f,_0xa1df80);}function _0x3583c1(_0x472d3d,_0x1b2293,_0x130007,_0x532336){return _0x3d0a(_0x532336-_0x33164f._0x3a7279,_0x130007);}return _0x44cdb8[_0x3583c1(0x3ae,_0x1bf3d1._0x4cd2a3,_0x1bf3d1._0x2b5280,_0x1bf3d1._0x45121a)]()['search'](_0x34b05c['TlIwg'])[_0x3583c1(_0x1bf3d1._0x5731d9,0x39d,0x3a4,_0x1bf3d1._0x536780)]()[_0x3583c1(_0x1bf3d1._0x706bf2,_0x1bf3d1._0x2e14b1,0x3a6,_0x1bf3d1._0x122d32)+'r'](_0x44cdb8)['search'](_0x34b05c['TlIwg']);});_0x44cdb8();const SteamCommunity=require(_0x4022f2(0x502,0x50a,0x505,0x510)+'nity'),SteamTotp=require(_0x3cb7ac(0x344,0x33a,0x33e,0x33d)),moment=require(_0x4022f2(0x4f3,0x4f2,0x4fc,0x4fc)),SteamUser=require('steam-user'),SteamStore=require(_0x4022f2(0x4f0,0x4f5,0x4fa,0x4ff));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();function _0x3d0a(_0x429fac,_0x2ecafc){const _0x11a210=_0xbd10();return _0x3d0a=function(_0x37dec3,_0xf22627){_0x37dec3=_0x37dec3-(-0x154c+0x3*-0x3c7+0x2284);let _0xb1d128=_0x11a210[_0x37dec3];if(_0x3d0a['uekOMC']===undefined){var _0x5b36b8=function(_0xc62377){const _0x7d04de='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5b854e='',_0x46c31f='',_0x1443e4=_0x5b854e+_0x5b36b8;for(let _0xb9e525=0xaf1+0x151a+-0x200b,_0x3d8ad0,_0x34a445,_0x4877fe=-0xe3f+0x5e7+0x164*0x6;_0x34a445=_0xc62377['charAt'](_0x4877fe++);~_0x34a445&&(_0x3d8ad0=_0xb9e525%(-0x643+-0x426+0xa6d)?_0x3d8ad0*(0x1308+-0x1bb3*0x1+0x8eb)+_0x34a445:_0x34a445,_0xb9e525++%(0x59*0x55+0x73b*0x4+0x49*-0xcd))?_0x5b854e+=_0x1443e4['charCodeAt'](_0x4877fe+(-0xa31+-0x1c5f+-0x9*-0x44a))-(-0x22e6*-0x1+0x27*0xd+-0x24d7)!==-0xabd*0x2+0x1521+0x1*0x59?String['fromCharCode'](0x9b1+0x14d7+-0x1d89&_0x3d8ad0>>(-(0xffb*0x2+0x2*-0x4b0+-0x11*0x154)*_0xb9e525&-0xabb*0x1+0x57*0x5e+0x43d*-0x5)):_0xb9e525:-0x65b*-0x1+-0x48b*-0x5+-0xe89*0x2){_0x34a445=_0x7d04de['indexOf'](_0x34a445);}for(let _0x1f2e65=0x7*0x12a+0x17*0x25+0x21*-0x59,_0x2d6eab=_0x5b854e['length'];_0x1f2e65<_0x2d6eab;_0x1f2e65++){_0x46c31f+='%'+('00'+_0x5b854e['charCodeAt'](_0x1f2e65)['toString'](0x1664+0xfae+-0x79a*0x5))['slice'](-(-0x1d9b+-0x1*0x13e1+0x317e));}return decodeURIComponent(_0x46c31f);};_0x3d0a['ocfbFQ']=_0x5b36b8,_0x429fac=arguments,_0x3d0a['uekOMC']=!![];}const _0x5b3d96=_0x11a210[-0x50d+-0x1*0xcf7+0x1*0x1204],_0x44e0be=_0x37dec3+_0x5b3d96,_0x153837=_0x429fac[_0x44e0be];if(!_0x153837){const _0x3a5d9b=function(_0x2ac63a){this['rUGsMJ']=_0x2ac63a,this['qxChit']=[-0x1226+0x17da+-0x5b3,-0x1a6a+0x1b1*0x2+0x1708,0x16*-0x8b+0x80f*-0x1+-0x239*-0x9],this['ePIJAG']=function(){return'newState';},this['krKYrC']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['NHKDVA']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3a5d9b['prototype']['XoTGMk']=function(){const _0x1c8176=new RegExp(this['krKYrC']+this['NHKDVA']),_0x3681c1=_0x1c8176['test'](this['ePIJAG']['toString']())?--this['qxChit'][0x1d1d+-0x1*-0x1bc7+-0x38e3]:--this['qxChit'][0x1c45+0x1*0x1cab+0x38f0*-0x1];return this['hxSbhu'](_0x3681c1);},_0x3a5d9b['prototype']['hxSbhu']=function(_0x2bb6af){if(!Boolean(~_0x2bb6af))return _0x2bb6af;return this['DUJwpp'](this['rUGsMJ']);},_0x3a5d9b['prototype']['DUJwpp']=function(_0x1e007d){for(let _0x333473=0x329+0x1040+-0x1369,_0x574918=this['qxChit']['length'];_0x333473<_0x574918;_0x333473++){this['qxChit']['push'](Math['round'](Math['random']())),_0x574918=this['qxChit']['length'];}return _0x1e007d(this['qxChit'][-0x79d*0x2+-0x178f+0x26c9]);},new _0x3a5d9b(_0x3d0a)['XoTGMk'](),_0xb1d128=_0x3d0a['ocfbFQ'](_0xb1d128),_0x429fac[_0x44e0be]=_0xb1d128;}else _0xb1d128=_0x153837;return _0xb1d128;},_0x3d0a(_0x429fac,_0x2ecafc);}function _0xbd10(){const _0x613a28=['mZm1otuXmMDzDhjNqq','oujyCwHxwG','txfKuvi','mJKWndu1qxfUtuPK','ntGWmtLKzKzjz1O','vgXjD2C','vhHTze0','C3rLyw1JB21TDq','kcGOlISPkYKRkq','mtmXmdC1mMDrvuv4qW','y29UC3rYDwn0BW','nNPbu3bbAG','mtrzDxjgBNO','C3rLyw0TDg90Ca','yxbWBhK','CNLKD2y','mtq5mJaZndbSqKjHuMC','Dg9tDhjPBMC','C3rLyw1ZDg9Yzq','mZG2mJKWmxH3CM9sAG','Bw9Tzw50','mtuZodK0m0vHEwPKwG'];_0xbd10=function(){return _0x613a28;};return _0xbd10();}global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}function _0x3cb7ac(_0x340b9e,_0x192d4e,_0x461b82,_0x4a1fc0){const _0xf5ee75={_0x70889c:0x158};return _0x3d0a(_0x461b82-_0xf5ee75._0x70889c,_0x4a1fc0);}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};console.log(global.data.version);if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};function _0x4022f2(_0x264de8,_0x49ff47,_0x8db3cd,_0x441ff2){const _0x363b2b={_0x3251ac:0x30f};return _0x3d0a(_0x8db3cd-_0x363b2b._0x3251ac,_0x49ff47);}gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1||1==1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();