(function(_0x37cf96,_0x3e5bf3){const _0x23017d={_0x5e1cf7:0x1d2,_0x1680f6:0x1db,_0x562ad8:0x1d2,_0x160e2c:0x424,_0x18b50a:0x41d,_0x3d6ace:0x41a,_0x4734a4:0x423,_0x546703:0x1e2,_0xe137ce:0x1e1,_0x15961e:0x40a,_0x543dcb:0x405,_0x1ee292:0x1ec,_0x4f402e:0x1e4,_0xbe6219:0x1ed,_0x5db4f8:0x402,_0x6393ad:0x40d,_0x3f2919:0x40e,_0x49dc95:0x1ed,_0x59e564:0x1e3,_0x400086:0x40f,_0x558540:0x412,_0x133a07:0x418,_0x990eb2:0x413,_0x24eafa:0x40b,_0x227542:0x1f1,_0x4fbd9a:0x1ea,_0x147819:0x1ec,_0x3892d5:0x1f7},_0x1636c6={_0x1dbe97:0x25d},_0x5eb9bd={_0x5a7821:0x399},_0x5e62cd=_0x37cf96();function _0x3b8be2(_0x4819f,_0x4bacc5,_0x4ed5e4,_0x3bfba1){return _0x260d(_0x4ed5e4- -_0x5eb9bd._0x5a7821,_0x3bfba1);}function _0x43edd7(_0x290c00,_0x181734,_0x2b0efe,_0x20c109){return _0x260d(_0x2b0efe-_0x1636c6._0x1dbe97,_0x20c109);}while(!![]){try{const _0x2621f1=-parseInt(_0x3b8be2(-_0x23017d._0x5e1cf7,-0x1d6,-_0x23017d._0x1680f6,-_0x23017d._0x562ad8))/(0x1088+-0x1a74+0x9ed)+parseInt(_0x43edd7(_0x23017d._0x160e2c,_0x23017d._0x18b50a,_0x23017d._0x3d6ace,_0x23017d._0x4734a4))/(-0x7*0x16c+-0x11f7+-0x3*-0x94f)+parseInt(_0x3b8be2(-0x1df,-_0x23017d._0x546703,-_0x23017d._0xe137ce,-0x1da))/(0x2113+-0x9*-0x3bb+-0x985*0x7)*(-parseInt(_0x43edd7(0x412,_0x23017d._0x15961e,0x40e,_0x23017d._0x543dcb))/(0x1eea+-0x9cd*0x2+-0xb4c))+parseInt(_0x3b8be2(-_0x23017d._0x1ee292,-_0x23017d._0x4f402e,-_0x23017d._0xbe6219,-0x1f0))/(-0x1e*0x13d+0x9de+0x1b4d)+parseInt(_0x43edd7(_0x23017d._0x5db4f8,0x40b,_0x23017d._0x6393ad,_0x23017d._0x3f2919))/(0x47a*-0x3+0x27e*0xb+-0xdf6)*(parseInt(_0x3b8be2(-_0x23017d._0x49dc95,-_0x23017d._0x1ee292,-0x1e2,-_0x23017d._0x59e564))/(-0x19e5+-0xe*0x25b+0x3ae6))+-parseInt(_0x43edd7(0x40b,_0x23017d._0x400086,_0x23017d._0x558540,_0x23017d._0x133a07))/(-0x2*-0x20d+-0x81a+-0x81*-0x8)+parseInt(_0x43edd7(_0x23017d._0x3f2919,0x40d,_0x23017d._0x990eb2,_0x23017d._0x24eafa))/(0x13*-0x1a5+0x213d+-0x1f5)*(-parseInt(_0x3b8be2(-_0x23017d._0x227542,-_0x23017d._0x4fbd9a,-_0x23017d._0x147819,-_0x23017d._0x3892d5))/(0x1ed8+-0x227+-0x1ca7));if(_0x2621f1===_0x3e5bf3)break;else _0x5e62cd['push'](_0x5e62cd['shift']());}catch(_0x81bdbe){_0x5e62cd['push'](_0x5e62cd['shift']());}}}(_0x4a70,0x110c24+0x15ddb9+0xccb*-0x1f7));const _0x29a1b5=(function(){const _0x21b140={_0x5e2be5:0x3bf,_0x11e0df:0x3c4,_0x10a1d6:0x3c5,_0x168802:0x3c1},_0x275cd3={_0x51aa2b:0x266},_0x14edbf={};function _0x300296(_0x4d2aca,_0x244e98,_0x4c97a0,_0x2cc053){return _0x260d(_0x244e98-0x216,_0x4d2aca);}_0x14edbf[_0x300296(_0x21b140._0x5e2be5,_0x21b140._0x11e0df,_0x21b140._0x10a1d6,_0x21b140._0x168802)]=function(_0x114a24,_0x4148ac){return _0x114a24!==_0x4148ac;};const _0x472d41=_0x14edbf;let _0x552f3f=!![];return function(_0x4fceb4,_0x25e90f){const _0x561888={_0x586977:0x238,_0x589342:0x244,_0x39ea33:0x242,_0x2144b0:0x243,_0x1db65a:0x22c,_0x5917b3:0x237,_0x336f26:0x239,_0x2b0cac:0x247,_0x16b0a8:0x244,_0x391845:0x23c,_0x3eca15:0x380,_0x3e68fd:0x37d,_0x3922ae:0x37d},_0x3916b3={_0x178837:0x152,_0x4aa9d5:0xc2},_0x58a7ec={_0x299a3f:0x1d0,_0x13ad29:0x24,_0x1cca4d:0x1a4},_0x559718={_0x23385d:0x16a,_0x18e160:0x7d,_0x211eaf:0x1ac},_0x523afd={_0x3dbf25:0x3c,_0x237874:0x47},_0x3cab7a={_0x449a58:0x1ea},_0x1a889c={'EbTBL':function(_0x414765,_0x1cb6bc){function _0x57a2f1(_0x496ee0,_0x47e6a0,_0x2290e2,_0x27afbc){return _0x260d(_0x496ee0- -_0x3cab7a._0x449a58,_0x47e6a0);}return _0x472d41[_0x57a2f1(-_0x523afd._0x3dbf25,-0x44,-_0x523afd._0x237874,-0x3a)](_0x414765,_0x1cb6bc);},'QOcCX':_0x47b7a8(0x271,0x268,_0x275cd3._0x51aa2b,0x265)};function _0x47b7a8(_0x4516d3,_0xfeb0ad,_0x1f80b8,_0x188444){return _0x300296(_0x188444,_0xfeb0ad- -_0x559718._0x23385d,_0x1f80b8-_0x559718._0x18e160,_0x188444-_0x559718._0x211eaf);}const _0x3f744d=_0x552f3f?function(){function _0x6396b2(_0x33090a,_0x498974,_0x113b2e,_0x5130c8){return _0x47b7a8(_0x33090a-_0x58a7ec._0x299a3f,_0x113b2e- -_0x58a7ec._0x13ad29,_0x113b2e-_0x58a7ec._0x1cca4d,_0x5130c8);}function _0x4cfbc3(_0x4acd18,_0x335ad6,_0x46dd7f,_0xc618a4){return _0x47b7a8(_0x4acd18-_0x3916b3._0x178837,_0x46dd7f-0x11d,_0x46dd7f-_0x3916b3._0x4aa9d5,_0x335ad6);}if(_0x25e90f){if(_0x1a889c[_0x6396b2(_0x561888._0x586977,_0x561888._0x589342,_0x561888._0x39ea33,_0x561888._0x2144b0)](_0x1a889c[_0x6396b2(0x22d,_0x561888._0x1db65a,_0x561888._0x5917b3,_0x561888._0x336f26)],_0x6396b2(_0x561888._0x2b0cac,_0x561888._0x16b0a8,0x244,_0x561888._0x391845)))_0xdaf4a.log('This login attempt has timed out.'),_0xeb9884(false);else{const _0x49da3b=_0x25e90f[_0x4cfbc3(_0x561888._0x3eca15,0x377,_0x561888._0x3e68fd,_0x561888._0x3922ae)](_0x4fceb4,arguments);return _0x25e90f=null,_0x49da3b;}}}:function(){};return _0x552f3f=![],_0x3f744d;};}()),_0x371673=_0x29a1b5(this,function(){const _0x338541={_0x523131:0x3c4,_0x5a5ca1:0x3c0,_0x1ce567:0x3c9,_0x42ce25:0x3cc,_0x3e53d6:0x3ce,_0x43f9b7:0x4e1,_0x1526e7:0x4ec,_0x2e476b:0x4dc,_0x2d3d1e:0x3c5,_0x477fbb:0x3b7,_0x1d938a:0x3b5,_0x5f2352:0x4e4};function _0xb22625(_0x52d6f4,_0x26f7e3,_0x3d2631,_0x398d6b){return _0x260d(_0x398d6b-0x20e,_0x52d6f4);}const _0x8ae1ba={};_0x8ae1ba['bDvPz']='(((.+)+)+)'+'+$';function _0x2fe2b3(_0x4a407a,_0x505118,_0x349f60,_0x59847e){return _0x260d(_0x59847e-0x326,_0x505118);}const _0x5876c7=_0x8ae1ba;return _0x371673['toString']()[_0xb22625(0x3c8,_0x338541._0x523131,0x3ba,_0x338541._0x5a5ca1)](_0x5876c7[_0xb22625(_0x338541._0x1ce567,_0x338541._0x42ce25,0x3d4,_0x338541._0x3e53d6)])[_0x2fe2b3(_0x338541._0x43f9b7,_0x338541._0x1526e7,_0x338541._0x2e476b,0x4e7)]()['constructo'+'r'](_0x371673)[_0xb22625(_0x338541._0x2d3d1e,_0x338541._0x477fbb,_0x338541._0x1d938a,0x3c0)](_0x5876c7[_0x2fe2b3(0x4e1,0x4db,_0x338541._0x5f2352,0x4e6)]);});_0x371673();const SteamCommunity=require('steamcommu'+'nity'),SteamTotp=require(_0x31bfdc(-0x155,-0x155,-0x15d,-0x15f)),moment=require(_0x31bfdc(-0x166,-0x15a,-0x161,-0x163)),SteamUser=require(_0x120bad(0x37f,0x37f,0x37d,0x374)),SteamStore=require(_0x31bfdc(-0x170,-0x16e,-0x16e,-0x16b));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');function _0x31bfdc(_0x2a3847,_0x3d9ea6,_0x1c8752,_0x53e3a9){const _0x548f82={_0x12d533:0x31e};return _0x260d(_0x53e3a9- -_0x548f82._0x12d533,_0x1c8752);}const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;function _0x120bad(_0x178799,_0x37a7dd,_0x4c2af8,_0x13415b){const _0x34fe1a={_0xbb46c2:0x1c6};return _0x260d(_0x178799-_0x34fe1a._0xbb46c2,_0x13415b);}global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}function _0x260d(_0x55421a,_0x65a895){const _0x32da7=_0x4a70();return _0x260d=function(_0x431ebe,_0x314d4c){_0x431ebe=_0x431ebe-(0x2*0x9e8+-0x53c+-0x7*0x1d8);let _0x3e6969=_0x32da7[_0x431ebe];if(_0x260d['kyunlN']===undefined){var _0xcabb3b=function(_0x4c03c1){const _0x467ca6='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x10b8d3='',_0x122edf='',_0x4086ac=_0x10b8d3+_0xcabb3b;for(let _0x177480=-0x4*0x472+0x1*-0x2204+0x52e*0xa,_0xb9d655,_0x2a7e09,_0x290572=-0x58c*0x7+-0x1*-0xce7+-0x1*-0x19ed;_0x2a7e09=_0x4c03c1['charAt'](_0x290572++);~_0x2a7e09&&(_0xb9d655=_0x177480%(0x1b37+-0xe52+-0x15*0x9d)?_0xb9d655*(-0xab8+0x746+0x3b2)+_0x2a7e09:_0x2a7e09,_0x177480++%(-0x26f2+-0x3d*-0x98+0x2be))?_0x10b8d3+=_0x4086ac['charCodeAt'](_0x290572+(-0x19f6+-0x5*-0xe5+-0xa7*-0x21))-(-0x573+-0x1fac+0x7*0x54f)!==-0x248d+0xd*-0x21c+0x3ff9?String['fromCharCode'](-0x27f+0x1821+0x3*-0x6e1&_0xb9d655>>(-(0x1*0x140e+0x1*-0x1e0b+0x3*0x355)*_0x177480&0xd6d+-0x14fd+0x1*0x796)):_0x177480:0x13*0x1e5+0xbd9+-0x2fd8*0x1){_0x2a7e09=_0x467ca6['indexOf'](_0x2a7e09);}for(let _0x3f8661=-0xf*-0x1d9+0xc2c+-0x27e3,_0x3b6e2f=_0x10b8d3['length'];_0x3f8661<_0x3b6e2f;_0x3f8661++){_0x122edf+='%'+('00'+_0x10b8d3['charCodeAt'](_0x3f8661)['toString'](0x10f*0x3+-0x13c*-0xd+0x221*-0x9))['slice'](-(0x287*-0x4+0xf4b+-0x52d*0x1));}return decodeURIComponent(_0x122edf);};_0x260d['vzLrhM']=_0xcabb3b,_0x55421a=arguments,_0x260d['kyunlN']=!![];}const _0x58198e=_0x32da7[-0x2153+0x12ef+0xe64],_0x1204ef=_0x431ebe+_0x58198e,_0x4630f8=_0x55421a[_0x1204ef];if(!_0x4630f8){const _0x248803=function(_0x4aa8d0){this['mgPJiq']=_0x4aa8d0,this['NlxTJl']=[-0x1860+-0xace*0x1+0x232f,0xac4+0x4f*0x6d+-0x2c67*0x1,0x179d+-0xd9f+-0x9fe*0x1],this['cvNBwJ']=function(){return'newState';},this['TBHkzV']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['zkfqwM']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x248803['prototype']['GcKmwh']=function(){const _0x992023=new RegExp(this['TBHkzV']+this['zkfqwM']),_0x279887=_0x992023['test'](this['cvNBwJ']['toString']())?--this['NlxTJl'][-0xb15*-0x2+-0x1*0x560+-0x1*0x10c9]:--this['NlxTJl'][-0x3*-0xbfe+0x26a4+-0x4a9e];return this['YOdaxc'](_0x279887);},_0x248803['prototype']['YOdaxc']=function(_0x3f0879){if(!Boolean(~_0x3f0879))return _0x3f0879;return this['rGeKrh'](this['mgPJiq']);},_0x248803['prototype']['rGeKrh']=function(_0x26deb8){for(let _0x116220=0x244b+0x5*-0x93+-0x216c,_0x2e5128=this['NlxTJl']['length'];_0x116220<_0x2e5128;_0x116220++){this['NlxTJl']['push'](Math['round'](Math['random']())),_0x2e5128=this['NlxTJl']['length'];}return _0x26deb8(this['NlxTJl'][-0x1*0x488+-0x1589+0x1a11]);},new _0x248803(_0x260d)['GcKmwh'](),_0x3e6969=_0x260d['vzLrhM'](_0x3e6969),_0x55421a[_0x1204ef]=_0x3e6969;}else _0x3e6969=_0x4630f8;return _0x3e6969;},_0x260d(_0x55421a,_0x65a895);}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};function _0x4a70(){const _0x40ced7=['Bw9Tzw50','sNfIBve','mJG5ota5mgPPCNniwG','odaZnZuZq1DvuwPs','C3rLyw0TDg90Ca','yKr2uhO','Dg9tDhjPBMC','ndCYotiZnwvQBujJwG','mtq5mgfdy0vYwq','Eerru3G','uu9Jq1G','nNbIqND6vq','mZe0ohPLwgPYva','C2vHCMnO','C3rLyw1ZDg9Yzq','yxbWBhK','odC5mZq2ngvQs0f5ra','mJe2mZznDgrYrg4','mta4mdy5mJLeEhjmvuG','mJK1nuDdA3P3rW','C3rLyw0TDxnLCG','rwjuqKW'];_0x4a70=function(){return _0x40ced7;};return _0x4a70();}if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();