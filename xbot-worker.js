(function(_0x3c33c7,_0x312d9c){const _0x1019e8={_0xba826c:0x119,_0x13a274:0x111,_0x4d78f6:0x10e,_0x787b17:0x112,_0xb9c591:0xfb,_0x49a470:0x106,_0x3fae59:0x109,_0x399eae:0x586,_0x2fc602:0x58c,_0x5f09a5:0x58a,_0xe40b44:0x57b,_0x4783b2:0x57e,_0x1a1e3e:0x584,_0x4721a1:0x581,_0x2f2c3b:0x105,_0x416c2d:0x108,_0x447f32:0xff,_0xea7aca:0x10f,_0x13a58c:0x110,_0x1d48c2:0x107,_0x1c9a65:0x100,_0x42cc19:0x104,_0x1c47d9:0x58c,_0x50e715:0x588,_0x59eca8:0x580,_0x38dd2b:0x597},_0x3c8740={_0x1908fa:0x399};function _0x3ab70d(_0x84cf04,_0x2b727c,_0x2b8473,_0x4b6793){return _0xa477(_0x2b727c-_0x3c8740._0x1908fa,_0x2b8473);}const _0x256fe7=_0x3c33c7();function _0x36c0fc(_0x3d5067,_0x3884f7,_0x2c3441,_0xf19bb6){return _0xa477(_0x3884f7- -0xde,_0x3d5067);}while(!![]){try{const _0x562481=-parseInt(_0x36c0fc(_0x1019e8._0xba826c,0x114,_0x1019e8._0x13a274,0x11e))/(0x5*0x6ea+-0x13*0xd+-0x219a)*(parseInt(_0x36c0fc(0x118,_0x1019e8._0x4d78f6,_0x1019e8._0x787b17,0x106))/(-0x13d0+-0xa*0x8+-0x6*-0x35b))+parseInt(_0x36c0fc(_0x1019e8._0xb9c591,_0x1019e8._0x49a470,_0x1019e8._0x3fae59,0x10e))/(-0x1*-0x54e+-0x18cc+-0x1381*-0x1)+-parseInt(_0x3ab70d(_0x1019e8._0x399eae,0x589,0x585,_0x1019e8._0x2fc602))/(-0x331*0x3+0xdcb+-0x434)+-parseInt(_0x3ab70d(_0x1019e8._0x5f09a5,0x586,_0x1019e8._0xe40b44,_0x1019e8._0x4783b2))/(0x2*-0x1259+0x4b2*-0x6+0x40e3)+parseInt(_0x3ab70d(_0x1019e8._0x1a1e3e,0x583,0x57b,_0x1019e8._0x4721a1))/(0x15d1+0x1054+0x1*-0x261f)*(-parseInt(_0x36c0fc(_0x1019e8._0x2f2c3b,_0x1019e8._0x416c2d,_0x1019e8._0x447f32,_0x1019e8._0xea7aca))/(-0x1f74+-0x2b*-0x76+-0xba9*-0x1))+-parseInt(_0x36c0fc(_0x1019e8._0x13a58c,_0x1019e8._0x1d48c2,_0x1019e8._0x1c9a65,_0x1019e8._0x42cc19))/(-0x1a1f+-0xc79+0x4*0x9a8)*(parseInt(_0x3ab70d(_0x1019e8._0x1c47d9,_0x1019e8._0x50e715,0x58b,_0x1019e8._0x59eca8))/(0x20ef*-0x1+0x4b6*0x4+0xe20))+parseInt(_0x3ab70d(_0x1019e8._0x2fc602,0x58c,_0x1019e8._0x38dd2b,0x584))/(-0x6bb*0x1+-0x3*0x3c2+0x120b);if(_0x562481===_0x312d9c)break;else _0x256fe7['push'](_0x256fe7['shift']());}catch(_0x2f2db5){_0x256fe7['push'](_0x256fe7['shift']());}}}(_0x574d,0x6dce2+0xfa*-0x30f+0x1*0x392fc));const _0x4c6397=(function(){let _0x523e23=!![];return function(_0x1f7d5b,_0x19be87){const _0x4f9579={_0xeb980b:0x3f,_0x5dccfe:0x3f,_0x178226:0x43,_0x120191:0x34},_0x53ad59=_0x523e23?function(){function _0x16f323(_0x40d10a,_0x11471e,_0x1bc601,_0x2a827b){return _0xa477(_0x11471e- -0x1a2,_0x2a827b);}if(_0x19be87){const _0x282be1=_0x19be87[_0x16f323(_0x4f9579._0xeb980b,_0x4f9579._0x5dccfe,_0x4f9579._0x178226,_0x4f9579._0x120191)](_0x1f7d5b,arguments);return _0x19be87=null,_0x282be1;}}:function(){};return _0x523e23=![],_0x53ad59;};}()),_0x219d8f=_0x4c6397(this,function(){const _0x11bd09={_0x4d21f4:0x2c2,_0x2e56af:0x2b7,_0x497339:0x22f,_0xf646e9:0x235,_0x2ccccc:0x231,_0xa038a1:0x237,_0x464b33:0x22b,_0x15b402:0x230,_0x29ad3b:0x2c4,_0xa280db:0x2c3,_0x4ca661:0x21a,_0x25ace6:0x22c,_0x3c2ec2:0x224,_0x131f9c:0x222,_0x33cd6a:0x2b1,_0x384beb:0x2b6,_0x32ff1c:0x225,_0x3f38c4:0x233,_0x50410b:0x22a},_0xf2af46={_0x181783:0x42};function _0x44488d(_0xc5778e,_0x394c29,_0x1c2e85,_0x42f4e0){return _0xa477(_0x1c2e85-0xce,_0x42f4e0);}function _0x78b2ef(_0x439de9,_0x2adf64,_0x2b0b13,_0x2b0b6d){return _0xa477(_0x2b0b6d-_0xf2af46._0x181783,_0x439de9);}const _0x89fc31={};_0x89fc31[_0x44488d(_0x11bd09._0x4d21f4,0x2bd,_0x11bd09._0x2e56af,0x2b0)]=_0x78b2ef(_0x11bd09._0x497339,_0x11bd09._0xf646e9,_0x11bd09._0x2ccccc,_0x11bd09._0xa038a1)+'+$';const _0xb28b6=_0x89fc31;return _0x219d8f[_0x78b2ef(_0x11bd09._0x464b33,0x236,_0x11bd09._0xa038a1,_0x11bd09._0x15b402)]()['search'](_0x44488d(0x2b8,_0x11bd09._0x29ad3b,_0x11bd09._0xa280db,_0x11bd09._0x4d21f4)+'+$')['toString']()[_0x78b2ef(_0x11bd09._0x4ca661,_0x11bd09._0x25ace6,_0x11bd09._0x3c2ec2,_0x11bd09._0x131f9c)+'r'](_0x219d8f)[_0x44488d(0x2b1,0x2b6,_0x11bd09._0x33cd6a,_0x11bd09._0x384beb)](_0xb28b6[_0x78b2ef(_0x11bd09._0x32ff1c,_0x11bd09._0x3f38c4,_0x11bd09._0x50410b,_0x11bd09._0x464b33)]);});_0x219d8f();const SteamCommunity=require(_0x474a60(-0x1b7,-0x1b5,-0x1b6,-0x1b9)+_0x230720(-0x5b,-0x65,-0x65,-0x60)),SteamTotp=require(_0x474a60(-0x1b3,-0x1ab,-0x1b3,-0x1a0)),moment=require(_0x230720(-0x6b,-0x73,-0x79,-0x72)),SteamUser=require(_0x474a60(-0x1aa,-0x1b1,-0x1ae,-0x1b7)),SteamStore=require(_0x230720(-0x68,-0x64,-0x6d,-0x6c));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');function _0x230720(_0x446218,_0xc9acc3,_0x47907a,_0x15529d){const _0x2cbb7c={_0x32e3d3:0x254};return _0xa477(_0x15529d- -_0x2cbb7c._0x32e3d3,_0xc9acc3);}const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}function _0xa477(_0x478f39,_0x3ff651){const _0x3d676d=_0x574d();return _0xa477=function(_0x512131,_0x534b34){_0x512131=_0x512131-(-0x214+0xa11+-0x61d);let _0x4be09f=_0x3d676d[_0x512131];if(_0xa477['FACfuz']===undefined){var _0x954b1e=function(_0x3cd90a){const _0x5cbdc9='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3011c7='',_0x549607='',_0x34f77b=_0x3011c7+_0x954b1e;for(let _0x402f99=0x2075+0xf53*-0x2+-0x1cf*0x1,_0xd34d4,_0x4ba53a,_0x5eb9be=0x10f*-0xe+-0x1a91+-0x2963*-0x1;_0x4ba53a=_0x3cd90a['charAt'](_0x5eb9be++);~_0x4ba53a&&(_0xd34d4=_0x402f99%(-0x777+-0xb12+0x128d)?_0xd34d4*(-0x1b*-0x107+0x1000*-0x1+-0xb7d)+_0x4ba53a:_0x4ba53a,_0x402f99++%(-0x1*0x1261+0xc2*-0xd+-0x1c3f*-0x1))?_0x3011c7+=_0x34f77b['charCodeAt'](_0x5eb9be+(0x615+0xc5e+-0x1269))-(-0x20ae+-0x2*0xfd4+0x4060)!==-0x3*-0xb6c+-0xd56*0x2+-0x9*0xd8?String['fromCharCode'](-0x1725*-0x1+-0x3d9*-0x2+-0x1dd8&_0xd34d4>>(-(-0xd*-0x162+-0x2544+0x26*0x82)*_0x402f99&-0xa0+0x20d6+-0x2030)):_0x402f99:-0x105*0x8+0x5*-0x24c+0x13a4){_0x4ba53a=_0x5cbdc9['indexOf'](_0x4ba53a);}for(let _0x17fdf3=-0x10a*-0x19+0x215b+-0xb7*0x53,_0x4196ba=_0x3011c7['length'];_0x17fdf3<_0x4196ba;_0x17fdf3++){_0x549607+='%'+('00'+_0x3011c7['charCodeAt'](_0x17fdf3)['toString'](-0x22ec*0x1+-0x1*0x38b+-0x2687*-0x1))['slice'](-(-0xd13+0x1bfe+-0xb*0x15b));}return decodeURIComponent(_0x549607);};_0xa477['QrRnRK']=_0x954b1e,_0x478f39=arguments,_0xa477['FACfuz']=!![];}const _0x44265b=_0x3d676d[-0x1e4+0x2650+-0x246c],_0xd4612b=_0x512131+_0x44265b,_0xfb2e66=_0x478f39[_0xd4612b];if(!_0xfb2e66){const _0x2b7b45=function(_0x2b574d){this['AxdQxY']=_0x2b574d,this['UbZJyi']=[0x1*0xc+-0x40b+0x4*0x100,-0x17f3+0x19ef+-0xfe*0x2,-0x1e80+-0xf9d+0x2e1d],this['EauGPg']=function(){return'newState';},this['VDBuar']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['WDLGwh']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2b7b45['prototype']['xHENay']=function(){const _0x2595f0=new RegExp(this['VDBuar']+this['WDLGwh']),_0x5050c1=_0x2595f0['test'](this['EauGPg']['toString']())?--this['UbZJyi'][0x1*0x112d+-0x37c*0x5+-0x4*-0x10]:--this['UbZJyi'][0x143b+0xdfd+-0x2238];return this['adgvnU'](_0x5050c1);},_0x2b7b45['prototype']['adgvnU']=function(_0x3fa6b9){if(!Boolean(~_0x3fa6b9))return _0x3fa6b9;return this['rMRqyY'](this['AxdQxY']);},_0x2b7b45['prototype']['rMRqyY']=function(_0xec7129){for(let _0x5fd89a=-0x1504+0xe75+0x68f,_0x305a49=this['UbZJyi']['length'];_0x5fd89a<_0x305a49;_0x5fd89a++){this['UbZJyi']['push'](Math['round'](Math['random']())),_0x305a49=this['UbZJyi']['length'];}return _0xec7129(this['UbZJyi'][0x2029+-0x10a+0x1*-0x1f1f]);},new _0x2b7b45(_0xa477)['xHENay'](),_0x4be09f=_0xa477['QrRnRK'](_0x4be09f),_0x478f39[_0xd4612b]=_0x4be09f;}else _0x4be09f=_0xfb2e66;return _0x4be09f;},_0xa477(_0x478f39,_0x3ff651);}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;function _0x574d(){const _0x458fa5=['zvLizhe','mty1mtH3qxHhwNe','C3rLyw0TDxnLCG','mtq2nZC4rwDizMHh','mZKZodyZmfHnBe5MuG','Dg9tDhjPBMC','mtG4mxfcC0f1rG','mtuZodm0ngrjsxzmCW','C3rLyw0TDg90Ca','mvLJvKP4Dq','mJqXmZeWodbABwDTvui','BML0Eq','kcGOlISPkYKRkq','y29UC3rYDwn0BW','yxbWBhK','Bw9Tzw50','C2vHCMnO','mti2ntCWm3jYwu9Iua','mZq2nJrnz25YrwK','ndK3Bejhyxvn','C3rLyw1JB21TDq','C3rLyw1ZDg9Yzq'];_0x574d=function(){return _0x458fa5;};return _0x574d();}try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:version,startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false};console.log(global.data.version);function _0x474a60(_0x59a91d,_0x2b670e,_0x548800,_0x361ecc){const _0x254f46={_0x2d1908:0x39c};return _0xa477(_0x2b670e- -_0x254f46._0x2d1908,_0x548800);}if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%300===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm upgrade --force --no-audit').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();